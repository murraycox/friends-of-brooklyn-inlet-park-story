import{s as Ke,R as x,S as ee,b as Y,f as T,q as M,T as ne,i as B,h as H,n as ke,U as Qe,V as Ht,y as mt,w as ie,r as at,W as ot,F as wt,C as ui,X as si,t as Xe,d as Be,j as qe,e as ge,a as Ce,c as ve,g as Pe,v as Mt,Y as An,z as Te,H as Zt,p as Wt,k as fi}from"../chunks/scheduler.BwjH7zTA.js";import{S as $e,i as xe,t as te,g as dt,a as re,e as _t,c as Me,b as Ee,m as Se,d as Ie}from"../chunks/index.BU9U6aD7.js";import{b as Kt,g as ci}from"../chunks/entry.CTgrmfPf.js";import{p as hi}from"../chunks/stores.OP5u9z2t.js";import{c as ae,d as pi,i as Qt,T as Et,e as St,f as me,b as It,g as gi,N as vi,s as Ye,a as mi}from"../chunks/story.CtG4K5fg.js";class De{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=r[i],l=t+o,s=Math.abs(t)<Math.abs(o)?t-(l-o):o-(l-t);s&&(r[n++]=s),t=l}return r[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let r=this._n,n,i,o,l=0;if(r>0){for(l=t[--r];r>0&&(n=l,i=t[--r],l=n+i,o=i-(l-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=l+i,i==n-l&&(l=n))}return l}}function*di(e){for(const t of e)yield*t}function Un(e){return Array.from(di(e))}function _i(e){let t;for(;t=e.sourceEvent;)e=t;return e}function we(e,t){if(e=_i(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Nt={capture:!0,passive:!1};function Tt(e){e.preventDefault(),e.stopImmediatePropagation()}function yi(e){var t=e.document.documentElement,r=ae(e).on("dragstart.drag",Tt,Nt);"onselectstart"in t?r.on("selectstart.drag",Tt,Nt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function wi(e,t){var r=e.document.documentElement,n=ae(e).on("dragstart.drag",null);t&&(n.on("click.drag",Tt,Nt),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var Mi=1e-12;function nn(e){return((e=Math.exp(e))+1/e)/2}function Ei(e){return((e=Math.exp(e))-1/e)/2}function Si(e){return((e=Math.exp(2*e))-1)/(e+1)}const Ii=function e(t,r,n){function i(o,l){var s=o[0],f=o[1],h=o[2],a=l[0],u=l[1],c=l[2],p=a-s,m=u-f,S=p*p+m*m,E,w;if(S<Mi)w=Math.log(c/h)/t,E=function(P){return[s+P*p,f+P*m,h*Math.exp(t*P*w)]};else{var D=Math.sqrt(S),_=(c*c-h*h+n*S)/(2*h*r*D),k=(c*c-h*h-n*S)/(2*c*r*D),y=Math.log(Math.sqrt(_*_+1)-_),O=Math.log(Math.sqrt(k*k+1)-k);w=(O-y)/t,E=function(P){var L=P*w,F=nn(y),j=h/(r*D)*(F*Si(t*L+y)-Ei(y));return[s+j*p,f+j*m,h*F/nn(t*L+y)]}}return E.duration=w*1e3*t/Math.SQRT2,E}return i.rho=function(o){var l=Math.max(.001,+o),s=l*l,f=s*s;return e(l,s,f)},i}(Math.SQRT2,2,4);function ki(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(!(e.status===204||e.status===205))return e.json()}function Yn(e,t){return fetch(e,t).then(ki)}var X=1e-6,Di=1e-12,J=Math.PI,oe=J/2,rn=J/4,ue=J*2,le=180/J,Q=J/180,q=Math.abs,Xn=Math.atan,Ge=Math.atan2,Z=Math.cos,bi=Math.exp,Oi=Math.log,W=Math.sin,zi=Math.sign||function(e){return e>0?1:e<0?-1:0},Oe=Math.sqrt,Ni=Math.tan;function Ti(e){return e>1?0:e<-1?J:Math.acos(e)}function He(e){return e>1?oe:e<-1?-oe:Math.asin(e)}function fe(){}function ut(e,t){e&&ln.hasOwnProperty(e.type)&&ln[e.type](e,t)}var on={Feature:function(e,t){ut(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)ut(r[n].geometry,t)}},ln={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ct(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)Ct(r[n],t,0)},Polygon:function(e,t){an(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)an(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)ut(r[n],t)}};function Ct(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function an(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)Ct(e[r],t,1);t.polygonEnd()}function ze(e,t){e&&on.hasOwnProperty(e.type)?on[e.type](e,t):ut(e,t)}function Pt(e){return[Ge(e[1],e[0]),He(e[2])]}function Le(e){var t=e[0],r=e[1],n=Z(r);return[n*Z(t),n*W(t),W(r)]}function et(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function st(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function tt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Lt(e){var t=Oe(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Rt(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function Ft(e,t){return q(e)>J&&(e-=Math.round(e/ue)*ue),[e,t]}Ft.invert=Ft;function Bn(e,t,r){return(e%=ue)?t||r?Rt(sn(e),fn(t,r)):sn(e):t||r?fn(t,r):Ft}function un(e){return function(t,r){return t+=e,q(t)>J&&(t-=Math.round(t/ue)*ue),[t,r]}}function sn(e){var t=un(e);return t.invert=un(-e),t}function fn(e,t){var r=Z(e),n=W(e),i=Z(t),o=W(t);function l(s,f){var h=Z(f),a=Z(s)*h,u=W(s)*h,c=W(f),p=c*r+a*n;return[Ge(u*i-p*o,a*r-c*n),He(p*i+u*o)]}return l.invert=function(s,f){var h=Z(f),a=Z(s)*h,u=W(s)*h,c=W(f),p=c*i-u*o;return[Ge(u*i+c*o,a*r+p*n),He(p*r-a*n)]},l}function Ci(e){e=Bn(e[0]*Q,e[1]*Q,e.length>2?e[2]*Q:0);function t(r){return r=e(r[0]*Q,r[1]*Q),r[0]*=le,r[1]*=le,r}return t.invert=function(r){return r=e.invert(r[0]*Q,r[1]*Q),r[0]*=le,r[1]*=le,r},t}function Pi(e,t,r,n,i,o){if(r){var l=Z(t),s=W(t),f=n*r;i==null?(i=t+n*ue,o=t-f/2):(i=cn(l,i),o=cn(l,o),(n>0?i<o:i>o)&&(i+=n*ue));for(var h,a=i;n>0?a>o:a<o;a-=f)h=Pt([l,-s*Z(a),-s*W(a)]),e.point(h[0],h[1])}}function cn(e,t){t=Le(t),t[0]-=e,Lt(t);var r=Ti(-t[1]);return((-t[2]<0?-r:r)+ue-X)%ue}function qn(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:fe,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function lt(e,t){return q(e[0]-t[0])<X&&q(e[1]-t[1])<X}function nt(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Gn(e,t,r,n,i){var o=[],l=[],s,f;if(e.forEach(function(m){if(!((S=m.length-1)<=0)){var S,E=m[0],w=m[S],D;if(lt(E,w)){if(!E[2]&&!w[2]){for(i.lineStart(),s=0;s<S;++s)i.point((E=m[s])[0],E[1]);i.lineEnd();return}w[0]+=2*X}o.push(D=new nt(E,m,null,!0)),l.push(D.o=new nt(E,null,D,!1)),o.push(D=new nt(w,m,null,!1)),l.push(D.o=new nt(w,null,D,!0))}}),!!o.length){for(l.sort(t),hn(o),hn(l),s=0,f=l.length;s<f;++s)l[s].e=r=!r;for(var h=o[0],a,u;;){for(var c=h,p=!0;c.v;)if((c=c.n)===h)return;a=c.z,i.lineStart();do{if(c.v=c.o.v=!0,c.e){if(p)for(s=0,f=a.length;s<f;++s)i.point((u=a[s])[0],u[1]);else n(c.x,c.n.x,1,i);c=c.n}else{if(p)for(a=c.p.z,s=a.length-1;s>=0;--s)i.point((u=a[s])[0],u[1]);else n(c.x,c.p.x,-1,i);c=c.p}c=c.o,a=c.z,p=!p}while(!c.v);i.lineEnd()}}}function hn(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function Dt(e){return q(e[0])<=J?e[0]:zi(e[0])*((q(e[0])+J)%ue-J)}function Li(e,t){var r=Dt(t),n=t[1],i=W(n),o=[W(r),-Z(r),0],l=0,s=0,f=new De;i===1?n=oe+X:i===-1&&(n=-oe-X);for(var h=0,a=e.length;h<a;++h)if(c=(u=e[h]).length)for(var u,c,p=u[c-1],m=Dt(p),S=p[1]/2+rn,E=W(S),w=Z(S),D=0;D<c;++D,m=k,E=O,w=P,p=_){var _=u[D],k=Dt(_),y=_[1]/2+rn,O=W(y),P=Z(y),L=k-m,F=L>=0?1:-1,j=F*L,C=j>J,z=E*O;if(f.add(Ge(z*F*W(j),w*P+z*Z(j))),l+=C?L+F*ue:L,C^m>=r^k>=r){var U=st(Le(p),Le(_));Lt(U);var g=st(o,U);Lt(g);var v=(C^L>=0?-1:1)*He(g[2]);(n>v||n===v&&(U[0]||U[1]))&&(s+=C^L>=0?1:-1)}}return(l<-X||l<X&&f<-Di)^s&1}function Hn(e,t,r,n){return function(i){var o=t(i),l=qn(),s=t(l),f=!1,h,a,u,c={point:p,lineStart:S,lineEnd:E,polygonStart:function(){c.point=w,c.lineStart=D,c.lineEnd=_,a=[],h=[]},polygonEnd:function(){c.point=p,c.lineStart=S,c.lineEnd=E,a=Un(a);var k=Li(h,n);a.length?(f||(i.polygonStart(),f=!0),Gn(a,Fi,k,r,i)):k&&(f||(i.polygonStart(),f=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),a=h=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(k,y){e(k,y)&&i.point(k,y)}function m(k,y){o.point(k,y)}function S(){c.point=m,o.lineStart()}function E(){c.point=p,o.lineEnd()}function w(k,y){u.push([k,y]),s.point(k,y)}function D(){s.lineStart(),u=[]}function _(){w(u[0][0],u[0][1]),s.lineEnd();var k=s.clean(),y=l.result(),O,P=y.length,L,F,j;if(u.pop(),h.push(u),u=null,!!P){if(k&1){if(F=y[0],(L=F.length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),O=0;O<L;++O)i.point((j=F[O])[0],j[1]);i.lineEnd()}return}P>1&&k&2&&y.push(y.pop().concat(y.shift())),a.push(y.filter(Ri))}}return c}}function Ri(e){return e.length>1}function Fi(e,t){return((e=e.x)[0]<0?e[1]-oe-X:oe-e[1])-((t=t.x)[0]<0?t[1]-oe-X:oe-t[1])}const pn=Hn(function(){return!0},Vi,ji,[-J,-oe]);function Vi(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,l){var s=o>0?J:-J,f=q(o-t);q(f-J)<X?(e.point(t,r=(r+l)/2>0?oe:-oe),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(o,r),i=0):n!==s&&f>=J&&(q(t-n)<X&&(t-=n*X),q(o-s)<X&&(o-=s*X),r=Ji(t,r,o,l),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),i=0),e.point(t=o,r=l),n=s},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Ji(e,t,r,n){var i,o,l=W(e-r);return q(l)>X?Xn((W(t)*(o=Z(n))*W(r)-W(n)*(i=Z(t))*W(e))/(i*o*l)):(t+n)/2}function ji(e,t,r,n){var i;if(e==null)i=r*oe,n.point(-J,i),n.point(0,i),n.point(J,i),n.point(J,0),n.point(J,-i),n.point(0,-i),n.point(-J,-i),n.point(-J,0),n.point(-J,i);else if(q(e[0]-t[0])>X){var o=e[0]<t[0]?J:-J;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function Ai(e){var t=Z(e),r=2*Q,n=t>0,i=q(t)>X;function o(a,u,c,p){Pi(p,e,r,c,a,u)}function l(a,u){return Z(a)*Z(u)>t}function s(a){var u,c,p,m,S;return{lineStart:function(){m=p=!1,S=1},point:function(E,w){var D=[E,w],_,k=l(E,w),y=n?k?0:h(E,w):k?h(E+(E<0?J:-J),w):0;if(!u&&(m=p=k)&&a.lineStart(),k!==p&&(_=f(u,D),(!_||lt(u,_)||lt(D,_))&&(D[2]=1)),k!==p)S=0,k?(a.lineStart(),_=f(D,u),a.point(_[0],_[1])):(_=f(u,D),a.point(_[0],_[1],2),a.lineEnd()),u=_;else if(i&&u&&n^k){var O;!(y&c)&&(O=f(D,u,!0))&&(S=0,n?(a.lineStart(),a.point(O[0][0],O[0][1]),a.point(O[1][0],O[1][1]),a.lineEnd()):(a.point(O[1][0],O[1][1]),a.lineEnd(),a.lineStart(),a.point(O[0][0],O[0][1],3)))}k&&(!u||!lt(u,D))&&a.point(D[0],D[1]),u=D,p=k,c=y},lineEnd:function(){p&&a.lineEnd(),u=null},clean:function(){return S|(m&&p)<<1}}}function f(a,u,c){var p=Le(a),m=Le(u),S=[1,0,0],E=st(p,m),w=et(E,E),D=E[0],_=w-D*D;if(!_)return!c&&a;var k=t*w/_,y=-t*D/_,O=st(S,E),P=tt(S,k),L=tt(E,y);kt(P,L);var F=O,j=et(P,F),C=et(F,F),z=j*j-C*(et(P,P)-1);if(!(z<0)){var U=Oe(z),g=tt(F,(-j-U)/C);if(kt(g,P),g=Pt(g),!c)return g;var v=a[0],d=u[0],I=a[1],b=u[1],N;d<v&&(N=v,v=d,d=N);var R=d-v,V=q(R-J)<X,A=V||R<X;if(!V&&b<I&&(N=I,I=b,b=N),A?V?I+b>0^g[1]<(q(g[0]-v)<X?I:b):I<=g[1]&&g[1]<=b:R>J^(v<=g[0]&&g[0]<=d)){var K=tt(F,(-j+U)/C);return kt(K,P),[g,Pt(K)]}}}function h(a,u){var c=n?e:J-e,p=0;return a<-c?p|=1:a>c&&(p|=2),u<-c?p|=4:u>c&&(p|=8),p}return Hn(l,s,o,n?[0,-e]:[-J,e-J])}function Ui(e,t,r,n,i,o){var l=e[0],s=e[1],f=t[0],h=t[1],a=0,u=1,c=f-l,p=h-s,m;if(m=r-l,!(!c&&m>0)){if(m/=c,c<0){if(m<a)return;m<u&&(u=m)}else if(c>0){if(m>u)return;m>a&&(a=m)}if(m=i-l,!(!c&&m<0)){if(m/=c,c<0){if(m>u)return;m>a&&(a=m)}else if(c>0){if(m<a)return;m<u&&(u=m)}if(m=n-s,!(!p&&m>0)){if(m/=p,p<0){if(m<a)return;m<u&&(u=m)}else if(p>0){if(m>u)return;m>a&&(a=m)}if(m=o-s,!(!p&&m<0)){if(m/=p,p<0){if(m>u)return;m>a&&(a=m)}else if(p>0){if(m<a)return;m<u&&(u=m)}return a>0&&(e[0]=l+a*c,e[1]=s+a*p),u<1&&(t[0]=l+u*c,t[1]=s+u*p),!0}}}}}var Ve=1e9,it=-Ve;function Yi(e,t,r,n){function i(h,a){return e<=h&&h<=r&&t<=a&&a<=n}function o(h,a,u,c){var p=0,m=0;if(h==null||(p=l(h,u))!==(m=l(a,u))||f(h,a)<0^u>0)do c.point(p===0||p===3?e:r,p>1?n:t);while((p=(p+u+4)%4)!==m);else c.point(a[0],a[1])}function l(h,a){return q(h[0]-e)<X?a>0?0:3:q(h[0]-r)<X?a>0?2:1:q(h[1]-t)<X?a>0?1:0:a>0?3:2}function s(h,a){return f(h.x,a.x)}function f(h,a){var u=l(h,1),c=l(a,1);return u!==c?u-c:u===0?a[1]-h[1]:u===1?h[0]-a[0]:u===2?h[1]-a[1]:a[0]-h[0]}return function(h){var a=h,u=qn(),c,p,m,S,E,w,D,_,k,y,O,P={point:L,lineStart:z,lineEnd:U,polygonStart:j,polygonEnd:C};function L(v,d){i(v,d)&&a.point(v,d)}function F(){for(var v=0,d=0,I=p.length;d<I;++d)for(var b=p[d],N=1,R=b.length,V=b[0],A,K,G=V[0],$=V[1];N<R;++N)A=G,K=$,V=b[N],G=V[0],$=V[1],K<=n?$>n&&(G-A)*(n-K)>($-K)*(e-A)&&++v:$<=n&&(G-A)*(n-K)<($-K)*(e-A)&&--v;return v}function j(){a=u,c=[],p=[],O=!0}function C(){var v=F(),d=O&&v,I=(c=Un(c)).length;(d||I)&&(h.polygonStart(),d&&(h.lineStart(),o(null,null,1,h),h.lineEnd()),I&&Gn(c,s,v,o,h),h.polygonEnd()),a=h,c=p=m=null}function z(){P.point=g,p&&p.push(m=[]),y=!0,k=!1,D=_=NaN}function U(){c&&(g(S,E),w&&k&&u.rejoin(),c.push(u.result())),P.point=L,k&&a.lineEnd()}function g(v,d){var I=i(v,d);if(p&&m.push([v,d]),y)S=v,E=d,w=I,y=!1,I&&(a.lineStart(),a.point(v,d));else if(I&&k)a.point(v,d);else{var b=[D=Math.max(it,Math.min(Ve,D)),_=Math.max(it,Math.min(Ve,_))],N=[v=Math.max(it,Math.min(Ve,v)),d=Math.max(it,Math.min(Ve,d))];Ui(b,N,e,t,r,n)?(k||(a.lineStart(),a.point(b[0],b[1])),a.point(N[0],N[1]),I||a.lineEnd(),O=!1):I&&(a.lineStart(),a.point(v,d),O=!1)}D=v,_=d,k=I}return P}}const Vt=e=>e;var bt=new De,Jt=new De,Zn,Wn,jt,At,ye={point:fe,lineStart:fe,lineEnd:fe,polygonStart:function(){ye.lineStart=Xi,ye.lineEnd=qi},polygonEnd:function(){ye.lineStart=ye.lineEnd=ye.point=fe,bt.add(q(Jt)),Jt=new De},result:function(){var e=bt/2;return bt=new De,e}};function Xi(){ye.point=Bi}function Bi(e,t){ye.point=Kn,Zn=jt=e,Wn=At=t}function Kn(e,t){Jt.add(At*e-jt*t),jt=e,At=t}function qi(){Kn(Zn,Wn)}var Re=1/0,ft=Re,Ze=-Re,ct=Ze,ht={point:Gi,lineStart:fe,lineEnd:fe,polygonStart:fe,polygonEnd:fe,result:function(){var e=[[Re,ft],[Ze,ct]];return Ze=ct=-(ft=Re=1/0),e}};function Gi(e,t){e<Re&&(Re=e),e>Ze&&(Ze=e),t<ft&&(ft=t),t>ct&&(ct=t)}var Ut=0,Yt=0,Je=0,pt=0,gt=0,Ne=0,Xt=0,Bt=0,je=0,Qn,$n,he,pe,se={point:be,lineStart:gn,lineEnd:vn,polygonStart:function(){se.lineStart=Wi,se.lineEnd=Ki},polygonEnd:function(){se.point=be,se.lineStart=gn,se.lineEnd=vn},result:function(){var e=je?[Xt/je,Bt/je]:Ne?[pt/Ne,gt/Ne]:Je?[Ut/Je,Yt/Je]:[NaN,NaN];return Ut=Yt=Je=pt=gt=Ne=Xt=Bt=je=0,e}};function be(e,t){Ut+=e,Yt+=t,++Je}function gn(){se.point=Hi}function Hi(e,t){se.point=Zi,be(he=e,pe=t)}function Zi(e,t){var r=e-he,n=t-pe,i=Oe(r*r+n*n);pt+=i*(he+e)/2,gt+=i*(pe+t)/2,Ne+=i,be(he=e,pe=t)}function vn(){se.point=be}function Wi(){se.point=Qi}function Ki(){xn(Qn,$n)}function Qi(e,t){se.point=xn,be(Qn=he=e,$n=pe=t)}function xn(e,t){var r=e-he,n=t-pe,i=Oe(r*r+n*n);pt+=i*(he+e)/2,gt+=i*(pe+t)/2,Ne+=i,i=pe*e-he*t,Xt+=i*(he+e),Bt+=i*(pe+t),je+=i*3,be(he=e,pe=t)}function ei(e){this._context=e}ei.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,ue);break}}},result:fe};var qt=new De,Ot,ti,ni,Ae,Ue,We={point:fe,lineStart:function(){We.point=$i},lineEnd:function(){Ot&&ii(ti,ni),We.point=fe},polygonStart:function(){Ot=!0},polygonEnd:function(){Ot=null},result:function(){var e=+qt;return qt=new De,e}};function $i(e,t){We.point=ii,ti=Ae=e,ni=Ue=t}function ii(e,t){Ae-=e,Ue-=t,qt.add(Oe(Ae*Ae+Ue*Ue)),Ae=e,Ue=t}let mn,vt,dn,_n;class yn{constructor(t){this._append=t==null?ri:xi(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==dn||this._append!==vt){const n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,dn=n,vt=this._append,_n=this._,this._=i}this._+=_n;break}}}result(){const t=this._;return this._="",t.length?t:null}}function ri(e){let t=1;this._+=e[0];for(const r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function xi(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return ri;if(t!==mn){const r=10**t;mn=t,vt=function(i){let o=1;this._+=i[0];for(const l=i.length;o<l;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return vt}function $t(e,t){let r=3,n=4.5,i,o;function l(s){return s&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),ze(s,i(o))),o.result()}return l.area=function(s){return ze(s,i(ye)),ye.result()},l.measure=function(s){return ze(s,i(We)),We.result()},l.bounds=function(s){return ze(s,i(ht)),ht.result()},l.centroid=function(s){return ze(s,i(se)),se.result()},l.projection=function(s){return arguments.length?(i=s==null?(e=null,Vt):(e=s).stream,l):e},l.context=function(s){return arguments.length?(o=s==null?(t=null,new yn(r)):new ei(t=s),typeof n!="function"&&o.pointRadius(n),l):t},l.pointRadius=function(s){return arguments.length?(n=typeof s=="function"?s:(o.pointRadius(+s),+s),l):n},l.digits=function(s){if(!arguments.length)return r;if(s==null)r=null;else{const f=Math.floor(s);if(!(f>=0))throw new RangeError(`invalid digits: ${s}`);r=f}return t===null&&(o=new yn(r)),l},l.projection(e).digits(r).context(t)}function xt(e){return function(t){var r=new Gt;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Gt(){}Gt.prototype={constructor:Gt,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function en(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),ze(r,e.stream(ht)),t(ht.result()),n!=null&&e.clipExtent(n),e}function oi(e,t,r){return en(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],l=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),s=+t[0][0]+(i-l*(n[1][0]+n[0][0]))/2,f=+t[0][1]+(o-l*(n[1][1]+n[0][1]))/2;e.scale(150*l).translate([s,f])},r)}function er(e,t,r){return oi(e,[[0,0],t],r)}function tr(e,t,r){return en(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),l=(i-o*(n[1][0]+n[0][0]))/2,s=-o*n[0][1];e.scale(150*o).translate([l,s])},r)}function nr(e,t,r){return en(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),l=-o*n[0][0],s=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([l,s])},r)}var wn=16,ir=Z(30*Q);function Mn(e,t){return+t?or(e,t):rr(e)}function rr(e){return xt({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function or(e,t){function r(n,i,o,l,s,f,h,a,u,c,p,m,S,E){var w=h-n,D=a-i,_=w*w+D*D;if(_>4*t&&S--){var k=l+c,y=s+p,O=f+m,P=Oe(k*k+y*y+O*O),L=He(O/=P),F=q(q(O)-1)<X||q(o-u)<X?(o+u)/2:Ge(y,k),j=e(F,L),C=j[0],z=j[1],U=C-n,g=z-i,v=D*U-w*g;(v*v/_>t||q((w*U+D*g)/_-.5)>.3||l*c+s*p+f*m<ir)&&(r(n,i,o,l,s,f,C,z,F,k/=P,y/=P,O,S,E),E.point(C,z),r(C,z,F,k,y,O,h,a,u,c,p,m,S,E))}}return function(n){var i,o,l,s,f,h,a,u,c,p,m,S,E={point:w,lineStart:D,lineEnd:k,polygonStart:function(){n.polygonStart(),E.lineStart=y},polygonEnd:function(){n.polygonEnd(),E.lineStart=D}};function w(L,F){L=e(L,F),n.point(L[0],L[1])}function D(){u=NaN,E.point=_,n.lineStart()}function _(L,F){var j=Le([L,F]),C=e(L,F);r(u,c,a,p,m,S,u=C[0],c=C[1],a=L,p=j[0],m=j[1],S=j[2],wn,n),n.point(u,c)}function k(){E.point=w,n.lineEnd()}function y(){D(),E.point=O,E.lineEnd=P}function O(L,F){_(i=L,F),o=u,l=c,s=p,f=m,h=S,E.point=_}function P(){r(u,c,a,p,m,S,o,l,i,s,f,h,wn,n),E.lineEnd=k,k()}return E}}var lr=xt({point:function(e,t){this.stream.point(e*Q,t*Q)}});function ar(e){return xt({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function ur(e,t,r,n,i){function o(l,s){return l*=n,s*=i,[t+e*l,r-e*s]}return o.invert=function(l,s){return[(l-t)/e*n,(r-s)/e*i]},o}function En(e,t,r,n,i,o){if(!o)return ur(e,t,r,n,i);var l=Z(o),s=W(o),f=l*e,h=s*e,a=l/e,u=s/e,c=(s*r-l*t)/e,p=(s*t+l*r)/e;function m(S,E){return S*=n,E*=i,[f*S-h*E+t,r-h*S-f*E]}return m.invert=function(S,E){return[n*(a*S-u*E+c),i*(p-u*S-a*E)]},m}function sr(e){return fr(function(){return e})()}function fr(e){var t,r=150,n=480,i=250,o=0,l=0,s=0,f=0,h=0,a,u=0,c=1,p=1,m=null,S=pn,E=null,w,D,_,k=Vt,y=.5,O,P,L,F,j;function C(v){return L(v[0]*Q,v[1]*Q)}function z(v){return v=L.invert(v[0],v[1]),v&&[v[0]*le,v[1]*le]}C.stream=function(v){return F&&j===v?F:F=lr(ar(a)(S(O(k(j=v)))))},C.preclip=function(v){return arguments.length?(S=v,m=void 0,g()):S},C.postclip=function(v){return arguments.length?(k=v,E=w=D=_=null,g()):k},C.clipAngle=function(v){return arguments.length?(S=+v?Ai(m=v*Q):(m=null,pn),g()):m*le},C.clipExtent=function(v){return arguments.length?(k=v==null?(E=w=D=_=null,Vt):Yi(E=+v[0][0],w=+v[0][1],D=+v[1][0],_=+v[1][1]),g()):E==null?null:[[E,w],[D,_]]},C.scale=function(v){return arguments.length?(r=+v,U()):r},C.translate=function(v){return arguments.length?(n=+v[0],i=+v[1],U()):[n,i]},C.center=function(v){return arguments.length?(o=v[0]%360*Q,l=v[1]%360*Q,U()):[o*le,l*le]},C.rotate=function(v){return arguments.length?(s=v[0]%360*Q,f=v[1]%360*Q,h=v.length>2?v[2]%360*Q:0,U()):[s*le,f*le,h*le]},C.angle=function(v){return arguments.length?(u=v%360*Q,U()):u*le},C.reflectX=function(v){return arguments.length?(c=v?-1:1,U()):c<0},C.reflectY=function(v){return arguments.length?(p=v?-1:1,U()):p<0},C.precision=function(v){return arguments.length?(O=Mn(P,y=v*v),g()):Oe(y)},C.fitExtent=function(v,d){return oi(C,v,d)},C.fitSize=function(v,d){return er(C,v,d)},C.fitWidth=function(v,d){return tr(C,v,d)},C.fitHeight=function(v,d){return nr(C,v,d)};function U(){var v=En(r,0,0,c,p,u).apply(null,t(o,l)),d=En(r,n-v[0],i-v[1],c,p,u);return a=Bn(s,f,h),P=Rt(t,d),L=Rt(a,P),O=Mn(P,y),g()}function g(){return F=j=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&z,U()}}function tn(e,t){return[e,Oi(Ni((oe+t)/2))]}tn.invert=function(e,t){return[e,2*Xn(bi(t))-oe]};function cr(){return hr(tn).scale(961/ue)}function hr(e){var t=sr(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,l=null,s,f,h;t.scale=function(u){return arguments.length?(n(u),a()):n()},t.translate=function(u){return arguments.length?(i(u),a()):i()},t.center=function(u){return arguments.length?(r(u),a()):r()},t.clipExtent=function(u){return arguments.length?(u==null?l=s=f=h=null:(l=+u[0][0],s=+u[0][1],f=+u[1][0],h=+u[1][1]),a()):l==null?null:[[l,s],[f,h]]};function a(){var u=J*n(),c=t(Ci(t.rotate()).invert([0,0]));return o(l==null?[[c[0]-u,c[1]-u],[c[0]+u,c[1]+u]]:e===tn?[[Math.max(c[0]-u,l),s],[Math.min(c[0]+u,f),h]]:[[l,Math.max(c[1]-u,s)],[f,Math.min(c[1]+u,h)]])}return a()}const rt=e=>()=>e;function pr(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function zt(e){e.stopImmediatePropagation()}function Fe(e){e.preventDefault(),e.stopImmediatePropagation()}function gr(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function vr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Sn(){return this.__zoom||Qt}function mr(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function dr(){return navigator.maxTouchPoints||"ontouchstart"in this}function _r(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],o=e.invertY(t[0][1])-r[0][1],l=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function yr(){var e=gr,t=vr,r=_r,n=mr,i=dr,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],s=250,f=Ii,h=pi("start","zoom","end"),a,u,c,p=500,m=150,S=0,E=10;function w(g){g.property("__zoom",Sn).on("wheel.zoom",L,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",j).filter(i).on("touchstart.zoom",C).on("touchmove.zoom",z).on("touchend.zoom touchcancel.zoom",U).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(g,v,d,I){var b=g.selection?g.selection():g;b.property("__zoom",Sn),g!==b?y(g,v,d,I):b.interrupt().each(function(){O(this,arguments).event(I).start().zoom(null,typeof v=="function"?v.apply(this,arguments):v).end()})},w.scaleBy=function(g,v,d,I){w.scaleTo(g,function(){var b=this.__zoom.k,N=typeof v=="function"?v.apply(this,arguments):v;return b*N},d,I)},w.scaleTo=function(g,v,d,I){w.transform(g,function(){var b=t.apply(this,arguments),N=this.__zoom,R=d==null?k(b):typeof d=="function"?d.apply(this,arguments):d,V=N.invert(R),A=typeof v=="function"?v.apply(this,arguments):v;return r(_(D(N,A),R,V),b,l)},d,I)},w.translateBy=function(g,v,d,I){w.transform(g,function(){return r(this.__zoom.translate(typeof v=="function"?v.apply(this,arguments):v,typeof d=="function"?d.apply(this,arguments):d),t.apply(this,arguments),l)},null,I)},w.translateTo=function(g,v,d,I,b){w.transform(g,function(){var N=t.apply(this,arguments),R=this.__zoom,V=I==null?k(N):typeof I=="function"?I.apply(this,arguments):I;return r(Qt.translate(V[0],V[1]).scale(R.k).translate(typeof v=="function"?-v.apply(this,arguments):-v,typeof d=="function"?-d.apply(this,arguments):-d),N,l)},I,b)};function D(g,v){return v=Math.max(o[0],Math.min(o[1],v)),v===g.k?g:new Et(v,g.x,g.y)}function _(g,v,d){var I=v[0]-d[0]*g.k,b=v[1]-d[1]*g.k;return I===g.x&&b===g.y?g:new Et(g.k,I,b)}function k(g){return[(+g[0][0]+ +g[1][0])/2,(+g[0][1]+ +g[1][1])/2]}function y(g,v,d,I){g.on("start.zoom",function(){O(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(I).end()}).tween("zoom",function(){var b=this,N=arguments,R=O(b,N).event(I),V=t.apply(b,N),A=d==null?k(V):typeof d=="function"?d.apply(b,N):d,K=Math.max(V[1][0]-V[0][0],V[1][1]-V[0][1]),G=b.__zoom,$=typeof v=="function"?v.apply(b,N):v,de=f(G.invert(A).concat(K/G.k),$.invert(A).concat(K/$.k));return function(ce){if(ce===1)ce=$;else{var _e=de(ce),yt=K/_e[2];ce=new Et(yt,A[0]-_e[0]*yt,A[1]-_e[1]*yt)}R.zoom(null,ce)}})}function O(g,v,d){return!d&&g.__zooming||new P(g,v)}function P(g,v){this.that=g,this.args=v,this.active=0,this.sourceEvent=null,this.extent=t.apply(g,v),this.taps=0}P.prototype={event:function(g){return g&&(this.sourceEvent=g),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(g,v){return this.mouse&&g!=="mouse"&&(this.mouse[1]=v.invert(this.mouse[0])),this.touch0&&g!=="touch"&&(this.touch0[1]=v.invert(this.touch0[0])),this.touch1&&g!=="touch"&&(this.touch1[1]=v.invert(this.touch1[0])),this.that.__zoom=v,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(g){var v=ae(this.that).datum();h.call(g,this.that,new pr(g,{sourceEvent:this.sourceEvent,target:w,type:g,transform:this.that.__zoom,dispatch:h}),v)}};function L(g,...v){if(!e.apply(this,arguments))return;var d=O(this,v).event(g),I=this.__zoom,b=Math.max(o[0],Math.min(o[1],I.k*Math.pow(2,n.apply(this,arguments)))),N=we(g);if(d.wheel)(d.mouse[0][0]!==N[0]||d.mouse[0][1]!==N[1])&&(d.mouse[1]=I.invert(d.mouse[0]=N)),clearTimeout(d.wheel);else{if(I.k===b)return;d.mouse=[N,I.invert(N)],St(this),d.start()}Fe(g),d.wheel=setTimeout(R,m),d.zoom("mouse",r(_(D(I,b),d.mouse[0],d.mouse[1]),d.extent,l));function R(){d.wheel=null,d.end()}}function F(g,...v){if(c||!e.apply(this,arguments))return;var d=g.currentTarget,I=O(this,v,!0).event(g),b=ae(g.view).on("mousemove.zoom",A,!0).on("mouseup.zoom",K,!0),N=we(g,d),R=g.clientX,V=g.clientY;yi(g.view),zt(g),I.mouse=[N,this.__zoom.invert(N)],St(this),I.start();function A(G){if(Fe(G),!I.moved){var $=G.clientX-R,de=G.clientY-V;I.moved=$*$+de*de>S}I.event(G).zoom("mouse",r(_(I.that.__zoom,I.mouse[0]=we(G,d),I.mouse[1]),I.extent,l))}function K(G){b.on("mousemove.zoom mouseup.zoom",null),wi(G.view,I.moved),Fe(G),I.event(G).end()}}function j(g,...v){if(e.apply(this,arguments)){var d=this.__zoom,I=we(g.changedTouches?g.changedTouches[0]:g,this),b=d.invert(I),N=d.k*(g.shiftKey?.5:2),R=r(_(D(d,N),I,b),t.apply(this,v),l);Fe(g),s>0?ae(this).transition().duration(s).call(y,R,I,g):ae(this).call(w.transform,R,I,g)}}function C(g,...v){if(e.apply(this,arguments)){var d=g.touches,I=d.length,b=O(this,v,g.changedTouches.length===I).event(g),N,R,V,A;for(zt(g),R=0;R<I;++R)V=d[R],A=we(V,this),A=[A,this.__zoom.invert(A),V.identifier],b.touch0?!b.touch1&&b.touch0[2]!==A[2]&&(b.touch1=A,b.taps=0):(b.touch0=A,N=!0,b.taps=1+!!a);a&&(a=clearTimeout(a)),N&&(b.taps<2&&(u=A[0],a=setTimeout(function(){a=null},p)),St(this),b.start())}}function z(g,...v){if(this.__zooming){var d=O(this,v).event(g),I=g.changedTouches,b=I.length,N,R,V,A;for(Fe(g),N=0;N<b;++N)R=I[N],V=we(R,this),d.touch0&&d.touch0[2]===R.identifier?d.touch0[0]=V:d.touch1&&d.touch1[2]===R.identifier&&(d.touch1[0]=V);if(R=d.that.__zoom,d.touch1){var K=d.touch0[0],G=d.touch0[1],$=d.touch1[0],de=d.touch1[1],ce=(ce=$[0]-K[0])*ce+(ce=$[1]-K[1])*ce,_e=(_e=de[0]-G[0])*_e+(_e=de[1]-G[1])*_e;R=D(R,Math.sqrt(ce/_e)),V=[(K[0]+$[0])/2,(K[1]+$[1])/2],A=[(G[0]+de[0])/2,(G[1]+de[1])/2]}else if(d.touch0)V=d.touch0[0],A=d.touch0[1];else return;d.zoom("touch",r(_(R,V,A),d.extent,l))}}function U(g,...v){if(this.__zooming){var d=O(this,v).event(g),I=g.changedTouches,b=I.length,N,R;for(zt(g),c&&clearTimeout(c),c=setTimeout(function(){c=null},p),N=0;N<b;++N)R=I[N],d.touch0&&d.touch0[2]===R.identifier?delete d.touch0:d.touch1&&d.touch1[2]===R.identifier&&delete d.touch1;if(d.touch1&&!d.touch0&&(d.touch0=d.touch1,delete d.touch1),d.touch0)d.touch0[1]=this.__zoom.invert(d.touch0[0]);else if(d.end(),d.taps===2&&(R=we(R,this),Math.hypot(u[0]-R[0],u[1]-R[1])<E)){var V=ae(this).on("dblclick.zoom");V&&V.apply(this,arguments)}}}return w.wheelDelta=function(g){return arguments.length?(n=typeof g=="function"?g:rt(+g),w):n},w.filter=function(g){return arguments.length?(e=typeof g=="function"?g:rt(!!g),w):e},w.touchable=function(g){return arguments.length?(i=typeof g=="function"?g:rt(!!g),w):i},w.extent=function(g){return arguments.length?(t=typeof g=="function"?g:rt([[+g[0][0],+g[0][1]],[+g[1][0],+g[1][1]]]),w):t},w.scaleExtent=function(g){return arguments.length?(o[0]=+g[0],o[1]=+g[1],w):[o[0],o[1]]},w.translateExtent=function(g){return arguments.length?(l[0][0]=+g[0][0],l[1][0]=+g[1][0],l[0][1]=+g[0][1],l[1][1]=+g[1][1],w):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},w.constrain=function(g){return arguments.length?(r=g,w):r},w.duration=function(g){return arguments.length?(s=+g,w):s},w.interpolate=function(g){return arguments.length?(f=g,w):f},w.on=function(){var g=h.on.apply(h,arguments);return g===h?w:g},w.clickDistance=function(g){return arguments.length?(S=(g=+g)*g,w):Math.sqrt(S)},w.tapDistance=function(g){return arguments.length?(E=+g,w):E},w}function In(e,t,r){const n=e.slice();return n[18]=t[r],n}function wr(e){let t,r,n,i;return{c(){t=x("circle"),this.h()},l(o){t=ee(o,"circle",{class:!0,cx:!0,cy:!0,r:!0,fill:!0}),Y(t).forEach(T),this.h()},h(){M(t,"class",r=`feature-${e[18].properties.id}`),M(t,"cx",n=e[0](e[18])[0]),M(t,"cy",i=e[0](e[18])[1]),M(t,"r","30"),M(t,"fill","#599FF0")},m(o,l){B(o,t,l)},p(o,l){l&256&&r!==(r=`feature-${o[18].properties.id}`)&&M(t,"class",r),l&257&&n!==(n=o[0](o[18])[0])&&M(t,"cx",n),l&257&&i!==(i=o[0](o[18])[1])&&M(t,"cy",i)},d(o){o&&T(t)}}}function Mr(e){let t;function r(o,l){return o[2]?Sr:Er}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),B(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function Er(e){let t,r,n;return{c(){t=x("path"),this.h()},l(i){t=ee(i,"path",{class:!0,d:!0}),Y(t).forEach(T),this.h()},h(){M(t,"class",r=at(`feature-${e[18].properties.id}`)+" svelte-11hs3po"),M(t,"d",n=e[9](e[18]))},m(i,o){B(i,t,o)},p(i,o){o&256&&r!==(r=at(`feature-${i[18].properties.id}`)+" svelte-11hs3po")&&M(t,"class",r),o&768&&n!==(n=i[9](i[18]))&&M(t,"d",n)},d(i){i&&T(t)}}}function Sr(e){let t,r,n,i,o;return{c(){t=x("path"),this.h()},l(l){t=ee(l,"path",{class:!0,d:!0}),Y(t).forEach(T),this.h()},h(){M(t,"class",r=at(`feature-${e[18].properties.id}`)+" svelte-11hs3po"),M(t,"d",n=e[9](e[18])),ne(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},m(l,s){B(l,t,s),i||(o=[ot(t,"mouseover",function(){wt(e[11](e[18]))&&e[11](e[18]).apply(this,arguments)}),ot(t,"mouseout",function(){wt(e[12](e[18]))&&e[12](e[18]).apply(this,arguments)}),ot(t,"click",function(){wt(e[13](e[18]))&&e[13](e[18]).apply(this,arguments)})],i=!0)},p(l,s){e=l,s&256&&r!==(r=at(`feature-${e[18].properties.id}`)+" svelte-11hs3po")&&M(t,"class",r),s&768&&n!==(n=e[9](e[18]))&&M(t,"d",n),s&1280&&ne(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},d(l){l&&T(t),i=!1,ui(o)}}}function kn(e){let t;function r(o,l){return o[4]=="polygons"?Mr:wr}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),B(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function Ir(e){let t,r,n,i,o,l,s,f,h=me(e[8]),a=[];for(let u=0;u<h.length;u+=1)a[u]=kn(In(e,h,u));return{c(){t=x("g"),r=x("pattern"),n=x("circle"),i=x("pattern"),o=x("circle"),l=x("pattern"),s=x("circle");for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){t=ee(u,"g",{class:!0,id:!0});var c=Y(t);r=ee(c,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var p=Y(r);n=ee(p,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(n).forEach(T),p.forEach(T),i=ee(c,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var m=Y(i);o=ee(m,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(o).forEach(T),m.forEach(T),l=ee(c,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var S=Y(l);s=ee(S,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(s).forEach(T),S.forEach(T);for(let E=0;E<a.length;E+=1)a[E].l(c);c.forEach(T),this.h()},h(){M(n,"cx","1"),M(n,"cy","1"),M(n,"r","0.6"),M(n,"fill","#A060C1"),M(r,"id","circles-urban-industrial-era"),M(r,"x","0"),M(r,"y","0"),M(r,"width","2"),M(r,"height","2"),M(r,"patternUnits","userSpaceOnUse"),M(o,"cx","5"),M(o,"cy","5"),M(o,"r","2"),M(o,"fill","#83BC6E"),M(i,"id","circles-pre-1600s"),M(i,"x","0"),M(i,"y","0"),M(i,"width","10"),M(i,"height","10"),M(i,"patternUnits","userSpaceOnUse"),M(s,"cx","0.5"),M(s,"cy","0.5"),M(s,"r","0.4"),M(s,"fill","#83BC6E"),M(l,"id","circles-intro"),M(l,"x","0"),M(l,"y","0"),M(l,"width","1"),M(l,"height","1"),M(l,"patternUnits","userSpaceOnUse"),M(t,"class",f=`map-svg-g view-${e[5]} era-${e[6]} stop-${e[7]} svelte-11hs3po`),M(t,"id",e[1]),ne(t,"visible",e[3]),ne(t,"hidden",!e[3])},m(u,c){B(u,t,c),H(t,r),H(r,n),H(t,i),H(i,o),H(t,l),H(l,s);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(t,null)},p(u,[c]){if(c&16149){h=me(u[8]);let p;for(p=0;p<h.length;p+=1){const m=In(u,h,p);a[p]?a[p].p(m,c):(a[p]=kn(m),a[p].c(),a[p].m(t,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=h.length}c&224&&f!==(f=`map-svg-g view-${u[5]} era-${u[6]} stop-${u[7]} svelte-11hs3po`)&&M(t,"class",f),c&2&&M(t,"id",u[1]),c&232&&ne(t,"visible",u[3]),c&232&&ne(t,"hidden",!u[3])},i:ke,o:ke,d(u){u&&T(t),Qe(a,u)}}}function kr(e,t,r){let{url:n=""}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,{geometryType:f="polygons"}=t,{activeViewID:h}=t,{activeEraID:a}=t,{activeStopID:u}=t;function c(y){console.log("Map(id: "+o+"):onChapterMouseOver(event:"+JSON.stringify(y.detail)+")"),r(10,E=y.detail.id)}function p(y){console.log("Map(id: "+o+"):onChapterMouseLeave(event:"+JSON.stringify(y.detail)+")"),r(10,E=null)}let m=[],S=null,E=null;const w=Ht();mt(()=>{Yn(Kt+n).then(y=>{r(8,m=y.features),r(9,S=$t().projection(i))})});function D(y){console.log("Map:onFeatureMouseOver(feature:"+JSON.stringify(y)+")"),y.properties&&y.properties.id&&console.log("Map:onFeatureMouseOver(section:"+JSON.stringify(y.properties.id)+")"),w("featureMouseOver",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}function _(y){console.log("Map:onFeatureMouseOut(feature:"+JSON.stringify(y)+")"),y.properties&&y.properties.id&&console.log("Map:onFeatureMouseOut(id:"+JSON.stringify(y.properties.id)+")"),w("featureMouseOut",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}function k(y){console.log("Map:onFeatureClick(feature:"+JSON.stringify(y)+")"),w("featureClick",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}return e.$$set=y=>{"url"in y&&r(14,n=y.url),"projection"in y&&r(0,i=y.projection),"id"in y&&r(1,o=y.id),"interactive"in y&&r(2,l=y.interactive),"visible"in y&&r(3,s=y.visible),"geometryType"in y&&r(4,f=y.geometryType),"activeViewID"in y&&r(5,h=y.activeViewID),"activeEraID"in y&&r(6,a=y.activeEraID),"activeStopID"in y&&r(7,u=y.activeStopID)},[i,o,l,s,f,h,a,u,m,S,E,D,_,k,n,c,p]}class li extends $e{constructor(t){super(),xe(this,t,kr,Ir,Ke,{url:14,projection:0,id:1,interactive:2,visible:3,geometryType:4,activeViewID:5,activeEraID:6,activeStopID:7,onChapterMouseOver:15,onChapterMouseLeave:16})}get onChapterMouseOver(){return this.$$.ctx[15]}get onChapterMouseLeave(){return this.$$.ctx[16]}}function Dr(e){return e.k}function br(e){return[e.x,e.y]}function Dn(e){return function(){return e}}function Or(){let e=0,t=0,r=960,n=500,i=!0,o=!0,l=256,s=Dr,f=br,h=0;function a(){const u=+s.apply(this,arguments),c=f.apply(this,arguments),p=Math.log2(u/l),m=Math.round(Math.max(p+h,0)),S=Math.pow(2,p-m)*l,E=+c[0]-u/2,w=+c[1]-u/2,D=Math.max(i?0:-1/0,Math.floor((e-E)/S)),_=Math.min(i?1<<m:1/0,Math.ceil((r-E)/S)),k=Math.max(o?0:-1/0,Math.floor((t-w)/S)),y=Math.min(o?1<<m:1/0,Math.ceil((n-w)/S)),O=[];for(let P=k;P<y;++P)for(let L=D;L<_;++L)O.push([L,P,m]);return O.translate=[E/S,w/S],O.scale=S,O}return a.size=function(u){return arguments.length?(e=t=0,r=+u[0],n=+u[1],a):[r-e,n-t]},a.extent=function(u){return arguments.length?(e=+u[0][0],t=+u[0][1],r=+u[1][0],n=+u[1][1],a):[[e,t],[r,n]]},a.scale=function(u){return arguments.length?(s=typeof u=="function"?u:Dn(+u),a):s},a.translate=function(u){return arguments.length?(f=typeof u=="function"?u:Dn([+u[0],+u[1]]),a):f},a.zoomDelta=function(u){return arguments.length?(h=+u,a):h},a.tileSize=function(u){return arguments.length?(l=+u,a):l},a.clamp=function(u){return arguments.length?(i=o=!!u,a):i&&o},a.clampX=function(u){return arguments.length?(i=!!u,a):i},a.clampY=function(u){return arguments.length?(o=!!u,a):o},a}function bn(e,t,r){const n=e.slice();n[11]=t[r];const i=Nr(n[11],n[1]);return n[12]=i[0],n[13]=i[1],n}function On(e){let t;return{c(){t=x("image"),this.h()},l(r){t=ee(r,"image",{"xlink:href":!0,x:!0,y:!0,width:!0,height:!0,class:!0}),Y(t).forEach(T),this.h()},h(){si(t,"xlink:href",e[3](...e[11])),M(t,"x",e[12]),M(t,"y",e[13]),M(t,"width",e[2]),M(t,"height",e[2]),M(t,"class","svelte-511esr")},m(r,n){B(r,t,n)},p:ke,d(r){r&&T(t)}}}function zr(e){let t,r=me(e[1]),n=[];for(let i=0;i<r.length;i+=1)n[i]=On(bn(e,r,i));return{c(){t=x("g");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){t=ee(i,"g",{class:!0});var o=Y(t);for(let l=0;l<n.length;l+=1)n[l].l(o);o.forEach(T),this.h()},h(){M(t,"class","map-svg-g svelte-511esr"),ne(t,"visible",e[0])},m(i,o){B(i,t,o);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(t,null)},p(i,[o]){if(o&14){r=me(i[1]);let l;for(l=0;l<r.length;l+=1){const s=bn(i,r,l);n[l]?n[l].p(s,o):(n[l]=On(s),n[l].c(),n[l].m(t,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=r.length}o&1&&ne(t,"visible",i[0])},i:ke,o:ke,d(i){i&&T(t),Qe(n,i)}}}function Nr(e,t){const[r,n]=e,{translate:[i,o],scale:l}=t;return[(r+i)*l,(n+o)*l]}function Tr(e,t,r){let{urlPath:n}=t,{urlExtension:i}=t,{projection:o}=t,{visible:l=!1}=t;Ht(),mt(()=>{});const f=Or().size([2e3,1e3]).scale(o.scale()*2*Math.PI).translate(o([0,0]))(),{translate:[h,a],scale:u}=f,c=(p,m,S)=>`${Kt}${n}${S}/${p}/${m}.${i}`;return e.$$set=p=>{"urlPath"in p&&r(4,n=p.urlPath),"urlExtension"in p&&r(5,i=p.urlExtension),"projection"in p&&r(6,o=p.projection),"visible"in p&&r(0,l=p.visible)},[l,f,u,c,n,i,o]}class Cr extends $e{constructor(t){super(),xe(this,t,Tr,zr,Ke,{urlPath:4,urlExtension:5,projection:6,visible:0})}}function zn(e,t,r){const n=e.slice();return n[11]=t[r],n}function Nn(e){let t,r=e[11].properties[e[8]]+"",n,i,o,l=e[11].properties[e[8]]+"",s,f;return{c(){t=x("text"),n=Xe(r),o=x("text"),s=Xe(l),this.h()},l(h){t=ee(h,"text",{class:!0,transform:!0,dy:!0});var a=Y(t);n=Be(a,r),a.forEach(T),o=ee(h,"text",{transform:!0,dy:!0,class:!0});var u=Y(o);s=Be(u,l),u.forEach(T),this.h()},h(){M(t,"class","text-background svelte-1jk3k43"),M(t,"transform",i=`translate(${e[0](e[11].geometry.coordinates)})`),M(t,"dy",".35em"),M(o,"transform",f=`translate(${e[0](e[11].geometry.coordinates)})`),M(o,"dy",".35em"),M(o,"class","svelte-1jk3k43")},m(h,a){B(h,t,a),H(t,n),B(h,o,a),H(o,s)},p(h,a){a&768&&r!==(r=h[11].properties[h[8]]+"")&&qe(n,r),a&513&&i!==(i=`translate(${h[0](h[11].geometry.coordinates)})`)&&M(t,"transform",i),a&768&&l!==(l=h[11].properties[h[8]]+"")&&qe(s,l),a&513&&f!==(f=`translate(${h[0](h[11].geometry.coordinates)})`)&&M(o,"transform",f)},d(h){h&&(T(t),T(o))}}}function Tn(e){let t,r=e[11].geometry&&(!e[4]||e[11].properties.era==e[6])&&Nn(e);return{c(){r&&r.c(),t=ie()},l(n){r&&r.l(n),t=ie()},m(n,i){r&&r.m(n,i),B(n,t,i)},p(n,i){n[11].geometry&&(!n[4]||n[11].properties.era==n[6])?r?r.p(n,i):(r=Nn(n),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(n){n&&T(t),r&&r.d(n)}}}function Pr(e){let t,r,n=me(e[9]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Tn(zn(e,n,o));return{c(){t=x("g");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){t=ee(o,"g",{class:!0,id:!0});var l=Y(t);for(let s=0;s<i.length;s+=1)i[s].l(l);l.forEach(T),this.h()},h(){M(t,"class",r=`map-svg-g view-${e[5]} era-${e[6]} stop-${e[7]} svelte-1jk3k43`),M(t,"id",e[1]),ne(t,"visible",e[3]),ne(t,"hidden",!e[3]),ne(t,"interactive",e[2])},m(o,l){B(o,t,l);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[l]){if(l&849){n=me(o[9]);let s;for(s=0;s<n.length;s+=1){const f=zn(o,n,s);i[s]?i[s].p(f,l):(i[s]=Tn(f),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}l&224&&r!==(r=`map-svg-g view-${o[5]} era-${o[6]} stop-${o[7]} svelte-1jk3k43`)&&M(t,"class",r),l&2&&M(t,"id",o[1]),l&232&&ne(t,"visible",o[3]),l&232&&ne(t,"hidden",!o[3]),l&228&&ne(t,"interactive",o[2])},i:ke,o:ke,d(o){o&&T(t),Qe(i,o)}}}function Lr(e,t,r){let{path:n}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,{filterOnContext:f=!1}=t,{activeViewID:h}=t,{activeEraID:a}=t,{activeStopID:u}=t,{labelField:c="label"}=t,p=[];return mt(()=>{console.log(`Labels:onMount(id:${o})`),Yn(Kt+n).then(m=>{r(9,p=m.features),r(10,n=$t().projection(i))})}),e.$$set=m=>{"path"in m&&r(10,n=m.path),"projection"in m&&r(0,i=m.projection),"id"in m&&r(1,o=m.id),"interactive"in m&&r(2,l=m.interactive),"visible"in m&&r(3,s=m.visible),"filterOnContext"in m&&r(4,f=m.filterOnContext),"activeViewID"in m&&r(5,h=m.activeViewID),"activeEraID"in m&&r(6,a=m.activeEraID),"activeStopID"in m&&r(7,u=m.activeStopID),"labelField"in m&&r(8,c=m.labelField)},[i,o,l,s,f,h,a,u,c,p,n]}class Rr extends $e{constructor(t){super(),xe(this,t,Lr,Pr,Ke,{path:10,projection:0,id:1,interactive:2,visible:3,filterOnContext:4,activeViewID:5,activeEraID:6,activeStopID:7,labelField:8})}}function ai(e,t){const r=new IntersectionObserver(n,{threshold:1});r.observe(e);function n(i){const o=i.find(l=>l.isIntersecting);if(o){const l=o.target.dataset.id;t(l)}}return{destroy:()=>r.disconnect()}}function Cn(e,t,r){const n=e.slice();return n[25]=t[r],n}function Pn(e,t,r){const n=e.slice();return n[28]=t[r],n}function Ln(e){let t,r,n=e[0].eras[e[5]].shortLabel+"",i,o,l,s=e[0].eras[e[5]].longLabel+"",f;return{c(){t=ge("div"),r=ge("div"),i=Xe(n),o=Ce(),l=ge("div"),f=Xe(s),this.h()},l(h){t=ve(h,"DIV",{id:!0,class:!0});var a=Y(t);r=ve(a,"DIV",{id:!0,class:!0});var u=Y(r);i=Be(u,n),u.forEach(T),o=Pe(a),l=ve(a,"DIV",{id:!0,class:!0});var c=Y(l);f=Be(c,s),c.forEach(T),a.forEach(T),this.h()},h(){M(r,"id","era-short-label"),M(r,"class","svelte-7d3ou1"),M(l,"id","era-long-label"),M(l,"class","svelte-7d3ou1"),M(t,"id","story-context-container"),M(t,"class","svelte-7d3ou1")},m(h,a){B(h,t,a),H(t,r),H(r,i),H(t,o),H(t,l),H(l,f)},p(h,a){a&33&&n!==(n=h[0].eras[h[5]].shortLabel+"")&&qe(i,n),a&33&&s!==(s=h[0].eras[h[5]].longLabel+"")&&qe(f,s)},d(h){h&&T(t)}}}function Rn(e){let t,r,n,i=e[0].views[e[4]].name+"",o,l,s,f,h=me(e[0].views[e[4]].story),a=[];for(let u=0;u<h.length;u+=1)a[u]=Fn(Pn(e,h,u));return{c(){t=ge("div"),r=ge("div"),n=ge("h1"),o=Xe(i),l=Ce();for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){t=ve(u,"DIV",{id:!0,class:!0});var c=Y(t);r=ve(c,"DIV",{id:!0,class:!0});var p=Y(r);n=ve(p,"H1",{class:!0});var m=Y(n);o=Be(m,i),m.forEach(T),l=Pe(p);for(let S=0;S<a.length;S+=1)a[S].l(p);p.forEach(T),c.forEach(T),this.h()},h(){M(n,"class","svelte-7d3ou1"),M(r,"id","story-narrative"),M(r,"class","svelte-7d3ou1"),M(t,"id","story-narrative-container"),M(t,"class","svelte-7d3ou1")},m(u,c){B(u,t,c),H(t,r),H(r,n),H(n,o),H(r,l);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(r,null);s||(f=An(ai.call(null,n,e[12])),s=!0)},p(u,c){if(c&17&&i!==(i=u[0].views[u[4]].name+"")&&qe(o,i),c&4113){h=me(u[0].views[u[4]].story);let p;for(p=0;p<h.length;p+=1){const m=Pn(u,h,p);a[p]?a[p].p(m,c):(a[p]=Fn(m),a[p].c(),a[p].m(r,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=h.length}},d(u){u&&T(t),Qe(a,u),s=!1,f()}}}function Fr(e){let t,r,n=e[28].text+"";return{c(){t=ge("p"),r=new Zt(!1),this.h()},l(i){t=ve(i,"P",{});var o=Y(t);r=Wt(o,!1),o.forEach(T),this.h()},h(){r.a=null},m(i,o){B(i,t,o),r.m(n,t)},p(i,o){o&17&&n!==(n=i[28].text+"")&&r.p(n)},d(i){i&&T(t)}}}function Vr(e){let t;function r(o,l){return o[28].stop?jr:Jr}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),B(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function Jr(e){let t,r,n=e[28].text+"";return{c(){t=ge("h2"),r=new Zt(!1),this.h()},l(i){t=ve(i,"H2",{class:!0});var o=Y(t);r=Wt(o,!1),o.forEach(T),this.h()},h(){r.a=null,M(t,"class","svelte-7d3ou1")},m(i,o){B(i,t,o),r.m(n,t)},p(i,o){o&17&&n!==(n=i[28].text+"")&&r.p(n)},d(i){i&&T(t)}}}function jr(e){let t,r,n=e[28].text+"",i,o,l;return{c(){t=ge("h2"),r=new Zt(!1),this.h()},l(s){t=ve(s,"H2",{"data-id":!0,class:!0});var f=Y(t);r=Wt(f,!1),f.forEach(T),this.h()},h(){r.a=null,M(t,"data-id",i=e[28].stop),M(t,"class","svelte-7d3ou1")},m(s,f){B(s,t,f),r.m(n,t),o||(l=An(ai.call(null,t,e[12])),o=!0)},p(s,f){f&17&&n!==(n=s[28].text+"")&&r.p(n),f&17&&i!==(i=s[28].stop)&&M(t,"data-id",i)},d(s){s&&T(t),o=!1,l()}}}function Fn(e){let t;function r(o,l){if(o[28].type=="h")return Vr;if(o[28].type=="p")return Fr}let n=r(e),i=n&&n(e);return{c(){i&&i.c(),t=ie()},l(o){i&&i.l(o),t=ie()},m(o,l){i&&i.m(o,l),B(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i&&i.d(o)}}}function Vn(e){let t,r,n=me(Object.values(e[0].maps)),i=[];for(let l=0;l<n.length;l+=1)i[l]=Jn(Cn(e,n,l));const o=l=>re(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();t=ie()},l(l){for(let s=0;s<i.length;s+=1)i[s].l(l);t=ie()},m(l,s){for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,s);B(l,t,s),r=!0},p(l,s){if(s&3827){n=me(Object.values(l[0].maps));let f;for(f=0;f<n.length;f+=1){const h=Cn(l,n,f);i[f]?(i[f].p(h,s),te(i[f],1)):(i[f]=Jn(h),i[f].c(),te(i[f],1),i[f].m(t.parentNode,t))}for(dt(),f=n.length;f<i.length;f+=1)o(f);_t()}},i(l){if(!r){for(let s=0;s<n.length;s+=1)te(i[s]);r=!0}},o(l){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)re(i[s]);r=!1},d(l){l&&T(t),Qe(i,l)}}}function Ar(e){let t,r;return t=new Rr({props:{activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],path:e[25].path,id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id),labelField:e[25].labelField,filterOnContext:e[25].filterOnContext,interactive:e[25].interactive}}),{c(){Me(t.$$.fragment)},l(n){Ee(t.$$.fragment,n)},m(n,i){Se(t,n,i),r=!0},p(n,i){const o={};i&16&&(o.activeViewID=n[4]),i&32&&(o.activeEraID=n[5]),i&64&&(o.activeStopID=n[6]),i&1&&(o.path=n[25].path),i&1&&(o.id=n[25].id),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),i&1&&(o.labelField=n[25].labelField),i&1&&(o.filterOnContext=n[25].filterOnContext),i&1&&(o.interactive=n[25].interactive),t.$set(o)},i(n){r||(te(t.$$.fragment,n),r=!0)},o(n){re(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function Ur(e){let t,r;return t=new Cr({props:{urlPath:e[25].urlPath,urlExtension:e[25].urlExtension,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id)}}),{c(){Me(t.$$.fragment)},l(n){Ee(t.$$.fragment,n)},m(n,i){Se(t,n,i),r=!0},p(n,i){const o={};i&1&&(o.urlPath=n[25].urlPath),i&1&&(o.urlExtension=n[25].urlExtension),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),t.$set(o)},i(n){r||(te(t.$$.fragment,n),r=!0)},o(n){re(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function Yr(e){let t,r,n,i;const o=[Br,Xr],l=[];function s(f,h){return f[25].interactive?0:1}return t=s(e),r=l[t]=o[t](e),{c(){r.c(),n=ie()},l(f){r.l(f),n=ie()},m(f,h){l[t].m(f,h),B(f,n,h),i=!0},p(f,h){let a=t;t=s(f),t===a?l[t].p(f,h):(dt(),re(l[a],1,1,()=>{l[a]=null}),_t(),r=l[t],r?r.p(f,h):(r=l[t]=o[t](f),r.c()),te(r,1),r.m(n.parentNode,n))},i(f){i||(te(r),i=!0)},o(f){re(r),i=!1},d(f){f&&T(n),l[t].d(f)}}}function Xr(e){let t,r;return t=new li({props:{activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],url:e[25].url,geometryType:e[25].geometryType?e[25].geometryType:"polygons",id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id)}}),{c(){Me(t.$$.fragment)},l(n){Ee(t.$$.fragment,n)},m(n,i){Se(t,n,i),r=!0},p(n,i){const o={};i&16&&(o.activeViewID=n[4]),i&32&&(o.activeEraID=n[5]),i&64&&(o.activeStopID=n[6]),i&1&&(o.url=n[25].url),i&1&&(o.geometryType=n[25].geometryType?n[25].geometryType:"polygons"),i&1&&(o.id=n[25].id),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),t.$set(o)},i(n){r||(te(t.$$.fragment,n),r=!0)},o(n){re(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function Br(e){let t,r,n={activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],url:e[25].url,geometryType:e[25].geometryType?e[25].geometryType:"polygons",id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id),interactive:!0};return t=new li({props:n}),e[16](t),t.$on("featureMouseOver",e[9]),t.$on("featureMouseOut",e[10]),t.$on("featureClick",e[11]),{c(){Me(t.$$.fragment)},l(i){Ee(t.$$.fragment,i)},m(i,o){Se(t,i,o),r=!0},p(i,o){const l={};o&16&&(l.activeViewID=i[4]),o&32&&(l.activeEraID=i[5]),o&64&&(l.activeStopID=i[6]),o&1&&(l.url=i[25].url),o&1&&(l.geometryType=i[25].geometryType?i[25].geometryType:"polygons"),o&1&&(l.id=i[25].id),o&128&&(l.projection=i[7]),o&81&&(l.visible=i[6]==null&&i[0].views[i[4]].maps&&i[0].views[i[4]].maps.includes(i[25].id)||i[6]&&i[0].views[i[4]].stops[i[6]].maps&&i[0].views[i[4]].stops[i[6]].maps.includes(i[25].id)),t.$set(l)},i(i){r||(te(t.$$.fragment,i),r=!0)},o(i){re(t.$$.fragment,i),r=!1},d(i){e[16](null),Ie(t,i)}}}function Jn(e){let t,r,n,i;const o=[Yr,Ur,Ar],l=[];function s(f,h){return f[25].type=="shapefile"?0:f[25].type=="tile"?1:f[25].type=="label"?2:-1}return~(t=s(e))&&(r=l[t]=o[t](e)),{c(){r&&r.c(),n=ie()},l(f){r&&r.l(f),n=ie()},m(f,h){~t&&l[t].m(f,h),B(f,n,h),i=!0},p(f,h){let a=t;t=s(f),t===a?~t&&l[t].p(f,h):(r&&(dt(),re(l[a],1,1,()=>{l[a]=null}),_t()),~t?(r=l[t],r?r.p(f,h):(r=l[t]=o[t](f),r.c()),te(r,1),r.m(n.parentNode,n)):r=null)},i(f){i||(te(r),i=!0)},o(f){re(r),i=!1},d(f){f&&T(n),~t&&l[t].d(f)}}}function qr(e){let t,r,n,i,o,l,s,f=e[5]&&Ln(e),h=e[0].views[e[4]].story&&Rn(e),a=!e[8]&&Vn(e);return{c(){t=ge("div"),f&&f.c(),r=Ce(),h&&h.c(),n=Ce(),i=x("svg"),o=x("g"),a&&a.c(),this.h()},l(u){t=ve(u,"DIV",{id:!0,class:!0,style:!0});var c=Y(t);f&&f.l(c),r=Pe(c),h&&h.l(c),n=Pe(c),i=ee(c,"svg",{id:!0,class:!0});var p=Y(i);o=ee(p,"g",{});var m=Y(o);a&&a.l(m),m.forEach(T),p.forEach(T),c.forEach(T),this.h()},h(){M(i,"id","map-svg"),M(i,"class","svelte-7d3ou1"),ne(i,"story",e[0].views[e[4]].story!=null),M(t,"id","map"),M(t,"class",l=`view-${e[4]} era-${e[5]} stop-${e[6]} svelte-7d3ou1`),Mt(t,"--color-era-urban-industrial",It.colorEraUrbanIndustrial),Mt(t,"--color-era-pre-1600s",It.colorEraPre1600s),Mt(t,"--color-era-early-european-settlement",It.colorEraEarlyEuropeanSettlement)},m(u,c){B(u,t,c),f&&f.m(t,null),H(t,r),h&&h.m(t,null),H(t,n),H(t,i),H(i,o),a&&a.m(o,null),e[17](o),e[18](i),s=!0},p(u,[c]){u[5]?f?f.p(u,c):(f=Ln(u),f.c(),f.m(t,r)):f&&(f.d(1),f=null),u[0].views[u[4]].story?h?h.p(u,c):(h=Rn(u),h.c(),h.m(t,n)):h&&(h.d(1),h=null),u[8]?a&&(dt(),re(a,1,1,()=>{a=null}),_t()):a?(a.p(u,c),c&256&&te(a,1)):(a=Vn(u),a.c(),te(a,1),a.m(o,null)),(!s||c&17)&&ne(i,"story",u[0].views[u[4]].story!=null),(!s||c&112&&l!==(l=`view-${u[4]} era-${u[5]} stop-${u[6]} svelte-7d3ou1`))&&M(t,"class",l)},i(u){s||(te(a),s=!0)},o(u){re(a),s=!1},d(u){u&&T(t),f&&f.d(),h&&h.d(),a&&a.d(),e[17](null),e[18](null)}}}const Gr=4e3;function jn(e){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[e.nwLng,e.nwLat],[e.seLng,e.nwLat],[e.seLng,e.seLat],[e.nwLng,e.seLat],[e.nwLng,e.nwLat]]],type:"Polygon"}}]}}function Hr(e,t,r){let{story:n={}}=t;function i(z){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(z.detail)+")"),s&&s.onChapterMouseOver(z)}function o(z){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(z.detail)+")"),s&&s.onChapterMouseLeave(z)}function l(z){console.log(`Maps:onNavigate(event:${JSON.stringify(z.detail)})`),r(4,p=z.detail.viewID),r(5,m=z.detail.eraID),r(6,S=null),n.views[p].extent&&_(n.views[p].extent)}let s,f,h,a,u,c,p=n.intialView,m=null,S=null,E,w=!0;mt(()=>{console.log("Maps:onMount()"),a=parseInt(ae(f).style("width"),10),u=parseInt(ae(f).style("height"),10),console.log(`Map width: ${a}; height: ${u}`),r(7,E=cr().rotate([74,0]).fitSize([a,u],jn(n.views[n.intialView].extent))),r(8,w=!1)}),c=yr().on("zoom",k);const D=Ht();function _(z){console.log(`Maps:moveMap(extent:${JSON.stringify(z)}`),a=parseInt(ae("#map-svg").style("width"),10),u=parseInt(ae("#map-svg").style("height"),10),console.log(`Map width: ${a}; height: ${u}`);const U=jn(z);var g=$t().projection(E);const v=g.bounds(U),[[d,I],[b,N]]=v;ae(h).transition().duration(Gr).ease(gi).call(c.transform,Qt.translate(a/2,u/2).scale(.9/Math.max((b-d)/a,(N-I)/u)).translate(-(d+b)/2,-(I+N)/2))}function k(z){const{transform:U}=z;ae(h).attr("transform",U)}function y(z){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(z.detail)+")"),D("featureMouseOver",z.detail)}function O(z){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(z.detail)+")"),D("featureMouseOut",z.detail)}function P(z){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(z.detail)+")"),D("featureClick",z.detail)}function L(z){console.log(`Maps:onStop(stopID:${z})`),r(6,S=z),z?n.views[p].stops&&n.views[p].stops[S]&&_(n.views[p].stops[S].extent):_(n.views[p].extent)}function F(z){Te[z?"unshift":"push"](()=>{s=z,r(1,s)})}function j(z){Te[z?"unshift":"push"](()=>{h=z,r(3,h)})}function C(z){Te[z?"unshift":"push"](()=>{f=z,r(2,f)})}return e.$$set=z=>{"story"in z&&r(0,n=z.story)},[n,s,f,h,p,m,S,E,w,y,O,P,L,i,o,l,F,j,C]}class Zr extends $e{constructor(t){super(),xe(this,t,Hr,qr,Ke,{story:0,onChapterMouseOver:13,onChapterMouseLeave:14,onNavigate:15})}get onChapterMouseOver(){return this.$$.ctx[13]}get onChapterMouseLeave(){return this.$$.ctx[14]}get onNavigate(){return this.$$.ctx[15]}}function Wr(e){let t,r,n,i,o,l,s,f,h={};t=new vi({props:h}),e[10](t),t.$on("navigate",e[8]);let a={story:Ye};n=new Zr({props:a}),e[11](n),n.$on("featureMouseOver",e[3]),n.$on("featureMouseOut",e[4]),n.$on("featureClick",e[7]);let u={eras:Ye.eras};return o=new mi({props:u}),e[12](o),o.$on("chapterMouseOver",e[5]),o.$on("chapterMouseLeave",e[6]),o.$on("navigate",e[8]),{c(){Me(t.$$.fragment),r=Ce(),Me(n.$$.fragment),i=Ce(),Me(o.$$.fragment)},l(c){Ee(t.$$.fragment,c),r=Pe(c),Ee(n.$$.fragment,c),i=Pe(c),Ee(o.$$.fragment,c)},m(c,p){Se(t,c,p),B(c,r,p),Se(n,c,p),B(c,i,p),Se(o,c,p),l=!0,s||(f=ot(window,"popstate",e[9]),s=!0)},p(c,[p]){const m={};t.$set(m);const S={};n.$set(S);const E={};o.$set(E)},i(c){l||(te(t.$$.fragment,c),te(n.$$.fragment,c),te(o.$$.fragment,c),l=!0)},o(c){re(t.$$.fragment,c),re(n.$$.fragment,c),re(o.$$.fragment,c),l=!1},d(c){c&&(T(r),T(i)),e[10](null),Ie(t,c),e[11](null),Ie(n,c),e[12](null),Ie(o,c),s=!1,f()}}}function Kr(e,t,r){let n;fi(e,hi,_=>r(17,n=_));let i,o,l,s="intro";Ye.views[s];let f=null;function h(_){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureMouseOver(_)}function a(_){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureMouseOut(_)}function u(_){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(_.detail)+")"),l.onChapterMouseOver(_)}function c(_){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(_.detail)+")"),l.onChapterMouseLeave(_)}function p(_){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureClick(_)}function m(_,k=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(_.detail)})`),s=_.detail.viewID,Ye.views[s],f=_.detail.eraID,f&&Ye.eras[f],i.navigate(_),l.onNavigate(_),o.onNavigate(_),k&&ci(`#/view/${_.detail.viewID}`,{state:_.detail})}function S(_){_.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(_.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(n.state)}`),_.state["sveltekit:states"].viewID&&m({detail:{..._.state["sveltekit:states"]}},!1))}function E(_){Te[_?"unshift":"push"](()=>{i=_,r(0,i)})}function w(_){Te[_?"unshift":"push"](()=>{l=_,r(2,l)})}function D(_){Te[_?"unshift":"push"](()=>{o=_,r(1,o)})}return[i,o,l,h,a,u,c,p,m,S,E,w,D]}class no extends $e{constructor(t){super(),xe(this,t,Kr,Wr,Ke,{})}}export{no as component};
