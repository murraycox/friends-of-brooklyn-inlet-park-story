import{s as He,R as ee,S as te,b as j,f as T,q as M,T as re,i as X,h as Q,n as ke,U as Ze,V as Bt,y as mt,w as ne,r as rt,W as nt,F as wt,C as li,X as ui,t as ot,d as lt,j as ut,e as ge,a as Ce,c as ve,g as Pe,Y as Jn,z as Te,H as Gt,p as Ht,k as ai}from"../chunks/scheduler.BwjH7zTA.js";import{S as We,i as Ke,t as x,g as dt,a as ie,e as _t,c as Me,b as Se,m as Ee,d as Ie}from"../chunks/index.BU9U6aD7.js";import{b as Zt,g as si}from"../chunks/entry.foHmfAWu.js";import{p as fi}from"../chunks/stores.B3z62vEf.js";import{b as ue,d as ci,i as Wt,T as Mt,c as St,e as me,f as hi,N as pi,s as je,a as gi}from"../chunks/story.CqNYnOhF.js";class De{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=r[i],l=t+o,s=Math.abs(t)<Math.abs(o)?t-(l-o):o-(l-t);s&&(r[n++]=s),t=l}return r[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let r=this._n,n,i,o,l=0;if(r>0){for(l=t[--r];r>0&&(n=l,i=t[--r],l=n+i,o=i-(l-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=l+i,i==n-l&&(l=n))}return l}}function*vi(e){for(const t of e)yield*t}function qn(e){return Array.from(vi(e))}function mi(e){let t;for(;t=e.sourceEvent;)e=t;return e}function we(e,t){if(e=mi(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Ot={capture:!0,passive:!1};function bt(e){e.preventDefault(),e.stopImmediatePropagation()}function di(e){var t=e.document.documentElement,r=ue(e).on("dragstart.drag",bt,Ot);"onselectstart"in t?r.on("selectstart.drag",bt,Ot):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function _i(e,t){var r=e.document.documentElement,n=ue(e).on("dragstart.drag",null);t&&(n.on("click.drag",bt,Ot),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var yi=1e-12;function en(e){return((e=Math.exp(e))+1/e)/2}function wi(e){return((e=Math.exp(e))-1/e)/2}function Mi(e){return((e=Math.exp(2*e))-1)/(e+1)}const Si=function e(t,r,n){function i(o,l){var s=o[0],c=o[1],h=o[2],u=l[0],a=l[1],f=l[2],p=u-s,d=a-c,E=p*p+d*d,S,w;if(E<yi)w=Math.log(f/h)/t,S=function(P){return[s+P*p,c+P*d,h*Math.exp(t*P*w)]};else{var D=Math.sqrt(E),_=(f*f-h*h+n*E)/(2*h*r*D),k=(f*f-h*h-n*E)/(2*f*r*D),y=Math.log(Math.sqrt(_*_+1)-_),O=Math.log(Math.sqrt(k*k+1)-k);w=(O-y)/t,S=function(P){var R=P*w,F=en(y),q=h/(r*D)*(F*Mi(t*R+y)-wi(y));return[s+q*p,c+q*d,h*F/en(t*R+y)]}}return S.duration=w*1e3*t/Math.SQRT2,S}return i.rho=function(o){var l=Math.max(.001,+o),s=l*l,c=s*s;return e(l,s,c)},i}(Math.SQRT2,2,4);function Ei(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(!(e.status===204||e.status===205))return e.json()}function An(e,t){return fetch(e,t).then(Ei)}var U=1e-6,Ii=1e-12,J=Math.PI,oe=J/2,tn=J/4,ae=J*2,le=180/J,K=J/180,B=Math.abs,Yn=Math.atan,Ue=Math.atan2,H=Math.cos,ki=Math.exp,Di=Math.log,Z=Math.sin,zi=Math.sign||function(e){return e>0?1:e<0?-1:0},Oe=Math.sqrt,Oi=Math.tan;function bi(e){return e>1?0:e<-1?J:Math.acos(e)}function Xe(e){return e>1?oe:e<-1?-oe:Math.asin(e)}function fe(){}function at(e,t){e&&rn.hasOwnProperty(e.type)&&rn[e.type](e,t)}var nn={Feature:function(e,t){at(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)at(r[n].geometry,t)}},rn={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){Nt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)Nt(r[n],t,0)},Polygon:function(e,t){on(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)on(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)at(r[n],t)}};function Nt(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function on(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)Nt(e[r],t,1);t.polygonEnd()}function be(e,t){e&&nn.hasOwnProperty(e.type)?nn[e.type](e,t):at(e,t)}function Tt(e){return[Ue(e[1],e[0]),Xe(e[2])]}function Re(e){var t=e[0],r=e[1],n=H(r);return[n*H(t),n*Z(t),Z(r)]}function Qe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function st(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Et(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function $e(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ct(e){var t=Oe(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Pt(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function Rt(e,t){return B(e)>J&&(e-=Math.round(e/ae)*ae),[e,t]}Rt.invert=Rt;function jn(e,t,r){return(e%=ae)?t||r?Pt(un(e),an(t,r)):un(e):t||r?an(t,r):Rt}function ln(e){return function(t,r){return t+=e,B(t)>J&&(t-=Math.round(t/ae)*ae),[t,r]}}function un(e){var t=ln(e);return t.invert=ln(-e),t}function an(e,t){var r=H(e),n=Z(e),i=H(t),o=Z(t);function l(s,c){var h=H(c),u=H(s)*h,a=Z(s)*h,f=Z(c),p=f*r+u*n;return[Ue(a*i-p*o,u*r-f*n),Xe(p*i+a*o)]}return l.invert=function(s,c){var h=H(c),u=H(s)*h,a=Z(s)*h,f=Z(c),p=f*i-a*o;return[Ue(a*i+f*o,u*r+p*n),Xe(p*r-u*n)]},l}function Ni(e){e=jn(e[0]*K,e[1]*K,e.length>2?e[2]*K:0);function t(r){return r=e(r[0]*K,r[1]*K),r[0]*=le,r[1]*=le,r}return t.invert=function(r){return r=e.invert(r[0]*K,r[1]*K),r[0]*=le,r[1]*=le,r},t}function Ti(e,t,r,n,i,o){if(r){var l=H(t),s=Z(t),c=n*r;i==null?(i=t+n*ae,o=t-c/2):(i=sn(l,i),o=sn(l,o),(n>0?i<o:i>o)&&(i+=n*ae));for(var h,u=i;n>0?u>o:u<o;u-=c)h=Tt([l,-s*H(u),-s*Z(u)]),e.point(h[0],h[1])}}function sn(e,t){t=Re(t),t[0]-=e,Ct(t);var r=bi(-t[1]);return((-t[2]<0?-r:r)+ae-U)%ae}function Un(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:fe,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function it(e,t){return B(e[0]-t[0])<U&&B(e[1]-t[1])<U}function xe(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Xn(e,t,r,n,i){var o=[],l=[],s,c;if(e.forEach(function(d){if(!((E=d.length-1)<=0)){var E,S=d[0],w=d[E],D;if(it(S,w)){if(!S[2]&&!w[2]){for(i.lineStart(),s=0;s<E;++s)i.point((S=d[s])[0],S[1]);i.lineEnd();return}w[0]+=2*U}o.push(D=new xe(S,d,null,!0)),l.push(D.o=new xe(S,null,D,!1)),o.push(D=new xe(w,d,null,!1)),l.push(D.o=new xe(w,null,D,!0))}}),!!o.length){for(l.sort(t),fn(o),fn(l),s=0,c=l.length;s<c;++s)l[s].e=r=!r;for(var h=o[0],u,a;;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;u=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(s=0,c=u.length;s<c;++s)i.point((a=u[s])[0],a[1]);else n(f.x,f.n.x,1,i);f=f.n}else{if(p)for(u=f.p.z,s=u.length-1;s>=0;--s)i.point((a=u[s])[0],a[1]);else n(f.x,f.p.x,-1,i);f=f.p}f=f.o,u=f.z,p=!p}while(!f.v);i.lineEnd()}}}function fn(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function It(e){return B(e[0])<=J?e[0]:zi(e[0])*((B(e[0])+J)%ae-J)}function Ci(e,t){var r=It(t),n=t[1],i=Z(n),o=[Z(r),-H(r),0],l=0,s=0,c=new De;i===1?n=oe+U:i===-1&&(n=-oe-U);for(var h=0,u=e.length;h<u;++h)if(f=(a=e[h]).length)for(var a,f,p=a[f-1],d=It(p),E=p[1]/2+tn,S=Z(E),w=H(E),D=0;D<f;++D,d=k,S=O,w=P,p=_){var _=a[D],k=It(_),y=_[1]/2+tn,O=Z(y),P=H(y),R=k-d,F=R>=0?1:-1,q=F*R,C=q>J,b=S*O;if(c.add(Ue(b*F*Z(q),w*P+b*H(q))),l+=C?R+F*ae:R,C^d>=r^k>=r){var Y=st(Re(p),Re(_));Ct(Y);var g=st(o,Y);Ct(g);var v=(C^R>=0?-1:1)*Xe(g[2]);(n>v||n===v&&(Y[0]||Y[1]))&&(s+=C^R>=0?1:-1)}}return(l<-U||l<U&&c<-Ii)^s&1}function Bn(e,t,r,n){return function(i){var o=t(i),l=Un(),s=t(l),c=!1,h,u,a,f={point:p,lineStart:E,lineEnd:S,polygonStart:function(){f.point=w,f.lineStart=D,f.lineEnd=_,u=[],h=[]},polygonEnd:function(){f.point=p,f.lineStart=E,f.lineEnd=S,u=qn(u);var k=Ci(h,n);u.length?(c||(i.polygonStart(),c=!0),Xn(u,Ri,k,r,i)):k&&(c||(i.polygonStart(),c=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),c&&(i.polygonEnd(),c=!1),u=h=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(k,y){e(k,y)&&i.point(k,y)}function d(k,y){o.point(k,y)}function E(){f.point=d,o.lineStart()}function S(){f.point=p,o.lineEnd()}function w(k,y){a.push([k,y]),s.point(k,y)}function D(){s.lineStart(),a=[]}function _(){w(a[0][0],a[0][1]),s.lineEnd();var k=s.clean(),y=l.result(),O,P=y.length,R,F,q;if(a.pop(),h.push(a),a=null,!!P){if(k&1){if(F=y[0],(R=F.length-1)>0){for(c||(i.polygonStart(),c=!0),i.lineStart(),O=0;O<R;++O)i.point((q=F[O])[0],q[1]);i.lineEnd()}return}P>1&&k&2&&y.push(y.pop().concat(y.shift())),u.push(y.filter(Pi))}}return f}}function Pi(e){return e.length>1}function Ri(e,t){return((e=e.x)[0]<0?e[1]-oe-U:oe-e[1])-((t=t.x)[0]<0?t[1]-oe-U:oe-t[1])}const cn=Bn(function(){return!0},Li,Vi,[-J,-oe]);function Li(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,l){var s=o>0?J:-J,c=B(o-t);B(c-J)<U?(e.point(t,r=(r+l)/2>0?oe:-oe),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(o,r),i=0):n!==s&&c>=J&&(B(t-n)<U&&(t-=n*U),B(o-s)<U&&(o-=s*U),r=Fi(t,r,o,l),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),i=0),e.point(t=o,r=l),n=s},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Fi(e,t,r,n){var i,o,l=Z(e-r);return B(l)>U?Yn((Z(t)*(o=H(n))*Z(r)-Z(n)*(i=H(t))*Z(e))/(i*o*l)):(t+n)/2}function Vi(e,t,r,n){var i;if(e==null)i=r*oe,n.point(-J,i),n.point(0,i),n.point(J,i),n.point(J,0),n.point(J,-i),n.point(0,-i),n.point(-J,-i),n.point(-J,0),n.point(-J,i);else if(B(e[0]-t[0])>U){var o=e[0]<t[0]?J:-J;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function Ji(e){var t=H(e),r=2*K,n=t>0,i=B(t)>U;function o(u,a,f,p){Ti(p,e,r,f,u,a)}function l(u,a){return H(u)*H(a)>t}function s(u){var a,f,p,d,E;return{lineStart:function(){d=p=!1,E=1},point:function(S,w){var D=[S,w],_,k=l(S,w),y=n?k?0:h(S,w):k?h(S+(S<0?J:-J),w):0;if(!a&&(d=p=k)&&u.lineStart(),k!==p&&(_=c(a,D),(!_||it(a,_)||it(D,_))&&(D[2]=1)),k!==p)E=0,k?(u.lineStart(),_=c(D,a),u.point(_[0],_[1])):(_=c(a,D),u.point(_[0],_[1],2),u.lineEnd()),a=_;else if(i&&a&&n^k){var O;!(y&f)&&(O=c(D,a,!0))&&(E=0,n?(u.lineStart(),u.point(O[0][0],O[0][1]),u.point(O[1][0],O[1][1]),u.lineEnd()):(u.point(O[1][0],O[1][1]),u.lineEnd(),u.lineStart(),u.point(O[0][0],O[0][1],3)))}k&&(!a||!it(a,D))&&u.point(D[0],D[1]),a=D,p=k,f=y},lineEnd:function(){p&&u.lineEnd(),a=null},clean:function(){return E|(d&&p)<<1}}}function c(u,a,f){var p=Re(u),d=Re(a),E=[1,0,0],S=st(p,d),w=Qe(S,S),D=S[0],_=w-D*D;if(!_)return!f&&u;var k=t*w/_,y=-t*D/_,O=st(E,S),P=$e(E,k),R=$e(S,y);Et(P,R);var F=O,q=Qe(P,F),C=Qe(F,F),b=q*q-C*(Qe(P,P)-1);if(!(b<0)){var Y=Oe(b),g=$e(F,(-q-Y)/C);if(Et(g,P),g=Tt(g),!f)return g;var v=u[0],m=a[0],I=u[1],z=a[1],N;m<v&&(N=v,v=m,m=N);var L=m-v,V=B(L-J)<U,A=V||L<U;if(!V&&z<I&&(N=I,I=z,z=N),A?V?I+z>0^g[1]<(B(g[0]-v)<U?I:z):I<=g[1]&&g[1]<=z:L>J^(v<=g[0]&&g[0]<=m)){var W=$e(F,(-q+Y)/C);return Et(W,P),[g,Tt(W)]}}}function h(u,a){var f=n?e:J-e,p=0;return u<-f?p|=1:u>f&&(p|=2),a<-f?p|=4:a>f&&(p|=8),p}return Bn(l,s,o,n?[0,-e]:[-J,e-J])}function qi(e,t,r,n,i,o){var l=e[0],s=e[1],c=t[0],h=t[1],u=0,a=1,f=c-l,p=h-s,d;if(d=r-l,!(!f&&d>0)){if(d/=f,f<0){if(d<u)return;d<a&&(a=d)}else if(f>0){if(d>a)return;d>u&&(u=d)}if(d=i-l,!(!f&&d<0)){if(d/=f,f<0){if(d>a)return;d>u&&(u=d)}else if(f>0){if(d<u)return;d<a&&(a=d)}if(d=n-s,!(!p&&d>0)){if(d/=p,p<0){if(d<u)return;d<a&&(a=d)}else if(p>0){if(d>a)return;d>u&&(u=d)}if(d=o-s,!(!p&&d<0)){if(d/=p,p<0){if(d>a)return;d>u&&(u=d)}else if(p>0){if(d<u)return;d<a&&(a=d)}return u>0&&(e[0]=l+u*f,e[1]=s+u*p),a<1&&(t[0]=l+a*f,t[1]=s+a*p),!0}}}}}var Ve=1e9,et=-Ve;function Ai(e,t,r,n){function i(h,u){return e<=h&&h<=r&&t<=u&&u<=n}function o(h,u,a,f){var p=0,d=0;if(h==null||(p=l(h,a))!==(d=l(u,a))||c(h,u)<0^a>0)do f.point(p===0||p===3?e:r,p>1?n:t);while((p=(p+a+4)%4)!==d);else f.point(u[0],u[1])}function l(h,u){return B(h[0]-e)<U?u>0?0:3:B(h[0]-r)<U?u>0?2:1:B(h[1]-t)<U?u>0?1:0:u>0?3:2}function s(h,u){return c(h.x,u.x)}function c(h,u){var a=l(h,1),f=l(u,1);return a!==f?a-f:a===0?u[1]-h[1]:a===1?h[0]-u[0]:a===2?h[1]-u[1]:u[0]-h[0]}return function(h){var u=h,a=Un(),f,p,d,E,S,w,D,_,k,y,O,P={point:R,lineStart:b,lineEnd:Y,polygonStart:q,polygonEnd:C};function R(v,m){i(v,m)&&u.point(v,m)}function F(){for(var v=0,m=0,I=p.length;m<I;++m)for(var z=p[m],N=1,L=z.length,V=z[0],A,W,G=V[0],$=V[1];N<L;++N)A=G,W=$,V=z[N],G=V[0],$=V[1],W<=n?$>n&&(G-A)*(n-W)>($-W)*(e-A)&&++v:$<=n&&(G-A)*(n-W)<($-W)*(e-A)&&--v;return v}function q(){u=a,f=[],p=[],O=!0}function C(){var v=F(),m=O&&v,I=(f=qn(f)).length;(m||I)&&(h.polygonStart(),m&&(h.lineStart(),o(null,null,1,h),h.lineEnd()),I&&Xn(f,s,v,o,h),h.polygonEnd()),u=h,f=p=d=null}function b(){P.point=g,p&&p.push(d=[]),y=!0,k=!1,D=_=NaN}function Y(){f&&(g(E,S),w&&k&&a.rejoin(),f.push(a.result())),P.point=R,k&&u.lineEnd()}function g(v,m){var I=i(v,m);if(p&&d.push([v,m]),y)E=v,S=m,w=I,y=!1,I&&(u.lineStart(),u.point(v,m));else if(I&&k)u.point(v,m);else{var z=[D=Math.max(et,Math.min(Ve,D)),_=Math.max(et,Math.min(Ve,_))],N=[v=Math.max(et,Math.min(Ve,v)),m=Math.max(et,Math.min(Ve,m))];qi(z,N,e,t,r,n)?(k||(u.lineStart(),u.point(z[0],z[1])),u.point(N[0],N[1]),I||u.lineEnd(),O=!1):I&&(u.lineStart(),u.point(v,m),O=!1)}D=v,_=m,k=I}return P}}const Lt=e=>e;var kt=new De,Ft=new De,Gn,Hn,Vt,Jt,ye={point:fe,lineStart:fe,lineEnd:fe,polygonStart:function(){ye.lineStart=Yi,ye.lineEnd=Ui},polygonEnd:function(){ye.lineStart=ye.lineEnd=ye.point=fe,kt.add(B(Ft)),Ft=new De},result:function(){var e=kt/2;return kt=new De,e}};function Yi(){ye.point=ji}function ji(e,t){ye.point=Zn,Gn=Vt=e,Hn=Jt=t}function Zn(e,t){Ft.add(Jt*e-Vt*t),Vt=e,Jt=t}function Ui(){Zn(Gn,Hn)}var Le=1/0,ft=Le,Be=-Le,ct=Be,ht={point:Xi,lineStart:fe,lineEnd:fe,polygonStart:fe,polygonEnd:fe,result:function(){var e=[[Le,ft],[Be,ct]];return Be=ct=-(ft=Le=1/0),e}};function Xi(e,t){e<Le&&(Le=e),e>Be&&(Be=e),t<ft&&(ft=t),t>ct&&(ct=t)}var qt=0,At=0,Je=0,pt=0,gt=0,Ne=0,Yt=0,jt=0,qe=0,Wn,Kn,he,pe,se={point:ze,lineStart:hn,lineEnd:pn,polygonStart:function(){se.lineStart=Hi,se.lineEnd=Zi},polygonEnd:function(){se.point=ze,se.lineStart=hn,se.lineEnd=pn},result:function(){var e=qe?[Yt/qe,jt/qe]:Ne?[pt/Ne,gt/Ne]:Je?[qt/Je,At/Je]:[NaN,NaN];return qt=At=Je=pt=gt=Ne=Yt=jt=qe=0,e}};function ze(e,t){qt+=e,At+=t,++Je}function hn(){se.point=Bi}function Bi(e,t){se.point=Gi,ze(he=e,pe=t)}function Gi(e,t){var r=e-he,n=t-pe,i=Oe(r*r+n*n);pt+=i*(he+e)/2,gt+=i*(pe+t)/2,Ne+=i,ze(he=e,pe=t)}function pn(){se.point=ze}function Hi(){se.point=Wi}function Zi(){Qn(Wn,Kn)}function Wi(e,t){se.point=Qn,ze(Wn=he=e,Kn=pe=t)}function Qn(e,t){var r=e-he,n=t-pe,i=Oe(r*r+n*n);pt+=i*(he+e)/2,gt+=i*(pe+t)/2,Ne+=i,i=pe*e-he*t,Yt+=i*(he+e),jt+=i*(pe+t),qe+=i*3,ze(he=e,pe=t)}function $n(e){this._context=e}$n.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,ae);break}}},result:fe};var Ut=new De,Dt,xn,ei,Ae,Ye,Ge={point:fe,lineStart:function(){Ge.point=Ki},lineEnd:function(){Dt&&ti(xn,ei),Ge.point=fe},polygonStart:function(){Dt=!0},polygonEnd:function(){Dt=null},result:function(){var e=+Ut;return Ut=new De,e}};function Ki(e,t){Ge.point=ti,xn=Ae=e,ei=Ye=t}function ti(e,t){Ae-=e,Ye-=t,Ut.add(Oe(Ae*Ae+Ye*Ye)),Ae=e,Ye=t}let gn,vt,vn,mn;class dn{constructor(t){this._append=t==null?ni:Qi(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==vn||this._append!==vt){const n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,vn=n,vt=this._append,mn=this._,this._=i}this._+=mn;break}}}result(){const t=this._;return this._="",t.length?t:null}}function ni(e){let t=1;this._+=e[0];for(const r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Qi(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return ni;if(t!==gn){const r=10**t;gn=t,vt=function(i){let o=1;this._+=i[0];for(const l=i.length;o<l;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return vt}function Kt(e,t){let r=3,n=4.5,i,o;function l(s){return s&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),be(s,i(o))),o.result()}return l.area=function(s){return be(s,i(ye)),ye.result()},l.measure=function(s){return be(s,i(Ge)),Ge.result()},l.bounds=function(s){return be(s,i(ht)),ht.result()},l.centroid=function(s){return be(s,i(se)),se.result()},l.projection=function(s){return arguments.length?(i=s==null?(e=null,Lt):(e=s).stream,l):e},l.context=function(s){return arguments.length?(o=s==null?(t=null,new dn(r)):new $n(t=s),typeof n!="function"&&o.pointRadius(n),l):t},l.pointRadius=function(s){return arguments.length?(n=typeof s=="function"?s:(o.pointRadius(+s),+s),l):n},l.digits=function(s){if(!arguments.length)return r;if(s==null)r=null;else{const c=Math.floor(s);if(!(c>=0))throw new RangeError(`invalid digits: ${s}`);r=c}return t===null&&(o=new dn(r)),l},l.projection(e).digits(r).context(t)}function Qt(e){return function(t){var r=new Xt;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Xt(){}Xt.prototype={constructor:Xt,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function $t(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),be(r,e.stream(ht)),t(ht.result()),n!=null&&e.clipExtent(n),e}function ii(e,t,r){return $t(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],l=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),s=+t[0][0]+(i-l*(n[1][0]+n[0][0]))/2,c=+t[0][1]+(o-l*(n[1][1]+n[0][1]))/2;e.scale(150*l).translate([s,c])},r)}function $i(e,t,r){return ii(e,[[0,0],t],r)}function xi(e,t,r){return $t(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),l=(i-o*(n[1][0]+n[0][0]))/2,s=-o*n[0][1];e.scale(150*o).translate([l,s])},r)}function er(e,t,r){return $t(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),l=-o*n[0][0],s=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([l,s])},r)}var _n=16,tr=H(30*K);function yn(e,t){return+t?ir(e,t):nr(e)}function nr(e){return Qt({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function ir(e,t){function r(n,i,o,l,s,c,h,u,a,f,p,d,E,S){var w=h-n,D=u-i,_=w*w+D*D;if(_>4*t&&E--){var k=l+f,y=s+p,O=c+d,P=Oe(k*k+y*y+O*O),R=Xe(O/=P),F=B(B(O)-1)<U||B(o-a)<U?(o+a)/2:Ue(y,k),q=e(F,R),C=q[0],b=q[1],Y=C-n,g=b-i,v=D*Y-w*g;(v*v/_>t||B((w*Y+D*g)/_-.5)>.3||l*f+s*p+c*d<tr)&&(r(n,i,o,l,s,c,C,b,F,k/=P,y/=P,O,E,S),S.point(C,b),r(C,b,F,k,y,O,h,u,a,f,p,d,E,S))}}return function(n){var i,o,l,s,c,h,u,a,f,p,d,E,S={point:w,lineStart:D,lineEnd:k,polygonStart:function(){n.polygonStart(),S.lineStart=y},polygonEnd:function(){n.polygonEnd(),S.lineStart=D}};function w(R,F){R=e(R,F),n.point(R[0],R[1])}function D(){a=NaN,S.point=_,n.lineStart()}function _(R,F){var q=Re([R,F]),C=e(R,F);r(a,f,u,p,d,E,a=C[0],f=C[1],u=R,p=q[0],d=q[1],E=q[2],_n,n),n.point(a,f)}function k(){S.point=w,n.lineEnd()}function y(){D(),S.point=O,S.lineEnd=P}function O(R,F){_(i=R,F),o=a,l=f,s=p,c=d,h=E,S.point=_}function P(){r(a,f,u,p,d,E,o,l,i,s,c,h,_n,n),S.lineEnd=k,k()}return S}}var rr=Qt({point:function(e,t){this.stream.point(e*K,t*K)}});function or(e){return Qt({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function lr(e,t,r,n,i){function o(l,s){return l*=n,s*=i,[t+e*l,r-e*s]}return o.invert=function(l,s){return[(l-t)/e*n,(r-s)/e*i]},o}function wn(e,t,r,n,i,o){if(!o)return lr(e,t,r,n,i);var l=H(o),s=Z(o),c=l*e,h=s*e,u=l/e,a=s/e,f=(s*r-l*t)/e,p=(s*t+l*r)/e;function d(E,S){return E*=n,S*=i,[c*E-h*S+t,r-h*E-c*S]}return d.invert=function(E,S){return[n*(u*E-a*S+f),i*(p-a*E-u*S)]},d}function ur(e){return ar(function(){return e})()}function ar(e){var t,r=150,n=480,i=250,o=0,l=0,s=0,c=0,h=0,u,a=0,f=1,p=1,d=null,E=cn,S=null,w,D,_,k=Lt,y=.5,O,P,R,F,q;function C(v){return R(v[0]*K,v[1]*K)}function b(v){return v=R.invert(v[0],v[1]),v&&[v[0]*le,v[1]*le]}C.stream=function(v){return F&&q===v?F:F=rr(or(u)(E(O(k(q=v)))))},C.preclip=function(v){return arguments.length?(E=v,d=void 0,g()):E},C.postclip=function(v){return arguments.length?(k=v,S=w=D=_=null,g()):k},C.clipAngle=function(v){return arguments.length?(E=+v?Ji(d=v*K):(d=null,cn),g()):d*le},C.clipExtent=function(v){return arguments.length?(k=v==null?(S=w=D=_=null,Lt):Ai(S=+v[0][0],w=+v[0][1],D=+v[1][0],_=+v[1][1]),g()):S==null?null:[[S,w],[D,_]]},C.scale=function(v){return arguments.length?(r=+v,Y()):r},C.translate=function(v){return arguments.length?(n=+v[0],i=+v[1],Y()):[n,i]},C.center=function(v){return arguments.length?(o=v[0]%360*K,l=v[1]%360*K,Y()):[o*le,l*le]},C.rotate=function(v){return arguments.length?(s=v[0]%360*K,c=v[1]%360*K,h=v.length>2?v[2]%360*K:0,Y()):[s*le,c*le,h*le]},C.angle=function(v){return arguments.length?(a=v%360*K,Y()):a*le},C.reflectX=function(v){return arguments.length?(f=v?-1:1,Y()):f<0},C.reflectY=function(v){return arguments.length?(p=v?-1:1,Y()):p<0},C.precision=function(v){return arguments.length?(O=yn(P,y=v*v),g()):Oe(y)},C.fitExtent=function(v,m){return ii(C,v,m)},C.fitSize=function(v,m){return $i(C,v,m)},C.fitWidth=function(v,m){return xi(C,v,m)},C.fitHeight=function(v,m){return er(C,v,m)};function Y(){var v=wn(r,0,0,f,p,a).apply(null,t(o,l)),m=wn(r,n-v[0],i-v[1],f,p,a);return u=jn(s,c,h),P=Pt(t,m),R=Pt(u,P),O=yn(P,y),g()}function g(){return F=q=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&b,Y()}}function xt(e,t){return[e,Di(Oi((oe+t)/2))]}xt.invert=function(e,t){return[e,2*Yn(ki(t))-oe]};function sr(){return fr(xt).scale(961/ae)}function fr(e){var t=ur(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,l=null,s,c,h;t.scale=function(a){return arguments.length?(n(a),u()):n()},t.translate=function(a){return arguments.length?(i(a),u()):i()},t.center=function(a){return arguments.length?(r(a),u()):r()},t.clipExtent=function(a){return arguments.length?(a==null?l=s=c=h=null:(l=+a[0][0],s=+a[0][1],c=+a[1][0],h=+a[1][1]),u()):l==null?null:[[l,s],[c,h]]};function u(){var a=J*n(),f=t(Ni(t.rotate()).invert([0,0]));return o(l==null?[[f[0]-a,f[1]-a],[f[0]+a,f[1]+a]]:e===xt?[[Math.max(f[0]-a,l),s],[Math.min(f[0]+a,c),h]]:[[l,Math.max(f[1]-a,s)],[c,Math.min(f[1]+a,h)]])}return u()}const tt=e=>()=>e;function cr(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function zt(e){e.stopImmediatePropagation()}function Fe(e){e.preventDefault(),e.stopImmediatePropagation()}function hr(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function pr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Mn(){return this.__zoom||Wt}function gr(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function vr(){return navigator.maxTouchPoints||"ontouchstart"in this}function mr(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],o=e.invertY(t[0][1])-r[0][1],l=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function dr(){var e=hr,t=pr,r=mr,n=gr,i=vr,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],s=250,c=Si,h=ci("start","zoom","end"),u,a,f,p=500,d=150,E=0,S=10;function w(g){g.property("__zoom",Mn).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",q).filter(i).on("touchstart.zoom",C).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",Y).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(g,v,m,I){var z=g.selection?g.selection():g;z.property("__zoom",Mn),g!==z?y(g,v,m,I):z.interrupt().each(function(){O(this,arguments).event(I).start().zoom(null,typeof v=="function"?v.apply(this,arguments):v).end()})},w.scaleBy=function(g,v,m,I){w.scaleTo(g,function(){var z=this.__zoom.k,N=typeof v=="function"?v.apply(this,arguments):v;return z*N},m,I)},w.scaleTo=function(g,v,m,I){w.transform(g,function(){var z=t.apply(this,arguments),N=this.__zoom,L=m==null?k(z):typeof m=="function"?m.apply(this,arguments):m,V=N.invert(L),A=typeof v=="function"?v.apply(this,arguments):v;return r(_(D(N,A),L,V),z,l)},m,I)},w.translateBy=function(g,v,m,I){w.transform(g,function(){return r(this.__zoom.translate(typeof v=="function"?v.apply(this,arguments):v,typeof m=="function"?m.apply(this,arguments):m),t.apply(this,arguments),l)},null,I)},w.translateTo=function(g,v,m,I,z){w.transform(g,function(){var N=t.apply(this,arguments),L=this.__zoom,V=I==null?k(N):typeof I=="function"?I.apply(this,arguments):I;return r(Wt.translate(V[0],V[1]).scale(L.k).translate(typeof v=="function"?-v.apply(this,arguments):-v,typeof m=="function"?-m.apply(this,arguments):-m),N,l)},I,z)};function D(g,v){return v=Math.max(o[0],Math.min(o[1],v)),v===g.k?g:new Mt(v,g.x,g.y)}function _(g,v,m){var I=v[0]-m[0]*g.k,z=v[1]-m[1]*g.k;return I===g.x&&z===g.y?g:new Mt(g.k,I,z)}function k(g){return[(+g[0][0]+ +g[1][0])/2,(+g[0][1]+ +g[1][1])/2]}function y(g,v,m,I){g.on("start.zoom",function(){O(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(I).end()}).tween("zoom",function(){var z=this,N=arguments,L=O(z,N).event(I),V=t.apply(z,N),A=m==null?k(V):typeof m=="function"?m.apply(z,N):m,W=Math.max(V[1][0]-V[0][0],V[1][1]-V[0][1]),G=z.__zoom,$=typeof v=="function"?v.apply(z,N):v,de=c(G.invert(A).concat(W/G.k),$.invert(A).concat(W/$.k));return function(ce){if(ce===1)ce=$;else{var _e=de(ce),yt=W/_e[2];ce=new Mt(yt,A[0]-_e[0]*yt,A[1]-_e[1]*yt)}L.zoom(null,ce)}})}function O(g,v,m){return!m&&g.__zooming||new P(g,v)}function P(g,v){this.that=g,this.args=v,this.active=0,this.sourceEvent=null,this.extent=t.apply(g,v),this.taps=0}P.prototype={event:function(g){return g&&(this.sourceEvent=g),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(g,v){return this.mouse&&g!=="mouse"&&(this.mouse[1]=v.invert(this.mouse[0])),this.touch0&&g!=="touch"&&(this.touch0[1]=v.invert(this.touch0[0])),this.touch1&&g!=="touch"&&(this.touch1[1]=v.invert(this.touch1[0])),this.that.__zoom=v,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(g){var v=ue(this.that).datum();h.call(g,this.that,new cr(g,{sourceEvent:this.sourceEvent,target:w,type:g,transform:this.that.__zoom,dispatch:h}),v)}};function R(g,...v){if(!e.apply(this,arguments))return;var m=O(this,v).event(g),I=this.__zoom,z=Math.max(o[0],Math.min(o[1],I.k*Math.pow(2,n.apply(this,arguments)))),N=we(g);if(m.wheel)(m.mouse[0][0]!==N[0]||m.mouse[0][1]!==N[1])&&(m.mouse[1]=I.invert(m.mouse[0]=N)),clearTimeout(m.wheel);else{if(I.k===z)return;m.mouse=[N,I.invert(N)],St(this),m.start()}Fe(g),m.wheel=setTimeout(L,d),m.zoom("mouse",r(_(D(I,z),m.mouse[0],m.mouse[1]),m.extent,l));function L(){m.wheel=null,m.end()}}function F(g,...v){if(f||!e.apply(this,arguments))return;var m=g.currentTarget,I=O(this,v,!0).event(g),z=ue(g.view).on("mousemove.zoom",A,!0).on("mouseup.zoom",W,!0),N=we(g,m),L=g.clientX,V=g.clientY;di(g.view),zt(g),I.mouse=[N,this.__zoom.invert(N)],St(this),I.start();function A(G){if(Fe(G),!I.moved){var $=G.clientX-L,de=G.clientY-V;I.moved=$*$+de*de>E}I.event(G).zoom("mouse",r(_(I.that.__zoom,I.mouse[0]=we(G,m),I.mouse[1]),I.extent,l))}function W(G){z.on("mousemove.zoom mouseup.zoom",null),_i(G.view,I.moved),Fe(G),I.event(G).end()}}function q(g,...v){if(e.apply(this,arguments)){var m=this.__zoom,I=we(g.changedTouches?g.changedTouches[0]:g,this),z=m.invert(I),N=m.k*(g.shiftKey?.5:2),L=r(_(D(m,N),I,z),t.apply(this,v),l);Fe(g),s>0?ue(this).transition().duration(s).call(y,L,I,g):ue(this).call(w.transform,L,I,g)}}function C(g,...v){if(e.apply(this,arguments)){var m=g.touches,I=m.length,z=O(this,v,g.changedTouches.length===I).event(g),N,L,V,A;for(zt(g),L=0;L<I;++L)V=m[L],A=we(V,this),A=[A,this.__zoom.invert(A),V.identifier],z.touch0?!z.touch1&&z.touch0[2]!==A[2]&&(z.touch1=A,z.taps=0):(z.touch0=A,N=!0,z.taps=1+!!u);u&&(u=clearTimeout(u)),N&&(z.taps<2&&(a=A[0],u=setTimeout(function(){u=null},p)),St(this),z.start())}}function b(g,...v){if(this.__zooming){var m=O(this,v).event(g),I=g.changedTouches,z=I.length,N,L,V,A;for(Fe(g),N=0;N<z;++N)L=I[N],V=we(L,this),m.touch0&&m.touch0[2]===L.identifier?m.touch0[0]=V:m.touch1&&m.touch1[2]===L.identifier&&(m.touch1[0]=V);if(L=m.that.__zoom,m.touch1){var W=m.touch0[0],G=m.touch0[1],$=m.touch1[0],de=m.touch1[1],ce=(ce=$[0]-W[0])*ce+(ce=$[1]-W[1])*ce,_e=(_e=de[0]-G[0])*_e+(_e=de[1]-G[1])*_e;L=D(L,Math.sqrt(ce/_e)),V=[(W[0]+$[0])/2,(W[1]+$[1])/2],A=[(G[0]+de[0])/2,(G[1]+de[1])/2]}else if(m.touch0)V=m.touch0[0],A=m.touch0[1];else return;m.zoom("touch",r(_(L,V,A),m.extent,l))}}function Y(g,...v){if(this.__zooming){var m=O(this,v).event(g),I=g.changedTouches,z=I.length,N,L;for(zt(g),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),N=0;N<z;++N)L=I[N],m.touch0&&m.touch0[2]===L.identifier?delete m.touch0:m.touch1&&m.touch1[2]===L.identifier&&delete m.touch1;if(m.touch1&&!m.touch0&&(m.touch0=m.touch1,delete m.touch1),m.touch0)m.touch0[1]=this.__zoom.invert(m.touch0[0]);else if(m.end(),m.taps===2&&(L=we(L,this),Math.hypot(a[0]-L[0],a[1]-L[1])<S)){var V=ue(this).on("dblclick.zoom");V&&V.apply(this,arguments)}}}return w.wheelDelta=function(g){return arguments.length?(n=typeof g=="function"?g:tt(+g),w):n},w.filter=function(g){return arguments.length?(e=typeof g=="function"?g:tt(!!g),w):e},w.touchable=function(g){return arguments.length?(i=typeof g=="function"?g:tt(!!g),w):i},w.extent=function(g){return arguments.length?(t=typeof g=="function"?g:tt([[+g[0][0],+g[0][1]],[+g[1][0],+g[1][1]]]),w):t},w.scaleExtent=function(g){return arguments.length?(o[0]=+g[0],o[1]=+g[1],w):[o[0],o[1]]},w.translateExtent=function(g){return arguments.length?(l[0][0]=+g[0][0],l[1][0]=+g[1][0],l[0][1]=+g[0][1],l[1][1]=+g[1][1],w):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},w.constrain=function(g){return arguments.length?(r=g,w):r},w.duration=function(g){return arguments.length?(s=+g,w):s},w.interpolate=function(g){return arguments.length?(c=g,w):c},w.on=function(){var g=h.on.apply(h,arguments);return g===h?w:g},w.clickDistance=function(g){return arguments.length?(E=(g=+g)*g,w):Math.sqrt(E)},w.tapDistance=function(g){return arguments.length?(S=+g,w):S},w}function Sn(e,t,r){const n=e.slice();return n[18]=t[r],n}function _r(e){let t,r,n,i;return{c(){t=ee("circle"),this.h()},l(o){t=te(o,"circle",{class:!0,cx:!0,cy:!0,r:!0,fill:!0}),j(t).forEach(T),this.h()},h(){M(t,"class",r=`feature-${e[18].properties.id}`),M(t,"cx",n=e[0](e[18])[0]),M(t,"cy",i=e[0](e[18])[1]),M(t,"r","30"),M(t,"fill","#599FF0")},m(o,l){X(o,t,l)},p(o,l){l&256&&r!==(r=`feature-${o[18].properties.id}`)&&M(t,"class",r),l&257&&n!==(n=o[0](o[18])[0])&&M(t,"cx",n),l&257&&i!==(i=o[0](o[18])[1])&&M(t,"cy",i)},d(o){o&&T(t)}}}function yr(e){let t;function r(o,l){return o[2]?Mr:wr}let n=r(e),i=n(e);return{c(){i.c(),t=ne()},l(o){i.l(o),t=ne()},m(o,l){i.m(o,l),X(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function wr(e){let t,r,n;return{c(){t=ee("path"),this.h()},l(i){t=te(i,"path",{class:!0,d:!0}),j(t).forEach(T),this.h()},h(){M(t,"class",r=rt(`feature-${e[18].properties.id}`)+" svelte-11hs3po"),M(t,"d",n=e[9](e[18]))},m(i,o){X(i,t,o)},p(i,o){o&256&&r!==(r=rt(`feature-${i[18].properties.id}`)+" svelte-11hs3po")&&M(t,"class",r),o&768&&n!==(n=i[9](i[18]))&&M(t,"d",n)},d(i){i&&T(t)}}}function Mr(e){let t,r,n,i,o;return{c(){t=ee("path"),this.h()},l(l){t=te(l,"path",{class:!0,d:!0}),j(t).forEach(T),this.h()},h(){M(t,"class",r=rt(`feature-${e[18].properties.id}`)+" svelte-11hs3po"),M(t,"d",n=e[9](e[18])),re(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},m(l,s){X(l,t,s),i||(o=[nt(t,"mouseover",function(){wt(e[11](e[18]))&&e[11](e[18]).apply(this,arguments)}),nt(t,"mouseout",function(){wt(e[12](e[18]))&&e[12](e[18]).apply(this,arguments)}),nt(t,"click",function(){wt(e[13](e[18]))&&e[13](e[18]).apply(this,arguments)})],i=!0)},p(l,s){e=l,s&256&&r!==(r=rt(`feature-${e[18].properties.id}`)+" svelte-11hs3po")&&M(t,"class",r),s&768&&n!==(n=e[9](e[18]))&&M(t,"d",n),s&1280&&re(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},d(l){l&&T(t),i=!1,li(o)}}}function En(e){let t;function r(o,l){return o[4]=="polygons"?yr:_r}let n=r(e),i=n(e);return{c(){i.c(),t=ne()},l(o){i.l(o),t=ne()},m(o,l){i.m(o,l),X(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function Sr(e){let t,r,n,i,o,l,s,c,h=me(e[8]),u=[];for(let a=0;a<h.length;a+=1)u[a]=En(Sn(e,h,a));return{c(){t=ee("g"),r=ee("pattern"),n=ee("circle"),i=ee("pattern"),o=ee("circle"),l=ee("pattern"),s=ee("circle");for(let a=0;a<u.length;a+=1)u[a].c();this.h()},l(a){t=te(a,"g",{class:!0,id:!0});var f=j(t);r=te(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var p=j(r);n=te(p,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),j(n).forEach(T),p.forEach(T),i=te(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var d=j(i);o=te(d,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),j(o).forEach(T),d.forEach(T),l=te(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var E=j(l);s=te(E,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),j(s).forEach(T),E.forEach(T);for(let S=0;S<u.length;S+=1)u[S].l(f);f.forEach(T),this.h()},h(){M(n,"cx","1"),M(n,"cy","1"),M(n,"r","0.6"),M(n,"fill","#A060C1"),M(r,"id","circles-urban-industrial-era"),M(r,"x","0"),M(r,"y","0"),M(r,"width","2"),M(r,"height","2"),M(r,"patternUnits","userSpaceOnUse"),M(o,"cx","5"),M(o,"cy","5"),M(o,"r","2"),M(o,"fill","#83BC6E"),M(i,"id","circles-pre-1600s"),M(i,"x","0"),M(i,"y","0"),M(i,"width","10"),M(i,"height","10"),M(i,"patternUnits","userSpaceOnUse"),M(s,"cx","0.5"),M(s,"cy","0.5"),M(s,"r","0.4"),M(s,"fill","#83BC6E"),M(l,"id","circles-intro"),M(l,"x","0"),M(l,"y","0"),M(l,"width","1"),M(l,"height","1"),M(l,"patternUnits","userSpaceOnUse"),M(t,"class",c=`map-svg-g view-${e[5]} era-${e[6]} stop-${e[7]} svelte-11hs3po`),M(t,"id",e[1]),re(t,"visible",e[3]),re(t,"hidden",!e[3])},m(a,f){X(a,t,f),Q(t,r),Q(r,n),Q(t,i),Q(i,o),Q(t,l),Q(l,s);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null)},p(a,[f]){if(f&16149){h=me(a[8]);let p;for(p=0;p<h.length;p+=1){const d=Sn(a,h,p);u[p]?u[p].p(d,f):(u[p]=En(d),u[p].c(),u[p].m(t,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=h.length}f&224&&c!==(c=`map-svg-g view-${a[5]} era-${a[6]} stop-${a[7]} svelte-11hs3po`)&&M(t,"class",c),f&2&&M(t,"id",a[1]),f&232&&re(t,"visible",a[3]),f&232&&re(t,"hidden",!a[3])},i:ke,o:ke,d(a){a&&T(t),Ze(u,a)}}}function Er(e,t,r){let{url:n=""}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,{geometryType:c="polygons"}=t,{activeViewID:h}=t,{activeEraID:u}=t,{activeStopID:a}=t;function f(y){console.log("Map(id: "+o+"):onChapterMouseOver(event:"+JSON.stringify(y.detail)+")"),r(10,S=y.detail.id)}function p(y){console.log("Map(id: "+o+"):onChapterMouseLeave(event:"+JSON.stringify(y.detail)+")"),r(10,S=null)}let d=[],E=null,S=null;const w=Bt();mt(()=>{An(Zt+n).then(y=>{r(8,d=y.features),r(9,E=Kt().projection(i))})});function D(y){console.log("Map:onFeatureMouseOver(feature:"+JSON.stringify(y)+")"),y.properties&&y.properties.id&&console.log("Map:onFeatureMouseOver(section:"+JSON.stringify(y.properties.id)+")"),w("featureMouseOver",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}function _(y){console.log("Map:onFeatureMouseOut(feature:"+JSON.stringify(y)+")"),y.properties&&y.properties.id&&console.log("Map:onFeatureMouseOut(id:"+JSON.stringify(y.properties.id)+")"),w("featureMouseOut",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}function k(y){console.log("Map:onFeatureClick(feature:"+JSON.stringify(y)+")"),w("featureClick",{mapID:o,featureID:y.properties&&y.properties.id?y.properties.id:"?"})}return e.$$set=y=>{"url"in y&&r(14,n=y.url),"projection"in y&&r(0,i=y.projection),"id"in y&&r(1,o=y.id),"interactive"in y&&r(2,l=y.interactive),"visible"in y&&r(3,s=y.visible),"geometryType"in y&&r(4,c=y.geometryType),"activeViewID"in y&&r(5,h=y.activeViewID),"activeEraID"in y&&r(6,u=y.activeEraID),"activeStopID"in y&&r(7,a=y.activeStopID)},[i,o,l,s,c,h,u,a,d,E,S,D,_,k,n,f,p]}class ri extends We{constructor(t){super(),Ke(this,t,Er,Sr,He,{url:14,projection:0,id:1,interactive:2,visible:3,geometryType:4,activeViewID:5,activeEraID:6,activeStopID:7,onChapterMouseOver:15,onChapterMouseLeave:16})}get onChapterMouseOver(){return this.$$.ctx[15]}get onChapterMouseLeave(){return this.$$.ctx[16]}}function Ir(e){return e.k}function kr(e){return[e.x,e.y]}function In(e){return function(){return e}}function Dr(){let e=0,t=0,r=960,n=500,i=!0,o=!0,l=256,s=Ir,c=kr,h=0;function u(){const a=+s.apply(this,arguments),f=c.apply(this,arguments),p=Math.log2(a/l),d=Math.round(Math.max(p+h,0)),E=Math.pow(2,p-d)*l,S=+f[0]-a/2,w=+f[1]-a/2,D=Math.max(i?0:-1/0,Math.floor((e-S)/E)),_=Math.min(i?1<<d:1/0,Math.ceil((r-S)/E)),k=Math.max(o?0:-1/0,Math.floor((t-w)/E)),y=Math.min(o?1<<d:1/0,Math.ceil((n-w)/E)),O=[];for(let P=k;P<y;++P)for(let R=D;R<_;++R)O.push([R,P,d]);return O.translate=[S/E,w/E],O.scale=E,O}return u.size=function(a){return arguments.length?(e=t=0,r=+a[0],n=+a[1],u):[r-e,n-t]},u.extent=function(a){return arguments.length?(e=+a[0][0],t=+a[0][1],r=+a[1][0],n=+a[1][1],u):[[e,t],[r,n]]},u.scale=function(a){return arguments.length?(s=typeof a=="function"?a:In(+a),u):s},u.translate=function(a){return arguments.length?(c=typeof a=="function"?a:In([+a[0],+a[1]]),u):c},u.zoomDelta=function(a){return arguments.length?(h=+a,u):h},u.tileSize=function(a){return arguments.length?(l=+a,u):l},u.clamp=function(a){return arguments.length?(i=o=!!a,u):i&&o},u.clampX=function(a){return arguments.length?(i=!!a,u):i},u.clampY=function(a){return arguments.length?(o=!!a,u):o},u}function kn(e,t,r){const n=e.slice();n[11]=t[r];const i=Or(n[11],n[1]);return n[12]=i[0],n[13]=i[1],n}function Dn(e){let t;return{c(){t=ee("image"),this.h()},l(r){t=te(r,"image",{"xlink:href":!0,x:!0,y:!0,width:!0,height:!0,class:!0}),j(t).forEach(T),this.h()},h(){ui(t,"xlink:href",e[3](...e[11])),M(t,"x",e[12]),M(t,"y",e[13]),M(t,"width",e[2]),M(t,"height",e[2]),M(t,"class","svelte-511esr")},m(r,n){X(r,t,n)},p:ke,d(r){r&&T(t)}}}function zr(e){let t,r=me(e[1]),n=[];for(let i=0;i<r.length;i+=1)n[i]=Dn(kn(e,r,i));return{c(){t=ee("g");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){t=te(i,"g",{class:!0});var o=j(t);for(let l=0;l<n.length;l+=1)n[l].l(o);o.forEach(T),this.h()},h(){M(t,"class","map-svg-g svelte-511esr"),re(t,"visible",e[0])},m(i,o){X(i,t,o);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(t,null)},p(i,[o]){if(o&14){r=me(i[1]);let l;for(l=0;l<r.length;l+=1){const s=kn(i,r,l);n[l]?n[l].p(s,o):(n[l]=Dn(s),n[l].c(),n[l].m(t,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=r.length}o&1&&re(t,"visible",i[0])},i:ke,o:ke,d(i){i&&T(t),Ze(n,i)}}}function Or(e,t){const[r,n]=e,{translate:[i,o],scale:l}=t;return[(r+i)*l,(n+o)*l]}function br(e,t,r){let{urlPath:n}=t,{urlExtension:i}=t,{projection:o}=t,{visible:l=!1}=t;Bt(),mt(()=>{});const c=Dr().size([2e3,1e3]).scale(o.scale()*2*Math.PI).translate(o([0,0]))(),{translate:[h,u],scale:a}=c,f=(p,d,E)=>`${Zt}${n}${E}/${p}/${d}.${i}`;return e.$$set=p=>{"urlPath"in p&&r(4,n=p.urlPath),"urlExtension"in p&&r(5,i=p.urlExtension),"projection"in p&&r(6,o=p.projection),"visible"in p&&r(0,l=p.visible)},[l,c,a,f,n,i,o]}class Nr extends We{constructor(t){super(),Ke(this,t,br,zr,He,{urlPath:4,urlExtension:5,projection:6,visible:0})}}function zn(e,t,r){const n=e.slice();return n[9]=t[r],n}function On(e){let t,r=e[9].properties.label+"",n,i;return{c(){t=ee("text"),n=ot(r),this.h()},l(o){t=te(o,"text",{transform:!0,dy:!0,class:!0});var l=j(t);n=lt(l,r),l.forEach(T),this.h()},h(){M(t,"transform",i=`translate(${e[0](e[9].geometry.coordinates)})`),M(t,"dy",".35em"),M(t,"class","svelte-4chwh7")},m(o,l){X(o,t,l),Q(t,n)},p(o,l){l&64&&r!==(r=o[9].properties.label+"")&&ut(n,r),l&65&&i!==(i=`translate(${o[0](o[9].geometry.coordinates)})`)&&M(t,"transform",i)},d(o){o&&T(t)}}}function bn(e){let t,r=e[9].properties.era==e[4]&&On(e);return{c(){r&&r.c(),t=ne()},l(n){r&&r.l(n),t=ne()},m(n,i){r&&r.m(n,i),X(n,t,i)},p(n,i){n[9].properties.era==n[4]?r?r.p(n,i):(r=On(n),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(n){n&&T(t),r&&r.d(n)}}}function Tr(e){let t,r,n=me(e[6]),i=[];for(let o=0;o<n.length;o+=1)i[o]=bn(zn(e,n,o));return{c(){t=ee("g");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){t=te(o,"g",{class:!0,id:!0});var l=j(t);for(let s=0;s<i.length;s+=1)i[s].l(l);l.forEach(T),this.h()},h(){M(t,"class",r=`map-svg-g view-${e[3]} era-${e[4]} stop-${e[5]} svelte-4chwh7`),M(t,"id",e[1]),re(t,"visible",e[2]),re(t,"hidden",!e[2])},m(o,l){X(o,t,l);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[l]){if(l&81){n=me(o[6]);let s;for(s=0;s<n.length;s+=1){const c=zn(o,n,s);i[s]?i[s].p(c,l):(i[s]=bn(c),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}l&56&&r!==(r=`map-svg-g view-${o[3]} era-${o[4]} stop-${o[5]} svelte-4chwh7`)&&M(t,"class",r),l&2&&M(t,"id",o[1]),l&60&&re(t,"visible",o[2]),l&60&&re(t,"hidden",!o[2])},i:ke,o:ke,d(o){o&&T(t),Ze(i,o)}}}function Cr(e,t,r){let{path:n}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,{activeViewID:c}=t,{activeEraID:h}=t,{activeStopID:u}=t,a=[];return mt(()=>{An(Zt+n).then(f=>{r(6,a=f.features),r(7,n=Kt().projection(i))})}),e.$$set=f=>{"path"in f&&r(7,n=f.path),"projection"in f&&r(0,i=f.projection),"id"in f&&r(1,o=f.id),"interactive"in f&&r(8,l=f.interactive),"visible"in f&&r(2,s=f.visible),"activeViewID"in f&&r(3,c=f.activeViewID),"activeEraID"in f&&r(4,h=f.activeEraID),"activeStopID"in f&&r(5,u=f.activeStopID)},[i,o,s,c,h,u,a,n,l]}class Pr extends We{constructor(t){super(),Ke(this,t,Cr,Tr,He,{path:7,projection:0,id:1,interactive:8,visible:2,activeViewID:3,activeEraID:4,activeStopID:5})}}function oi(e,t){const r=new IntersectionObserver(n,{threshold:1});r.observe(e);function n(i){const o=i.find(l=>l.isIntersecting);if(o){const l=o.target.dataset.id;t(l)}}return{destroy:()=>r.disconnect()}}function Nn(e,t,r){const n=e.slice();return n[25]=t[r],n}function Tn(e,t,r){const n=e.slice();return n[28]=t[r],n}function Cn(e){let t,r,n=e[0].eras[e[5]].shortLabel+"",i,o,l,s=e[0].eras[e[5]].longLabel+"",c;return{c(){t=ge("div"),r=ge("div"),i=ot(n),o=Ce(),l=ge("div"),c=ot(s),this.h()},l(h){t=ve(h,"DIV",{id:!0,class:!0});var u=j(t);r=ve(u,"DIV",{id:!0,class:!0});var a=j(r);i=lt(a,n),a.forEach(T),o=Pe(u),l=ve(u,"DIV",{id:!0,class:!0});var f=j(l);c=lt(f,s),f.forEach(T),u.forEach(T),this.h()},h(){M(r,"id","era-short-label"),M(r,"class","svelte-hmrxqh"),M(l,"id","era-long-label"),M(l,"class","svelte-hmrxqh"),M(t,"id","story-context-container"),M(t,"class","svelte-hmrxqh")},m(h,u){X(h,t,u),Q(t,r),Q(r,i),Q(t,o),Q(t,l),Q(l,c)},p(h,u){u&33&&n!==(n=h[0].eras[h[5]].shortLabel+"")&&ut(i,n),u&33&&s!==(s=h[0].eras[h[5]].longLabel+"")&&ut(c,s)},d(h){h&&T(t)}}}function Pn(e){let t,r,n,i=e[0].views[e[4]].name+"",o,l,s,c,h=me(e[0].views[e[4]].story),u=[];for(let a=0;a<h.length;a+=1)u[a]=Rn(Tn(e,h,a));return{c(){t=ge("div"),r=ge("div"),n=ge("h1"),o=ot(i),l=Ce();for(let a=0;a<u.length;a+=1)u[a].c();this.h()},l(a){t=ve(a,"DIV",{id:!0,class:!0});var f=j(t);r=ve(f,"DIV",{id:!0,class:!0});var p=j(r);n=ve(p,"H1",{class:!0});var d=j(n);o=lt(d,i),d.forEach(T),l=Pe(p);for(let E=0;E<u.length;E+=1)u[E].l(p);p.forEach(T),f.forEach(T),this.h()},h(){M(n,"class","svelte-hmrxqh"),M(r,"id","story-narrative"),M(r,"class","svelte-hmrxqh"),M(t,"id","story-narrative-container"),M(t,"class","svelte-hmrxqh")},m(a,f){X(a,t,f),Q(t,r),Q(r,n),Q(n,o),Q(r,l);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(r,null);s||(c=Jn(oi.call(null,n,e[12])),s=!0)},p(a,f){if(f&17&&i!==(i=a[0].views[a[4]].name+"")&&ut(o,i),f&4113){h=me(a[0].views[a[4]].story);let p;for(p=0;p<h.length;p+=1){const d=Tn(a,h,p);u[p]?u[p].p(d,f):(u[p]=Rn(d),u[p].c(),u[p].m(r,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=h.length}},d(a){a&&T(t),Ze(u,a),s=!1,c()}}}function Rr(e){let t,r,n=e[28].text+"";return{c(){t=ge("p"),r=new Gt(!1),this.h()},l(i){t=ve(i,"P",{});var o=j(t);r=Ht(o,!1),o.forEach(T),this.h()},h(){r.a=null},m(i,o){X(i,t,o),r.m(n,t)},p(i,o){o&17&&n!==(n=i[28].text+"")&&r.p(n)},d(i){i&&T(t)}}}function Lr(e){let t;function r(o,l){return o[28].stop?Vr:Fr}let n=r(e),i=n(e);return{c(){i.c(),t=ne()},l(o){i.l(o),t=ne()},m(o,l){i.m(o,l),X(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i.d(o)}}}function Fr(e){let t,r,n=e[28].text+"";return{c(){t=ge("h2"),r=new Gt(!1),this.h()},l(i){t=ve(i,"H2",{class:!0});var o=j(t);r=Ht(o,!1),o.forEach(T),this.h()},h(){r.a=null,M(t,"class","svelte-hmrxqh")},m(i,o){X(i,t,o),r.m(n,t)},p(i,o){o&17&&n!==(n=i[28].text+"")&&r.p(n)},d(i){i&&T(t)}}}function Vr(e){let t,r,n=e[28].text+"",i,o,l;return{c(){t=ge("h2"),r=new Gt(!1),this.h()},l(s){t=ve(s,"H2",{"data-id":!0,class:!0});var c=j(t);r=Ht(c,!1),c.forEach(T),this.h()},h(){r.a=null,M(t,"data-id",i=e[28].stop),M(t,"class","svelte-hmrxqh")},m(s,c){X(s,t,c),r.m(n,t),o||(l=Jn(oi.call(null,t,e[12])),o=!0)},p(s,c){c&17&&n!==(n=s[28].text+"")&&r.p(n),c&17&&i!==(i=s[28].stop)&&M(t,"data-id",i)},d(s){s&&T(t),o=!1,l()}}}function Rn(e){let t;function r(o,l){if(o[28].type=="h")return Lr;if(o[28].type=="p")return Rr}let n=r(e),i=n&&n(e);return{c(){i&&i.c(),t=ne()},l(o){i&&i.l(o),t=ne()},m(o,l){i&&i.m(o,l),X(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&T(t),i&&i.d(o)}}}function Ln(e){let t,r,n=me(Object.values(e[0].maps)),i=[];for(let l=0;l<n.length;l+=1)i[l]=Fn(Nn(e,n,l));const o=l=>ie(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();t=ne()},l(l){for(let s=0;s<i.length;s+=1)i[s].l(l);t=ne()},m(l,s){for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(l,s);X(l,t,s),r=!0},p(l,s){if(s&3827){n=me(Object.values(l[0].maps));let c;for(c=0;c<n.length;c+=1){const h=Nn(l,n,c);i[c]?(i[c].p(h,s),x(i[c],1)):(i[c]=Fn(h),i[c].c(),x(i[c],1),i[c].m(t.parentNode,t))}for(dt(),c=n.length;c<i.length;c+=1)o(c);_t()}},i(l){if(!r){for(let s=0;s<n.length;s+=1)x(i[s]);r=!0}},o(l){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)ie(i[s]);r=!1},d(l){l&&T(t),Ze(i,l)}}}function Jr(e){let t,r;return t=new Pr({props:{activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],path:e[25].path,id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&16&&(o.activeViewID=n[4]),i&32&&(o.activeEraID=n[5]),i&64&&(o.activeStopID=n[6]),i&1&&(o.path=n[25].path),i&1&&(o.id=n[25].id),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),t.$set(o)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){ie(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function qr(e){let t,r;return t=new Nr({props:{urlPath:e[25].urlPath,urlExtension:e[25].urlExtension,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&1&&(o.urlPath=n[25].urlPath),i&1&&(o.urlExtension=n[25].urlExtension),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),t.$set(o)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){ie(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function Ar(e){let t,r,n,i;const o=[jr,Yr],l=[];function s(c,h){return c[25].interactive?0:1}return t=s(e),r=l[t]=o[t](e),{c(){r.c(),n=ne()},l(c){r.l(c),n=ne()},m(c,h){l[t].m(c,h),X(c,n,h),i=!0},p(c,h){let u=t;t=s(c),t===u?l[t].p(c,h):(dt(),ie(l[u],1,1,()=>{l[u]=null}),_t(),r=l[t],r?r.p(c,h):(r=l[t]=o[t](c),r.c()),x(r,1),r.m(n.parentNode,n))},i(c){i||(x(r),i=!0)},o(c){ie(r),i=!1},d(c){c&&T(n),l[t].d(c)}}}function Yr(e){let t,r;return t=new ri({props:{activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],url:e[25].url,geometryType:e[25].geometryType?e[25].geometryType:"polygons",id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&16&&(o.activeViewID=n[4]),i&32&&(o.activeEraID=n[5]),i&64&&(o.activeStopID=n[6]),i&1&&(o.url=n[25].url),i&1&&(o.geometryType=n[25].geometryType?n[25].geometryType:"polygons"),i&1&&(o.id=n[25].id),i&128&&(o.projection=n[7]),i&81&&(o.visible=n[6]==null&&n[0].views[n[4]].maps&&n[0].views[n[4]].maps.includes(n[25].id)||n[6]&&n[0].views[n[4]].stops[n[6]].maps&&n[0].views[n[4]].stops[n[6]].maps.includes(n[25].id)),t.$set(o)},i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){ie(t.$$.fragment,n),r=!1},d(n){Ie(t,n)}}}function jr(e){let t,r,n={activeViewID:e[4],activeEraID:e[5],activeStopID:e[6],url:e[25].url,geometryType:e[25].geometryType?e[25].geometryType:"polygons",id:e[25].id,projection:e[7],visible:e[6]==null&&e[0].views[e[4]].maps&&e[0].views[e[4]].maps.includes(e[25].id)||e[6]&&e[0].views[e[4]].stops[e[6]].maps&&e[0].views[e[4]].stops[e[6]].maps.includes(e[25].id),interactive:!0};return t=new ri({props:n}),e[16](t),t.$on("featureMouseOver",e[9]),t.$on("featureMouseOut",e[10]),t.$on("featureClick",e[11]),{c(){Me(t.$$.fragment)},l(i){Se(t.$$.fragment,i)},m(i,o){Ee(t,i,o),r=!0},p(i,o){const l={};o&16&&(l.activeViewID=i[4]),o&32&&(l.activeEraID=i[5]),o&64&&(l.activeStopID=i[6]),o&1&&(l.url=i[25].url),o&1&&(l.geometryType=i[25].geometryType?i[25].geometryType:"polygons"),o&1&&(l.id=i[25].id),o&128&&(l.projection=i[7]),o&81&&(l.visible=i[6]==null&&i[0].views[i[4]].maps&&i[0].views[i[4]].maps.includes(i[25].id)||i[6]&&i[0].views[i[4]].stops[i[6]].maps&&i[0].views[i[4]].stops[i[6]].maps.includes(i[25].id)),t.$set(l)},i(i){r||(x(t.$$.fragment,i),r=!0)},o(i){ie(t.$$.fragment,i),r=!1},d(i){e[16](null),Ie(t,i)}}}function Fn(e){let t,r,n,i;const o=[Ar,qr,Jr],l=[];function s(c,h){return c[25].type=="shapefile"?0:c[25].type=="tile"?1:c[25].type=="label"?2:-1}return~(t=s(e))&&(r=l[t]=o[t](e)),{c(){r&&r.c(),n=ne()},l(c){r&&r.l(c),n=ne()},m(c,h){~t&&l[t].m(c,h),X(c,n,h),i=!0},p(c,h){let u=t;t=s(c),t===u?~t&&l[t].p(c,h):(r&&(dt(),ie(l[u],1,1,()=>{l[u]=null}),_t()),~t?(r=l[t],r?r.p(c,h):(r=l[t]=o[t](c),r.c()),x(r,1),r.m(n.parentNode,n)):r=null)},i(c){i||(x(r),i=!0)},o(c){ie(r),i=!1},d(c){c&&T(n),~t&&l[t].d(c)}}}function Ur(e){let t,r,n,i,o,l,s,c=e[5]&&Cn(e),h=e[0].views[e[4]].story&&Pn(e),u=!e[8]&&Ln(e);return{c(){t=ge("div"),c&&c.c(),r=Ce(),h&&h.c(),n=Ce(),i=ee("svg"),o=ee("g"),u&&u.c(),this.h()},l(a){t=ve(a,"DIV",{id:!0,class:!0});var f=j(t);c&&c.l(f),r=Pe(f),h&&h.l(f),n=Pe(f),i=te(f,"svg",{id:!0,class:!0});var p=j(i);o=te(p,"g",{});var d=j(o);u&&u.l(d),d.forEach(T),p.forEach(T),f.forEach(T),this.h()},h(){M(i,"id","map-svg"),M(i,"class","svelte-hmrxqh"),re(i,"story",e[0].views[e[4]].story!=null),M(t,"id","map"),M(t,"class",l=`view-${e[4]} era-${e[5]} stop-${e[6]} svelte-hmrxqh`)},m(a,f){X(a,t,f),c&&c.m(t,null),Q(t,r),h&&h.m(t,null),Q(t,n),Q(t,i),Q(i,o),u&&u.m(o,null),e[17](o),e[18](i),s=!0},p(a,[f]){a[5]?c?c.p(a,f):(c=Cn(a),c.c(),c.m(t,r)):c&&(c.d(1),c=null),a[0].views[a[4]].story?h?h.p(a,f):(h=Pn(a),h.c(),h.m(t,n)):h&&(h.d(1),h=null),a[8]?u&&(dt(),ie(u,1,1,()=>{u=null}),_t()):u?(u.p(a,f),f&256&&x(u,1)):(u=Ln(a),u.c(),x(u,1),u.m(o,null)),(!s||f&17)&&re(i,"story",a[0].views[a[4]].story!=null),(!s||f&112&&l!==(l=`view-${a[4]} era-${a[5]} stop-${a[6]} svelte-hmrxqh`))&&M(t,"class",l)},i(a){s||(x(u),s=!0)},o(a){ie(u),s=!1},d(a){a&&T(t),c&&c.d(),h&&h.d(),u&&u.d(),e[17](null),e[18](null)}}}const Xr=4e3;function Vn(e){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[e.nwLng,e.nwLat],[e.seLng,e.nwLat],[e.seLng,e.seLat],[e.nwLng,e.seLat],[e.nwLng,e.nwLat]]],type:"Polygon"}}]}}function Br(e,t,r){let{story:n={}}=t;function i(b){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(b.detail)+")"),s&&s.onChapterMouseOver(b)}function o(b){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(b.detail)+")"),s&&s.onChapterMouseLeave(b)}function l(b){console.log(`Maps:onNavigate(event:${JSON.stringify(b.detail)})`),r(4,p=b.detail.viewID),r(5,d=b.detail.eraID),r(6,E=null),n.views[p].extent&&_(n.views[p].extent)}let s,c,h,u,a,f,p=n.intialView,d=null,E=null,S,w=!0;mt(()=>{console.log("Maps:onMount()"),u=parseInt(ue(c).style("width"),10),a=parseInt(ue(c).style("height"),10),console.log(`Map width: ${u}; height: ${a}`),r(7,S=sr().rotate([74,0]).fitSize([u,a],Vn(n.views[n.intialView].extent))),r(8,w=!1)}),f=dr().on("zoom",k);const D=Bt();function _(b){console.log(`Maps:moveMap(extent:${JSON.stringify(b)}`),u=parseInt(ue("#map-svg").style("width"),10),a=parseInt(ue("#map-svg").style("height"),10),console.log(`Map width: ${u}; height: ${a}`);const Y=Vn(b);var g=Kt().projection(S);const v=g.bounds(Y),[[m,I],[z,N]]=v;ue(h).transition().duration(Xr).ease(hi).call(f.transform,Wt.translate(u/2,a/2).scale(.9/Math.max((z-m)/u,(N-I)/a)).translate(-(m+z)/2,-(I+N)/2))}function k(b){const{transform:Y}=b;ue(h).attr("transform",Y)}function y(b){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(b.detail)+")"),D("featureMouseOver",b.detail)}function O(b){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(b.detail)+")"),D("featureMouseOut",b.detail)}function P(b){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(b.detail)+")"),D("featureClick",b.detail)}function R(b){console.log(`Maps:onStop(stopID:${b})`),r(6,E=b),b?n.views[p].stops&&n.views[p].stops[E]&&_(n.views[p].stops[E].extent):_(n.views[p].extent)}function F(b){Te[b?"unshift":"push"](()=>{s=b,r(1,s)})}function q(b){Te[b?"unshift":"push"](()=>{h=b,r(3,h)})}function C(b){Te[b?"unshift":"push"](()=>{c=b,r(2,c)})}return e.$$set=b=>{"story"in b&&r(0,n=b.story)},[n,s,c,h,p,d,E,S,w,y,O,P,R,i,o,l,F,q,C]}class Gr extends We{constructor(t){super(),Ke(this,t,Br,Ur,He,{story:0,onChapterMouseOver:13,onChapterMouseLeave:14,onNavigate:15})}get onChapterMouseOver(){return this.$$.ctx[13]}get onChapterMouseLeave(){return this.$$.ctx[14]}get onNavigate(){return this.$$.ctx[15]}}function Hr(e){let t,r,n,i,o,l,s,c,h={};t=new pi({props:h}),e[10](t),t.$on("navigate",e[8]);let u={story:je};n=new Gr({props:u}),e[11](n),n.$on("featureMouseOver",e[3]),n.$on("featureMouseOut",e[4]),n.$on("featureClick",e[7]);let a={eras:je.eras};return o=new gi({props:a}),e[12](o),o.$on("chapterMouseOver",e[5]),o.$on("chapterMouseLeave",e[6]),o.$on("navigate",e[8]),{c(){Me(t.$$.fragment),r=Ce(),Me(n.$$.fragment),i=Ce(),Me(o.$$.fragment)},l(f){Se(t.$$.fragment,f),r=Pe(f),Se(n.$$.fragment,f),i=Pe(f),Se(o.$$.fragment,f)},m(f,p){Ee(t,f,p),X(f,r,p),Ee(n,f,p),X(f,i,p),Ee(o,f,p),l=!0,s||(c=nt(window,"popstate",e[9]),s=!0)},p(f,[p]){const d={};t.$set(d);const E={};n.$set(E);const S={};o.$set(S)},i(f){l||(x(t.$$.fragment,f),x(n.$$.fragment,f),x(o.$$.fragment,f),l=!0)},o(f){ie(t.$$.fragment,f),ie(n.$$.fragment,f),ie(o.$$.fragment,f),l=!1},d(f){f&&(T(r),T(i)),e[10](null),Ie(t,f),e[11](null),Ie(n,f),e[12](null),Ie(o,f),s=!1,c()}}}function Zr(e,t,r){let n;ai(e,fi,_=>r(17,n=_));let i,o,l,s="intro";je.views[s];let c=null;function h(_){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureMouseOver(_)}function u(_){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureMouseOut(_)}function a(_){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(_.detail)+")"),l.onChapterMouseOver(_)}function f(_){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(_.detail)+")"),l.onChapterMouseLeave(_)}function p(_){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(_.detail)+")"),o.onMapFeatureClick(_)}function d(_,k=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(_.detail)})`),s=_.detail.viewID,je.views[s],c=_.detail.eraID,c&&je.eras[c],i.navigate(_),l.onNavigate(_),o.onNavigate(_),k&&si(`#/view/${_.detail.viewID}`,{state:_.detail})}function E(_){_.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(_.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(n.state)}`),_.state["sveltekit:states"].viewID&&d({detail:{..._.state["sveltekit:states"]}},!1))}function S(_){Te[_?"unshift":"push"](()=>{i=_,r(0,i)})}function w(_){Te[_?"unshift":"push"](()=>{l=_,r(2,l)})}function D(_){Te[_?"unshift":"push"](()=>{o=_,r(1,o)})}return[i,o,l,h,u,a,f,p,d,E,S,w,D]}class eo extends We{constructor(t){super(),Ke(this,t,Zr,Hr,He,{})}}export{eo as component};
