import{s as Be,Q,R as x,b as U,f as P,m as z,S as ae,i as H,h as ee,n as ze,T as Ge,U as At,x as Xt,v as ie,V as xe,F as pt,C as ri,W as oi,t as Pn,d as Rn,j as Ln,e as ye,a as tt,c as we,g as nt,X as Fn,z as it,Y as Ut,Z as jt,k as li}from"../chunks/scheduler.CdcZqrDN.js";import{S as qe,i as He,t as ne,g as Bt,e as Gt,a as oe,c as Me,b as Se,m as Ee,d as ke}from"../chunks/index.4iWIhbwD.js";import{g as ui}from"../chunks/entry.XkG6KXip.js";import{p as ai}from"../chunks/stores.DiBz-hl4.js";import{b as me,d as si,i as qt,T as gt,c as vt,e as pe,f as fi,N as ci,s as Ye,a as hi}from"../chunks/story.DXxW3QNI.js";import{b as Ht}from"../chunks/paths.Bil7IMGD.js";class Ie{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=r[i],l=t+o,s=Math.abs(t)<Math.abs(o)?t-(l-o):o-(l-t);s&&(r[n++]=s),t=l}return r[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let r=this._n,n,i,o,l=0;if(r>0){for(l=t[--r];r>0&&(n=l,i=t[--r],l=n+i,o=i-(l-n),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,n=l+i,i==n-l&&(l=n))}return l}}function*pi(e){for(const t of e)yield*t}function Jn(e){return Array.from(pi(e))}function gi(e){let t;for(;t=e.sourceEvent;)e=t;return e}function _e(e,t){if(e=gi(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Et={capture:!0,passive:!1};function kt(e){e.preventDefault(),e.stopImmediatePropagation()}function vi(e){var t=e.document.documentElement,r=me(e).on("dragstart.drag",kt,Et);"onselectstart"in t?r.on("selectstart.drag",kt,Et):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function mi(e,t){var r=e.document.documentElement,n=me(e).on("dragstart.drag",null);t&&(n.on("click.drag",kt,Et),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var di=1e-12;function Qt(e){return((e=Math.exp(e))+1/e)/2}function _i(e){return((e=Math.exp(e))-1/e)/2}function yi(e){return((e=Math.exp(2*e))-1)/(e+1)}const wi=function e(t,r,n){function i(o,l){var s=o[0],h=o[1],v=o[2],a=l[0],u=l[1],f=l[2],m=a-s,y=u-h,S=m*m+y*y,M,p;if(S<di)p=Math.log(f/v)/t,M=function(k){return[s+k*m,h+k*y,v*Math.exp(t*k*p)]};else{var O=Math.sqrt(S),w=(f*f-v*v+n*S)/(2*v*r*O),E=(f*f-v*v-n*S)/(2*f*r*O),_=Math.log(Math.sqrt(w*w+1)-w),D=Math.log(Math.sqrt(E*E+1)-E);p=(D-_)/t,M=function(k){var b=k*p,R=Qt(_),J=v/(r*O)*(R*yi(t*b+_)-_i(_));return[s+J*m,h+J*y,v*R/Qt(t*b+_)]}}return M.duration=p*1e3*t/Math.SQRT2,M}return i.rho=function(o){var l=Math.max(.001,+o),s=l*l,h=s*s;return e(l,s,h)},i}(Math.SQRT2,2,4);function Mi(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(!(e.status===204||e.status===205))return e.json()}function Vn(e,t){return fetch(e,t).then(Mi)}var X=1e-6,Si=1e-12,V=Math.PI,te=V/2,xt=V/4,le=V*2,re=180/V,W=V/180,j=Math.abs,Yn=Math.atan,Ae=Math.atan2,G=Math.cos,Ei=Math.exp,ki=Math.log,q=Math.sin,zi=Math.sign||function(e){return e>0?1:e<0?-1:0},De=Math.sqrt,Ii=Math.tan;function Oi(e){return e>1?0:e<-1?V:Math.acos(e)}function Xe(e){return e>1?te:e<-1?-te:Math.asin(e)}function se(){}function rt(e,t){e&&tn.hasOwnProperty(e.type)&&tn[e.type](e,t)}var en={Feature:function(e,t){rt(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)rt(r[n].geometry,t)}},tn={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){zt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)zt(r[n],t,0)},Polygon:function(e,t){nn(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)nn(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)rt(r[n],t)}};function zt(e,t,r){var n=-1,i=e.length-r,o;for(t.lineStart();++n<i;)o=e[n],t.point(o[0],o[1],o[2]);t.lineEnd()}function nn(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)zt(e[r],t,1);t.polygonEnd()}function Ne(e,t){e&&en.hasOwnProperty(e.type)?en[e.type](e,t):rt(e,t)}function It(e){return[Ae(e[1],e[0]),Xe(e[2])]}function be(e){var t=e[0],r=e[1],n=G(r);return[n*G(t),n*q(t),q(r)]}function Ze(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ot(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function mt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function We(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ot(e){var t=De(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Dt(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}function Nt(e,t){return j(e)>V&&(e-=Math.round(e/le)*le),[e,t]}Nt.invert=Nt;function An(e,t,r){return(e%=le)?t||r?Dt(on(e),ln(t,r)):on(e):t||r?ln(t,r):Nt}function rn(e){return function(t,r){return t+=e,j(t)>V&&(t-=Math.round(t/le)*le),[t,r]}}function on(e){var t=rn(e);return t.invert=rn(-e),t}function ln(e,t){var r=G(e),n=q(e),i=G(t),o=q(t);function l(s,h){var v=G(h),a=G(s)*v,u=q(s)*v,f=q(h),m=f*r+a*n;return[Ae(u*i-m*o,a*r-f*n),Xe(m*i+u*o)]}return l.invert=function(s,h){var v=G(h),a=G(s)*v,u=q(s)*v,f=q(h),m=f*i-u*o;return[Ae(u*i+f*o,a*r+m*n),Xe(m*r-a*n)]},l}function Di(e){e=An(e[0]*W,e[1]*W,e.length>2?e[2]*W:0);function t(r){return r=e(r[0]*W,r[1]*W),r[0]*=re,r[1]*=re,r}return t.invert=function(r){return r=e.invert(r[0]*W,r[1]*W),r[0]*=re,r[1]*=re,r},t}function Ni(e,t,r,n,i,o){if(r){var l=G(t),s=q(t),h=n*r;i==null?(i=t+n*le,o=t-h/2):(i=un(l,i),o=un(l,o),(n>0?i<o:i>o)&&(i+=n*le));for(var v,a=i;n>0?a>o:a<o;a-=h)v=It([l,-s*G(a),-s*q(a)]),e.point(v[0],v[1])}}function un(e,t){t=be(t),t[0]-=e,Ot(t);var r=Oi(-t[1]);return((-t[2]<0?-r:r)+le-X)%le}function Xn(){var e=[],t;return{point:function(r,n,i){t.push([r,n,i])},lineStart:function(){e.push(t=[])},lineEnd:se,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function et(e,t){return j(e[0]-t[0])<X&&j(e[1]-t[1])<X}function $e(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Un(e,t,r,n,i){var o=[],l=[],s,h;if(e.forEach(function(y){if(!((S=y.length-1)<=0)){var S,M=y[0],p=y[S],O;if(et(M,p)){if(!M[2]&&!p[2]){for(i.lineStart(),s=0;s<S;++s)i.point((M=y[s])[0],M[1]);i.lineEnd();return}p[0]+=2*X}o.push(O=new $e(M,y,null,!0)),l.push(O.o=new $e(M,null,O,!1)),o.push(O=new $e(p,y,null,!1)),l.push(O.o=new $e(p,null,O,!0))}}),!!o.length){for(l.sort(t),an(o),an(l),s=0,h=l.length;s<h;++s)l[s].e=r=!r;for(var v=o[0],a,u;;){for(var f=v,m=!0;f.v;)if((f=f.n)===v)return;a=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(m)for(s=0,h=a.length;s<h;++s)i.point((u=a[s])[0],u[1]);else n(f.x,f.n.x,1,i);f=f.n}else{if(m)for(a=f.p.z,s=a.length-1;s>=0;--s)i.point((u=a[s])[0],u[1]);else n(f.x,f.p.x,-1,i);f=f.p}f=f.o,a=f.z,m=!m}while(!f.v);i.lineEnd()}}}function an(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function dt(e){return j(e[0])<=V?e[0]:zi(e[0])*((j(e[0])+V)%le-V)}function Ti(e,t){var r=dt(t),n=t[1],i=q(n),o=[q(r),-G(r),0],l=0,s=0,h=new Ie;i===1?n=te+X:i===-1&&(n=-te-X);for(var v=0,a=e.length;v<a;++v)if(f=(u=e[v]).length)for(var u,f,m=u[f-1],y=dt(m),S=m[1]/2+xt,M=q(S),p=G(S),O=0;O<f;++O,y=E,M=D,p=k,m=w){var w=u[O],E=dt(w),_=w[1]/2+xt,D=q(_),k=G(_),b=E-y,R=b>=0?1:-1,J=R*b,C=J>V,$=M*D;if(h.add(Ae($*R*q(J),p*k+$*G(J))),l+=C?b+R*le:b,C^y>=r^E>=r){var A=ot(be(m),be(w));Ot(A);var c=ot(o,A);Ot(c);var g=(C^b>=0?-1:1)*Xe(c[2]);(n>g||n===g&&(A[0]||A[1]))&&(s+=C^b>=0?1:-1)}}return(l<-X||l<X&&h<-Si)^s&1}function jn(e,t,r,n){return function(i){var o=t(i),l=Xn(),s=t(l),h=!1,v,a,u,f={point:m,lineStart:S,lineEnd:M,polygonStart:function(){f.point=p,f.lineStart=O,f.lineEnd=w,a=[],v=[]},polygonEnd:function(){f.point=m,f.lineStart=S,f.lineEnd=M,a=Jn(a);var E=Ti(v,n);a.length?(h||(i.polygonStart(),h=!0),Un(a,Ci,E,r,i)):E&&(h||(i.polygonStart(),h=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),h&&(i.polygonEnd(),h=!1),a=v=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function m(E,_){e(E,_)&&i.point(E,_)}function y(E,_){o.point(E,_)}function S(){f.point=y,o.lineStart()}function M(){f.point=m,o.lineEnd()}function p(E,_){u.push([E,_]),s.point(E,_)}function O(){s.lineStart(),u=[]}function w(){p(u[0][0],u[0][1]),s.lineEnd();var E=s.clean(),_=l.result(),D,k=_.length,b,R,J;if(u.pop(),v.push(u),u=null,!!k){if(E&1){if(R=_[0],(b=R.length-1)>0){for(h||(i.polygonStart(),h=!0),i.lineStart(),D=0;D<b;++D)i.point((J=R[D])[0],J[1]);i.lineEnd()}return}k>1&&E&2&&_.push(_.pop().concat(_.shift())),a.push(_.filter(bi))}}return f}}function bi(e){return e.length>1}function Ci(e,t){return((e=e.x)[0]<0?e[1]-te-X:te-e[1])-((t=t.x)[0]<0?t[1]-te-X:te-t[1])}const sn=jn(function(){return!0},Pi,Li,[-V,-te]);function Pi(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(o,l){var s=o>0?V:-V,h=j(o-t);j(h-V)<X?(e.point(t,r=(r+l)/2>0?te:-te),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(o,r),i=0):n!==s&&h>=V&&(j(t-n)<X&&(t-=n*X),j(o-s)<X&&(o-=s*X),r=Ri(t,r,o,l),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(s,r),i=0),e.point(t=o,r=l),n=s},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Ri(e,t,r,n){var i,o,l=q(e-r);return j(l)>X?Yn((q(t)*(o=G(n))*q(r)-q(n)*(i=G(t))*q(e))/(i*o*l)):(t+n)/2}function Li(e,t,r,n){var i;if(e==null)i=r*te,n.point(-V,i),n.point(0,i),n.point(V,i),n.point(V,0),n.point(V,-i),n.point(0,-i),n.point(-V,-i),n.point(-V,0),n.point(-V,i);else if(j(e[0]-t[0])>X){var o=e[0]<t[0]?V:-V;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])}function Fi(e){var t=G(e),r=2*W,n=t>0,i=j(t)>X;function o(a,u,f,m){Ni(m,e,r,f,a,u)}function l(a,u){return G(a)*G(u)>t}function s(a){var u,f,m,y,S;return{lineStart:function(){y=m=!1,S=1},point:function(M,p){var O=[M,p],w,E=l(M,p),_=n?E?0:v(M,p):E?v(M+(M<0?V:-V),p):0;if(!u&&(y=m=E)&&a.lineStart(),E!==m&&(w=h(u,O),(!w||et(u,w)||et(O,w))&&(O[2]=1)),E!==m)S=0,E?(a.lineStart(),w=h(O,u),a.point(w[0],w[1])):(w=h(u,O),a.point(w[0],w[1],2),a.lineEnd()),u=w;else if(i&&u&&n^E){var D;!(_&f)&&(D=h(O,u,!0))&&(S=0,n?(a.lineStart(),a.point(D[0][0],D[0][1]),a.point(D[1][0],D[1][1]),a.lineEnd()):(a.point(D[1][0],D[1][1]),a.lineEnd(),a.lineStart(),a.point(D[0][0],D[0][1],3)))}E&&(!u||!et(u,O))&&a.point(O[0],O[1]),u=O,m=E,f=_},lineEnd:function(){m&&a.lineEnd(),u=null},clean:function(){return S|(y&&m)<<1}}}function h(a,u,f){var m=be(a),y=be(u),S=[1,0,0],M=ot(m,y),p=Ze(M,M),O=M[0],w=p-O*O;if(!w)return!f&&a;var E=t*p/w,_=-t*O/w,D=ot(S,M),k=We(S,E),b=We(M,_);mt(k,b);var R=D,J=Ze(k,R),C=Ze(R,R),$=J*J-C*(Ze(k,k)-1);if(!($<0)){var A=De($),c=We(R,(-J-A)/C);if(mt(c,k),c=It(c),!f)return c;var g=a[0],d=u[0],I=a[1],N=u[1],T;d<g&&(T=g,g=d,d=T);var L=d-g,F=j(L-V)<X,Y=F||L<X;if(!F&&N<I&&(T=I,I=N,N=T),Y?F?I+N>0^c[1]<(j(c[0]-g)<X?I:N):I<=c[1]&&c[1]<=N:L>V^(g<=c[0]&&c[0]<=d)){var Z=We(R,(-J+A)/C);return mt(Z,k),[c,It(Z)]}}}function v(a,u){var f=n?e:V-e,m=0;return a<-f?m|=1:a>f&&(m|=2),u<-f?m|=4:u>f&&(m|=8),m}return jn(l,s,o,n?[0,-e]:[-V,e-V])}function Ji(e,t,r,n,i,o){var l=e[0],s=e[1],h=t[0],v=t[1],a=0,u=1,f=h-l,m=v-s,y;if(y=r-l,!(!f&&y>0)){if(y/=f,f<0){if(y<a)return;y<u&&(u=y)}else if(f>0){if(y>u)return;y>a&&(a=y)}if(y=i-l,!(!f&&y<0)){if(y/=f,f<0){if(y>u)return;y>a&&(a=y)}else if(f>0){if(y<a)return;y<u&&(u=y)}if(y=n-s,!(!m&&y>0)){if(y/=m,m<0){if(y<a)return;y<u&&(u=y)}else if(m>0){if(y>u)return;y>a&&(a=y)}if(y=o-s,!(!m&&y<0)){if(y/=m,m<0){if(y>u)return;y>a&&(a=y)}else if(m>0){if(y<a)return;y<u&&(u=y)}return a>0&&(e[0]=l+a*f,e[1]=s+a*m),u<1&&(t[0]=l+u*f,t[1]=s+u*m),!0}}}}}var Re=1e9,Ke=-Re;function Vi(e,t,r,n){function i(v,a){return e<=v&&v<=r&&t<=a&&a<=n}function o(v,a,u,f){var m=0,y=0;if(v==null||(m=l(v,u))!==(y=l(a,u))||h(v,a)<0^u>0)do f.point(m===0||m===3?e:r,m>1?n:t);while((m=(m+u+4)%4)!==y);else f.point(a[0],a[1])}function l(v,a){return j(v[0]-e)<X?a>0?0:3:j(v[0]-r)<X?a>0?2:1:j(v[1]-t)<X?a>0?1:0:a>0?3:2}function s(v,a){return h(v.x,a.x)}function h(v,a){var u=l(v,1),f=l(a,1);return u!==f?u-f:u===0?a[1]-v[1]:u===1?v[0]-a[0]:u===2?v[1]-a[1]:a[0]-v[0]}return function(v){var a=v,u=Xn(),f,m,y,S,M,p,O,w,E,_,D,k={point:b,lineStart:$,lineEnd:A,polygonStart:J,polygonEnd:C};function b(g,d){i(g,d)&&a.point(g,d)}function R(){for(var g=0,d=0,I=m.length;d<I;++d)for(var N=m[d],T=1,L=N.length,F=N[0],Y,Z,B=F[0],K=F[1];T<L;++T)Y=B,Z=K,F=N[T],B=F[0],K=F[1],Z<=n?K>n&&(B-Y)*(n-Z)>(K-Z)*(e-Y)&&++g:K<=n&&(B-Y)*(n-Z)<(K-Z)*(e-Y)&&--g;return g}function J(){a=u,f=[],m=[],D=!0}function C(){var g=R(),d=D&&g,I=(f=Jn(f)).length;(d||I)&&(v.polygonStart(),d&&(v.lineStart(),o(null,null,1,v),v.lineEnd()),I&&Un(f,s,g,o,v),v.polygonEnd()),a=v,f=m=y=null}function $(){k.point=c,m&&m.push(y=[]),_=!0,E=!1,O=w=NaN}function A(){f&&(c(S,M),p&&E&&u.rejoin(),f.push(u.result())),k.point=b,E&&a.lineEnd()}function c(g,d){var I=i(g,d);if(m&&y.push([g,d]),_)S=g,M=d,p=I,_=!1,I&&(a.lineStart(),a.point(g,d));else if(I&&E)a.point(g,d);else{var N=[O=Math.max(Ke,Math.min(Re,O)),w=Math.max(Ke,Math.min(Re,w))],T=[g=Math.max(Ke,Math.min(Re,g)),d=Math.max(Ke,Math.min(Re,d))];Ji(N,T,e,t,r,n)?(E||(a.lineStart(),a.point(N[0],N[1])),a.point(T[0],T[1]),I||a.lineEnd(),D=!1):I&&(a.lineStart(),a.point(g,d),D=!1)}O=g,w=d,E=I}return k}}const Tt=e=>e;var _t=new Ie,bt=new Ie,Bn,Gn,Ct,Pt,de={point:se,lineStart:se,lineEnd:se,polygonStart:function(){de.lineStart=Yi,de.lineEnd=Xi},polygonEnd:function(){de.lineStart=de.lineEnd=de.point=se,_t.add(j(bt)),bt=new Ie},result:function(){var e=_t/2;return _t=new Ie,e}};function Yi(){de.point=Ai}function Ai(e,t){de.point=qn,Bn=Ct=e,Gn=Pt=t}function qn(e,t){bt.add(Pt*e-Ct*t),Ct=e,Pt=t}function Xi(){qn(Bn,Gn)}var Ce=1/0,lt=Ce,Ue=-Ce,ut=Ue,at={point:Ui,lineStart:se,lineEnd:se,polygonStart:se,polygonEnd:se,result:function(){var e=[[Ce,lt],[Ue,ut]];return Ue=ut=-(lt=Ce=1/0),e}};function Ui(e,t){e<Ce&&(Ce=e),e>Ue&&(Ue=e),t<lt&&(lt=t),t>ut&&(ut=t)}var Rt=0,Lt=0,Le=0,st=0,ft=0,Te=0,Ft=0,Jt=0,Fe=0,Hn,Zn,ce,he,ue={point:Oe,lineStart:fn,lineEnd:cn,polygonStart:function(){ue.lineStart=Gi,ue.lineEnd=qi},polygonEnd:function(){ue.point=Oe,ue.lineStart=fn,ue.lineEnd=cn},result:function(){var e=Fe?[Ft/Fe,Jt/Fe]:Te?[st/Te,ft/Te]:Le?[Rt/Le,Lt/Le]:[NaN,NaN];return Rt=Lt=Le=st=ft=Te=Ft=Jt=Fe=0,e}};function Oe(e,t){Rt+=e,Lt+=t,++Le}function fn(){ue.point=ji}function ji(e,t){ue.point=Bi,Oe(ce=e,he=t)}function Bi(e,t){var r=e-ce,n=t-he,i=De(r*r+n*n);st+=i*(ce+e)/2,ft+=i*(he+t)/2,Te+=i,Oe(ce=e,he=t)}function cn(){ue.point=Oe}function Gi(){ue.point=Hi}function qi(){Wn(Hn,Zn)}function Hi(e,t){ue.point=Wn,Oe(Hn=ce=e,Zn=he=t)}function Wn(e,t){var r=e-ce,n=t-he,i=De(r*r+n*n);st+=i*(ce+e)/2,ft+=i*(he+t)/2,Te+=i,i=he*e-ce*t,Ft+=i*(ce+e),Jt+=i*(he+t),Fe+=i*3,Oe(ce=e,he=t)}function $n(e){this._context=e}$n.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,le);break}}},result:se};var Vt=new Ie,yt,Kn,Qn,Je,Ve,je={point:se,lineStart:function(){je.point=Zi},lineEnd:function(){yt&&xn(Kn,Qn),je.point=se},polygonStart:function(){yt=!0},polygonEnd:function(){yt=null},result:function(){var e=+Vt;return Vt=new Ie,e}};function Zi(e,t){je.point=xn,Kn=Je=e,Qn=Ve=t}function xn(e,t){Je-=e,Ve-=t,Vt.add(De(Je*Je+Ve*Ve)),Je=e,Ve=t}let hn,ct,pn,gn;class vn{constructor(t){this._append=t==null?ei:Wi(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==pn||this._append!==ct){const n=this._radius,i=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,pn=n,ct=this._append,gn=this._,this._=i}this._+=gn;break}}}result(){const t=this._;return this._="",t.length?t:null}}function ei(e){let t=1;this._+=e[0];for(const r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Wi(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return ei;if(t!==hn){const r=10**t;hn=t,ct=function(i){let o=1;this._+=i[0];for(const l=i.length;o<l;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return ct}function Zt(e,t){let r=3,n=4.5,i,o;function l(s){return s&&(typeof n=="function"&&o.pointRadius(+n.apply(this,arguments)),Ne(s,i(o))),o.result()}return l.area=function(s){return Ne(s,i(de)),de.result()},l.measure=function(s){return Ne(s,i(je)),je.result()},l.bounds=function(s){return Ne(s,i(at)),at.result()},l.centroid=function(s){return Ne(s,i(ue)),ue.result()},l.projection=function(s){return arguments.length?(i=s==null?(e=null,Tt):(e=s).stream,l):e},l.context=function(s){return arguments.length?(o=s==null?(t=null,new vn(r)):new $n(t=s),typeof n!="function"&&o.pointRadius(n),l):t},l.pointRadius=function(s){return arguments.length?(n=typeof s=="function"?s:(o.pointRadius(+s),+s),l):n},l.digits=function(s){if(!arguments.length)return r;if(s==null)r=null;else{const h=Math.floor(s);if(!(h>=0))throw new RangeError(`invalid digits: ${s}`);r=h}return t===null&&(o=new vn(r)),l},l.projection(e).digits(r).context(t)}function Wt(e){return function(t){var r=new Yt;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Yt(){}Yt.prototype={constructor:Yt,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function $t(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),Ne(r,e.stream(at)),t(at.result()),n!=null&&e.clipExtent(n),e}function ti(e,t,r){return $t(e,function(n){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],l=Math.min(i/(n[1][0]-n[0][0]),o/(n[1][1]-n[0][1])),s=+t[0][0]+(i-l*(n[1][0]+n[0][0]))/2,h=+t[0][1]+(o-l*(n[1][1]+n[0][1]))/2;e.scale(150*l).translate([s,h])},r)}function $i(e,t,r){return ti(e,[[0,0],t],r)}function Ki(e,t,r){return $t(e,function(n){var i=+t,o=i/(n[1][0]-n[0][0]),l=(i-o*(n[1][0]+n[0][0]))/2,s=-o*n[0][1];e.scale(150*o).translate([l,s])},r)}function Qi(e,t,r){return $t(e,function(n){var i=+t,o=i/(n[1][1]-n[0][1]),l=-o*n[0][0],s=(i-o*(n[1][1]+n[0][1]))/2;e.scale(150*o).translate([l,s])},r)}var mn=16,xi=G(30*W);function dn(e,t){return+t?tr(e,t):er(e)}function er(e){return Wt({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function tr(e,t){function r(n,i,o,l,s,h,v,a,u,f,m,y,S,M){var p=v-n,O=a-i,w=p*p+O*O;if(w>4*t&&S--){var E=l+f,_=s+m,D=h+y,k=De(E*E+_*_+D*D),b=Xe(D/=k),R=j(j(D)-1)<X||j(o-u)<X?(o+u)/2:Ae(_,E),J=e(R,b),C=J[0],$=J[1],A=C-n,c=$-i,g=O*A-p*c;(g*g/w>t||j((p*A+O*c)/w-.5)>.3||l*f+s*m+h*y<xi)&&(r(n,i,o,l,s,h,C,$,R,E/=k,_/=k,D,S,M),M.point(C,$),r(C,$,R,E,_,D,v,a,u,f,m,y,S,M))}}return function(n){var i,o,l,s,h,v,a,u,f,m,y,S,M={point:p,lineStart:O,lineEnd:E,polygonStart:function(){n.polygonStart(),M.lineStart=_},polygonEnd:function(){n.polygonEnd(),M.lineStart=O}};function p(b,R){b=e(b,R),n.point(b[0],b[1])}function O(){u=NaN,M.point=w,n.lineStart()}function w(b,R){var J=be([b,R]),C=e(b,R);r(u,f,a,m,y,S,u=C[0],f=C[1],a=b,m=J[0],y=J[1],S=J[2],mn,n),n.point(u,f)}function E(){M.point=p,n.lineEnd()}function _(){O(),M.point=D,M.lineEnd=k}function D(b,R){w(i=b,R),o=u,l=f,s=m,h=y,v=S,M.point=w}function k(){r(u,f,a,m,y,S,o,l,i,s,h,v,mn,n),M.lineEnd=E,E()}return M}}var nr=Wt({point:function(e,t){this.stream.point(e*W,t*W)}});function ir(e){return Wt({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function rr(e,t,r,n,i){function o(l,s){return l*=n,s*=i,[t+e*l,r-e*s]}return o.invert=function(l,s){return[(l-t)/e*n,(r-s)/e*i]},o}function _n(e,t,r,n,i,o){if(!o)return rr(e,t,r,n,i);var l=G(o),s=q(o),h=l*e,v=s*e,a=l/e,u=s/e,f=(s*r-l*t)/e,m=(s*t+l*r)/e;function y(S,M){return S*=n,M*=i,[h*S-v*M+t,r-v*S-h*M]}return y.invert=function(S,M){return[n*(a*S-u*M+f),i*(m-u*S-a*M)]},y}function or(e){return lr(function(){return e})()}function lr(e){var t,r=150,n=480,i=250,o=0,l=0,s=0,h=0,v=0,a,u=0,f=1,m=1,y=null,S=sn,M=null,p,O,w,E=Tt,_=.5,D,k,b,R,J;function C(g){return b(g[0]*W,g[1]*W)}function $(g){return g=b.invert(g[0],g[1]),g&&[g[0]*re,g[1]*re]}C.stream=function(g){return R&&J===g?R:R=nr(ir(a)(S(D(E(J=g)))))},C.preclip=function(g){return arguments.length?(S=g,y=void 0,c()):S},C.postclip=function(g){return arguments.length?(E=g,M=p=O=w=null,c()):E},C.clipAngle=function(g){return arguments.length?(S=+g?Fi(y=g*W):(y=null,sn),c()):y*re},C.clipExtent=function(g){return arguments.length?(E=g==null?(M=p=O=w=null,Tt):Vi(M=+g[0][0],p=+g[0][1],O=+g[1][0],w=+g[1][1]),c()):M==null?null:[[M,p],[O,w]]},C.scale=function(g){return arguments.length?(r=+g,A()):r},C.translate=function(g){return arguments.length?(n=+g[0],i=+g[1],A()):[n,i]},C.center=function(g){return arguments.length?(o=g[0]%360*W,l=g[1]%360*W,A()):[o*re,l*re]},C.rotate=function(g){return arguments.length?(s=g[0]%360*W,h=g[1]%360*W,v=g.length>2?g[2]%360*W:0,A()):[s*re,h*re,v*re]},C.angle=function(g){return arguments.length?(u=g%360*W,A()):u*re},C.reflectX=function(g){return arguments.length?(f=g?-1:1,A()):f<0},C.reflectY=function(g){return arguments.length?(m=g?-1:1,A()):m<0},C.precision=function(g){return arguments.length?(D=dn(k,_=g*g),c()):De(_)},C.fitExtent=function(g,d){return ti(C,g,d)},C.fitSize=function(g,d){return $i(C,g,d)},C.fitWidth=function(g,d){return Ki(C,g,d)},C.fitHeight=function(g,d){return Qi(C,g,d)};function A(){var g=_n(r,0,0,f,m,u).apply(null,t(o,l)),d=_n(r,n-g[0],i-g[1],f,m,u);return a=An(s,h,v),k=Dt(t,d),b=Dt(a,k),D=dn(k,_),c()}function c(){return R=J=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&$,A()}}function Kt(e,t){return[e,ki(Ii((te+t)/2))]}Kt.invert=function(e,t){return[e,2*Yn(Ei(t))-te]};function ur(){return ar(Kt).scale(961/le)}function ar(e){var t=or(e),r=t.center,n=t.scale,i=t.translate,o=t.clipExtent,l=null,s,h,v;t.scale=function(u){return arguments.length?(n(u),a()):n()},t.translate=function(u){return arguments.length?(i(u),a()):i()},t.center=function(u){return arguments.length?(r(u),a()):r()},t.clipExtent=function(u){return arguments.length?(u==null?l=s=h=v=null:(l=+u[0][0],s=+u[0][1],h=+u[1][0],v=+u[1][1]),a()):l==null?null:[[l,s],[h,v]]};function a(){var u=V*n(),f=t(Di(t.rotate()).invert([0,0]));return o(l==null?[[f[0]-u,f[1]-u],[f[0]+u,f[1]+u]]:e===Kt?[[Math.max(f[0]-u,l),s],[Math.min(f[0]+u,h),v]]:[[l,Math.max(f[1]-u,s)],[h,Math.min(f[1]+u,v)]])}return a()}const Qe=e=>()=>e;function sr(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function wt(e){e.stopImmediatePropagation()}function Pe(e){e.preventDefault(),e.stopImmediatePropagation()}function fr(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function cr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function yn(){return this.__zoom||qt}function hr(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function pr(){return navigator.maxTouchPoints||"ontouchstart"in this}function gr(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],o=e.invertY(t[0][1])-r[0][1],l=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),l>o?(o+l)/2:Math.min(0,o)||Math.max(0,l))}function vr(){var e=fr,t=cr,r=gr,n=hr,i=pr,o=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],s=250,h=wi,v=si("start","zoom","end"),a,u,f,m=500,y=150,S=0,M=10;function p(c){c.property("__zoom",yn).on("wheel.zoom",b,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",J).filter(i).on("touchstart.zoom",C).on("touchmove.zoom",$).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.transform=function(c,g,d,I){var N=c.selection?c.selection():c;N.property("__zoom",yn),c!==N?_(c,g,d,I):N.interrupt().each(function(){D(this,arguments).event(I).start().zoom(null,typeof g=="function"?g.apply(this,arguments):g).end()})},p.scaleBy=function(c,g,d,I){p.scaleTo(c,function(){var N=this.__zoom.k,T=typeof g=="function"?g.apply(this,arguments):g;return N*T},d,I)},p.scaleTo=function(c,g,d,I){p.transform(c,function(){var N=t.apply(this,arguments),T=this.__zoom,L=d==null?E(N):typeof d=="function"?d.apply(this,arguments):d,F=T.invert(L),Y=typeof g=="function"?g.apply(this,arguments):g;return r(w(O(T,Y),L,F),N,l)},d,I)},p.translateBy=function(c,g,d,I){p.transform(c,function(){return r(this.__zoom.translate(typeof g=="function"?g.apply(this,arguments):g,typeof d=="function"?d.apply(this,arguments):d),t.apply(this,arguments),l)},null,I)},p.translateTo=function(c,g,d,I,N){p.transform(c,function(){var T=t.apply(this,arguments),L=this.__zoom,F=I==null?E(T):typeof I=="function"?I.apply(this,arguments):I;return r(qt.translate(F[0],F[1]).scale(L.k).translate(typeof g=="function"?-g.apply(this,arguments):-g,typeof d=="function"?-d.apply(this,arguments):-d),T,l)},I,N)};function O(c,g){return g=Math.max(o[0],Math.min(o[1],g)),g===c.k?c:new gt(g,c.x,c.y)}function w(c,g,d){var I=g[0]-d[0]*c.k,N=g[1]-d[1]*c.k;return I===c.x&&N===c.y?c:new gt(c.k,I,N)}function E(c){return[(+c[0][0]+ +c[1][0])/2,(+c[0][1]+ +c[1][1])/2]}function _(c,g,d,I){c.on("start.zoom",function(){D(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(I).end()}).tween("zoom",function(){var N=this,T=arguments,L=D(N,T).event(I),F=t.apply(N,T),Y=d==null?E(F):typeof d=="function"?d.apply(N,T):d,Z=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),B=N.__zoom,K=typeof g=="function"?g.apply(N,T):g,ge=h(B.invert(Y).concat(Z/B.k),K.invert(Y).concat(Z/K.k));return function(fe){if(fe===1)fe=K;else{var ve=ge(fe),ht=Z/ve[2];fe=new gt(ht,Y[0]-ve[0]*ht,Y[1]-ve[1]*ht)}L.zoom(null,fe)}})}function D(c,g,d){return!d&&c.__zooming||new k(c,g)}function k(c,g){this.that=c,this.args=g,this.active=0,this.sourceEvent=null,this.extent=t.apply(c,g),this.taps=0}k.prototype={event:function(c){return c&&(this.sourceEvent=c),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(c,g){return this.mouse&&c!=="mouse"&&(this.mouse[1]=g.invert(this.mouse[0])),this.touch0&&c!=="touch"&&(this.touch0[1]=g.invert(this.touch0[0])),this.touch1&&c!=="touch"&&(this.touch1[1]=g.invert(this.touch1[0])),this.that.__zoom=g,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(c){var g=me(this.that).datum();v.call(c,this.that,new sr(c,{sourceEvent:this.sourceEvent,target:p,type:c,transform:this.that.__zoom,dispatch:v}),g)}};function b(c,...g){if(!e.apply(this,arguments))return;var d=D(this,g).event(c),I=this.__zoom,N=Math.max(o[0],Math.min(o[1],I.k*Math.pow(2,n.apply(this,arguments)))),T=_e(c);if(d.wheel)(d.mouse[0][0]!==T[0]||d.mouse[0][1]!==T[1])&&(d.mouse[1]=I.invert(d.mouse[0]=T)),clearTimeout(d.wheel);else{if(I.k===N)return;d.mouse=[T,I.invert(T)],vt(this),d.start()}Pe(c),d.wheel=setTimeout(L,y),d.zoom("mouse",r(w(O(I,N),d.mouse[0],d.mouse[1]),d.extent,l));function L(){d.wheel=null,d.end()}}function R(c,...g){if(f||!e.apply(this,arguments))return;var d=c.currentTarget,I=D(this,g,!0).event(c),N=me(c.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",Z,!0),T=_e(c,d),L=c.clientX,F=c.clientY;vi(c.view),wt(c),I.mouse=[T,this.__zoom.invert(T)],vt(this),I.start();function Y(B){if(Pe(B),!I.moved){var K=B.clientX-L,ge=B.clientY-F;I.moved=K*K+ge*ge>S}I.event(B).zoom("mouse",r(w(I.that.__zoom,I.mouse[0]=_e(B,d),I.mouse[1]),I.extent,l))}function Z(B){N.on("mousemove.zoom mouseup.zoom",null),mi(B.view,I.moved),Pe(B),I.event(B).end()}}function J(c,...g){if(e.apply(this,arguments)){var d=this.__zoom,I=_e(c.changedTouches?c.changedTouches[0]:c,this),N=d.invert(I),T=d.k*(c.shiftKey?.5:2),L=r(w(O(d,T),I,N),t.apply(this,g),l);Pe(c),s>0?me(this).transition().duration(s).call(_,L,I,c):me(this).call(p.transform,L,I,c)}}function C(c,...g){if(e.apply(this,arguments)){var d=c.touches,I=d.length,N=D(this,g,c.changedTouches.length===I).event(c),T,L,F,Y;for(wt(c),L=0;L<I;++L)F=d[L],Y=_e(F,this),Y=[Y,this.__zoom.invert(Y),F.identifier],N.touch0?!N.touch1&&N.touch0[2]!==Y[2]&&(N.touch1=Y,N.taps=0):(N.touch0=Y,T=!0,N.taps=1+!!a);a&&(a=clearTimeout(a)),T&&(N.taps<2&&(u=Y[0],a=setTimeout(function(){a=null},m)),vt(this),N.start())}}function $(c,...g){if(this.__zooming){var d=D(this,g).event(c),I=c.changedTouches,N=I.length,T,L,F,Y;for(Pe(c),T=0;T<N;++T)L=I[T],F=_e(L,this),d.touch0&&d.touch0[2]===L.identifier?d.touch0[0]=F:d.touch1&&d.touch1[2]===L.identifier&&(d.touch1[0]=F);if(L=d.that.__zoom,d.touch1){var Z=d.touch0[0],B=d.touch0[1],K=d.touch1[0],ge=d.touch1[1],fe=(fe=K[0]-Z[0])*fe+(fe=K[1]-Z[1])*fe,ve=(ve=ge[0]-B[0])*ve+(ve=ge[1]-B[1])*ve;L=O(L,Math.sqrt(fe/ve)),F=[(Z[0]+K[0])/2,(Z[1]+K[1])/2],Y=[(B[0]+ge[0])/2,(B[1]+ge[1])/2]}else if(d.touch0)F=d.touch0[0],Y=d.touch0[1];else return;d.zoom("touch",r(w(L,F,Y),d.extent,l))}}function A(c,...g){if(this.__zooming){var d=D(this,g).event(c),I=c.changedTouches,N=I.length,T,L;for(wt(c),f&&clearTimeout(f),f=setTimeout(function(){f=null},m),T=0;T<N;++T)L=I[T],d.touch0&&d.touch0[2]===L.identifier?delete d.touch0:d.touch1&&d.touch1[2]===L.identifier&&delete d.touch1;if(d.touch1&&!d.touch0&&(d.touch0=d.touch1,delete d.touch1),d.touch0)d.touch0[1]=this.__zoom.invert(d.touch0[0]);else if(d.end(),d.taps===2&&(L=_e(L,this),Math.hypot(u[0]-L[0],u[1]-L[1])<M)){var F=me(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return p.wheelDelta=function(c){return arguments.length?(n=typeof c=="function"?c:Qe(+c),p):n},p.filter=function(c){return arguments.length?(e=typeof c=="function"?c:Qe(!!c),p):e},p.touchable=function(c){return arguments.length?(i=typeof c=="function"?c:Qe(!!c),p):i},p.extent=function(c){return arguments.length?(t=typeof c=="function"?c:Qe([[+c[0][0],+c[0][1]],[+c[1][0],+c[1][1]]]),p):t},p.scaleExtent=function(c){return arguments.length?(o[0]=+c[0],o[1]=+c[1],p):[o[0],o[1]]},p.translateExtent=function(c){return arguments.length?(l[0][0]=+c[0][0],l[1][0]=+c[1][0],l[0][1]=+c[0][1],l[1][1]=+c[1][1],p):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},p.constrain=function(c){return arguments.length?(r=c,p):r},p.duration=function(c){return arguments.length?(s=+c,p):s},p.interpolate=function(c){return arguments.length?(h=c,p):h},p.on=function(){var c=v.on.apply(v,arguments);return c===v?p:c},p.clickDistance=function(c){return arguments.length?(S=(c=+c)*c,p):Math.sqrt(S)},p.tapDistance=function(c){return arguments.length?(M=+c,p):M},p}function wn(e,t,r){const n=e.slice();return n[18]=t[r],n}function mr(e){let t,r,n;return{c(){t=Q("circle"),this.h()},l(i){t=x(i,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),U(t).forEach(P),this.h()},h(){z(t,"cx",r=e[0](e[18])[0]),z(t,"cy",n=e[0](e[18])[1]),z(t,"r","30"),z(t,"fill","#599FF0")},m(i,o){H(i,t,o)},p(i,o){o&257&&r!==(r=i[0](i[18])[0])&&z(t,"cx",r),o&257&&n!==(n=i[0](i[18])[1])&&z(t,"cy",n)},d(i){i&&P(t)}}}function dr(e){let t;function r(o,l){return o[2]?yr:_r}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),H(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&P(t),i.d(o)}}}function _r(e){let t,r;return{c(){t=Q("path"),this.h()},l(n){t=x(n,"path",{d:!0,class:!0}),U(t).forEach(P),this.h()},h(){z(t,"d",r=e[9](e[18])),z(t,"class","svelte-m64nol")},m(n,i){H(n,t,i)},p(n,i){i&768&&r!==(r=n[9](n[18]))&&z(t,"d",r)},d(n){n&&P(t)}}}function yr(e){let t,r,n,i;return{c(){t=Q("path"),this.h()},l(o){t=x(o,"path",{d:!0,class:!0}),U(t).forEach(P),this.h()},h(){z(t,"d",r=e[9](e[18])),z(t,"class","svelte-m64nol"),ae(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},m(o,l){H(o,t,l),n||(i=[xe(t,"mouseover",function(){pt(e[11](e[18]))&&e[11](e[18]).apply(this,arguments)}),xe(t,"mouseout",function(){pt(e[12](e[18]))&&e[12](e[18]).apply(this,arguments)}),xe(t,"click",function(){pt(e[13](e[18]))&&e[13](e[18]).apply(this,arguments)})],n=!0)},p(o,l){e=o,l&768&&r!==(r=e[9](e[18]))&&z(t,"d",r),l&1280&&ae(t,"hover",e[18].properties&&e[18].properties.id&&e[10]==e[18].properties.id)},d(o){o&&P(t),n=!1,ri(i)}}}function Mn(e){let t;function r(o,l){return o[4]=="polygons"?dr:mr}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),H(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&P(t),i.d(o)}}}function wr(e){let t,r,n,i,o,l,s,h,v=pe(e[8]),a=[];for(let u=0;u<v.length;u+=1)a[u]=Mn(wn(e,v,u));return{c(){t=Q("g"),r=Q("pattern"),n=Q("circle"),i=Q("pattern"),o=Q("circle"),l=Q("pattern"),s=Q("circle");for(let u=0;u<a.length;u+=1)a[u].c();this.h()},l(u){t=x(u,"g",{class:!0,id:!0});var f=U(t);r=x(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var m=U(r);n=x(m,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),U(n).forEach(P),m.forEach(P),i=x(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var y=U(i);o=x(y,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),U(o).forEach(P),y.forEach(P),l=x(f,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0});var S=U(l);s=x(S,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),U(s).forEach(P),S.forEach(P);for(let M=0;M<a.length;M+=1)a[M].l(f);f.forEach(P),this.h()},h(){z(n,"cx","1"),z(n,"cy","1"),z(n,"r","3"),z(n,"fill","#A060C1"),z(r,"id","circles-urban-industrial-era"),z(r,"x","0"),z(r,"y","0"),z(r,"width","5"),z(r,"height","5"),z(r,"patternUnits","userSpaceOnUse"),z(o,"cx","50"),z(o,"cy","50"),z(o,"r","20"),z(o,"fill","#599FF0"),z(i,"id","circles-pre-1600s"),z(i,"x","0"),z(i,"y","0"),z(i,"width","50"),z(i,"height","50"),z(i,"patternUnits","userSpaceOnUse"),z(s,"cx","1"),z(s,"cy","1"),z(s,"r","3"),z(s,"fill","#83BC6E"),z(l,"id","circles-intro"),z(l,"x","0"),z(l,"y","0"),z(l,"width","5"),z(l,"height","5"),z(l,"patternUnits","userSpaceOnUse"),z(t,"class",h=`map-svg-g view-${e[5]} era-${e[6]} stop-${e[7]} svelte-m64nol`),z(t,"id",e[1]),ae(t,"visible",e[3]),ae(t,"hidden",!e[3])},m(u,f){H(u,t,f),ee(t,r),ee(r,n),ee(t,i),ee(i,o),ee(t,l),ee(l,s);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(t,null)},p(u,[f]){if(f&16149){v=pe(u[8]);let m;for(m=0;m<v.length;m+=1){const y=wn(u,v,m);a[m]?a[m].p(y,f):(a[m]=Mn(y),a[m].c(),a[m].m(t,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=v.length}f&224&&h!==(h=`map-svg-g view-${u[5]} era-${u[6]} stop-${u[7]} svelte-m64nol`)&&z(t,"class",h),f&2&&z(t,"id",u[1]),f&232&&ae(t,"visible",u[3]),f&232&&ae(t,"hidden",!u[3])},i:ze,o:ze,d(u){u&&P(t),Ge(a,u)}}}function Mr(e,t,r){let{url:n=""}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,{geometryType:h="polygons"}=t,{activeViewID:v}=t,{activeEraID:a}=t,{activeStopID:u}=t;function f(_){console.log("Map(id: "+o+"):onChapterMouseOver(event:"+JSON.stringify(_.detail)+")"),r(10,M=_.detail.id)}function m(_){console.log("Map(id: "+o+"):onChapterMouseLeave(event:"+JSON.stringify(_.detail)+")"),r(10,M=null)}let y=[],S=null,M=null;const p=At();Xt(()=>{Vn(Ht+n).then(_=>{r(8,y=_.features),r(9,S=Zt().projection(i))})});function O(_){console.log("Map:onFeatureMouseOver(feature:"+JSON.stringify(_)+")"),_.properties&&_.properties.id&&console.log("Map:onFeatureMouseOver(section:"+JSON.stringify(_.properties.id)+")"),p("featureMouseOver",{mapID:o,featureID:_.properties&&_.properties.id?_.properties.id:"?"})}function w(_){console.log("Map:onFeatureMouseOut(feature:"+JSON.stringify(_)+")"),_.properties&&_.properties.id&&console.log("Map:onFeatureMouseOut(id:"+JSON.stringify(_.properties.id)+")"),p("featureMouseOut",{mapID:o,featureID:_.properties&&_.properties.id?_.properties.id:"?"})}function E(_){console.log("Map:onFeatureClick(feature:"+JSON.stringify(_)+")"),p("featureClick",{mapID:o,featureID:_.properties&&_.properties.id?_.properties.id:"?"})}return e.$$set=_=>{"url"in _&&r(14,n=_.url),"projection"in _&&r(0,i=_.projection),"id"in _&&r(1,o=_.id),"interactive"in _&&r(2,l=_.interactive),"visible"in _&&r(3,s=_.visible),"geometryType"in _&&r(4,h=_.geometryType),"activeViewID"in _&&r(5,v=_.activeViewID),"activeEraID"in _&&r(6,a=_.activeEraID),"activeStopID"in _&&r(7,u=_.activeStopID)},[i,o,l,s,h,v,a,u,y,S,M,O,w,E,n,f,m]}class ni extends qe{constructor(t){super(),He(this,t,Mr,wr,Be,{url:14,projection:0,id:1,interactive:2,visible:3,geometryType:4,activeViewID:5,activeEraID:6,activeStopID:7,onChapterMouseOver:15,onChapterMouseLeave:16})}get onChapterMouseOver(){return this.$$.ctx[15]}get onChapterMouseLeave(){return this.$$.ctx[16]}}function Sr(e){return e.k}function Er(e){return[e.x,e.y]}function Sn(e){return function(){return e}}function kr(){let e=0,t=0,r=960,n=500,i=!0,o=!0,l=256,s=Sr,h=Er,v=0;function a(){const u=+s.apply(this,arguments),f=h.apply(this,arguments),m=Math.log2(u/l),y=Math.round(Math.max(m+v,0)),S=Math.pow(2,m-y)*l,M=+f[0]-u/2,p=+f[1]-u/2,O=Math.max(i?0:-1/0,Math.floor((e-M)/S)),w=Math.min(i?1<<y:1/0,Math.ceil((r-M)/S)),E=Math.max(o?0:-1/0,Math.floor((t-p)/S)),_=Math.min(o?1<<y:1/0,Math.ceil((n-p)/S)),D=[];for(let k=E;k<_;++k)for(let b=O;b<w;++b)D.push([b,k,y]);return D.translate=[M/S,p/S],D.scale=S,D}return a.size=function(u){return arguments.length?(e=t=0,r=+u[0],n=+u[1],a):[r-e,n-t]},a.extent=function(u){return arguments.length?(e=+u[0][0],t=+u[0][1],r=+u[1][0],n=+u[1][1],a):[[e,t],[r,n]]},a.scale=function(u){return arguments.length?(s=typeof u=="function"?u:Sn(+u),a):s},a.translate=function(u){return arguments.length?(h=typeof u=="function"?u:Sn([+u[0],+u[1]]),a):h},a.zoomDelta=function(u){return arguments.length?(v=+u,a):v},a.tileSize=function(u){return arguments.length?(l=+u,a):l},a.clamp=function(u){return arguments.length?(i=o=!!u,a):i&&o},a.clampX=function(u){return arguments.length?(i=!!u,a):i},a.clampY=function(u){return arguments.length?(o=!!u,a):o},a}function En(e,t,r){const n=e.slice();n[11]=t[r];const i=Ir(n[11],n[1]);return n[12]=i[0],n[13]=i[1],n}function kn(e){let t;return{c(){t=Q("image"),this.h()},l(r){t=x(r,"image",{"xlink:href":!0,x:!0,y:!0,width:!0,height:!0,class:!0}),U(t).forEach(P),this.h()},h(){oi(t,"xlink:href",e[3](...e[11])),z(t,"x",e[12]),z(t,"y",e[13]),z(t,"width",e[2]),z(t,"height",e[2]),z(t,"class","svelte-511esr")},m(r,n){H(r,t,n)},p:ze,d(r){r&&P(t)}}}function zr(e){let t,r=pe(e[1]),n=[];for(let i=0;i<r.length;i+=1)n[i]=kn(En(e,r,i));return{c(){t=Q("g");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){t=x(i,"g",{class:!0});var o=U(t);for(let l=0;l<n.length;l+=1)n[l].l(o);o.forEach(P),this.h()},h(){z(t,"class","map-svg-g svelte-511esr"),ae(t,"visible",e[0])},m(i,o){H(i,t,o);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(t,null)},p(i,[o]){if(o&14){r=pe(i[1]);let l;for(l=0;l<r.length;l+=1){const s=En(i,r,l);n[l]?n[l].p(s,o):(n[l]=kn(s),n[l].c(),n[l].m(t,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=r.length}o&1&&ae(t,"visible",i[0])},i:ze,o:ze,d(i){i&&P(t),Ge(n,i)}}}function Ir(e,t){const[r,n]=e,{translate:[i,o],scale:l}=t;return[(r+i)*l,(n+o)*l]}function Or(e,t,r){let{urlPath:n}=t,{urlExtension:i}=t,{projection:o}=t,{visible:l=!1}=t;At(),Xt(()=>{});const h=kr().size([2e3,1e3]).scale(o.scale()*2*Math.PI).translate(o([0,0]))(),{translate:[v,a],scale:u}=h,f=(m,y,S)=>`${Ht}${n}${S}/${m}/${y}.${i}`;return e.$$set=m=>{"urlPath"in m&&r(4,n=m.urlPath),"urlExtension"in m&&r(5,i=m.urlExtension),"projection"in m&&r(6,o=m.projection),"visible"in m&&r(0,l=m.visible)},[l,h,u,f,n,i,o]}class Dr extends qe{constructor(t){super(),He(this,t,Or,zr,Be,{urlPath:4,urlExtension:5,projection:6,visible:0})}}function zn(e,t,r){const n=e.slice();return n[6]=t[r],n}function In(e){let t,r=e[6].properties.label+"",n,i;return{c(){t=Q("text"),n=Pn(r),this.h()},l(o){t=x(o,"text",{transform:!0,dy:!0,class:!0});var l=U(t);n=Rn(l,r),l.forEach(P),this.h()},h(){z(t,"transform",i=`translate(${e[0](e[6].geometry.coordinates)})`),z(t,"dy",".35em"),z(t,"class","svelte-1jsbgn8")},m(o,l){H(o,t,l),ee(t,n)},p(o,l){l&8&&r!==(r=o[6].properties.label+"")&&Ln(n,r),l&9&&i!==(i=`translate(${o[0](o[6].geometry.coordinates)})`)&&z(t,"transform",i)},d(o){o&&P(t)}}}function Nr(e){let t,r=pe(e[3]),n=[];for(let i=0;i<r.length;i+=1)n[i]=In(zn(e,r,i));return{c(){t=Q("g");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){t=x(i,"g",{class:!0,id:!0});var o=U(t);for(let l=0;l<n.length;l+=1)n[l].l(o);o.forEach(P),this.h()},h(){z(t,"class","map-svg-g svelte-1jsbgn8"),z(t,"id",e[1]),ae(t,"visible",e[2]),ae(t,"hidden",!e[2])},m(i,o){H(i,t,o);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(t,null)},p(i,[o]){if(o&9){r=pe(i[3]);let l;for(l=0;l<r.length;l+=1){const s=zn(i,r,l);n[l]?n[l].p(s,o):(n[l]=In(s),n[l].c(),n[l].m(t,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=r.length}o&2&&z(t,"id",i[1]),o&4&&ae(t,"visible",i[2]),o&4&&ae(t,"hidden",!i[2])},i:ze,o:ze,d(i){i&&P(t),Ge(n,i)}}}function Tr(e,t,r){let{path:n}=t,{projection:i}=t,{id:o}=t,{interactive:l=!1}=t,{visible:s=!1}=t,h=[];return Xt(()=>{Vn(Ht+n).then(v=>{r(3,h=v.features),r(4,n=Zt().projection(i))})}),e.$$set=v=>{"path"in v&&r(4,n=v.path),"projection"in v&&r(0,i=v.projection),"id"in v&&r(1,o=v.id),"interactive"in v&&r(5,l=v.interactive),"visible"in v&&r(2,s=v.visible)},[i,o,s,h,n,l]}class br extends qe{constructor(t){super(),He(this,t,Tr,Nr,Be,{path:4,projection:0,id:1,interactive:5,visible:2})}}function ii(e,t){const r=new IntersectionObserver(n,{threshold:1});r.observe(e);function n(i){const o=i.find(l=>l.isIntersecting);if(o){const l=o.target.dataset.id;t(l)}}return{destroy:()=>r.disconnect()}}function On(e,t,r){const n=e.slice();return n[20]=t[r],n}function Dn(e,t,r){const n=e.slice();return n[23]=t[r],n}function Nn(e){let t,r=pe(e[0].views[e[3]].story),n=[];for(let i=0;i<r.length;i+=1)n[i]=Tn(Dn(e,r,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();t=ie()},l(i){for(let o=0;o<n.length;o+=1)n[o].l(i);t=ie()},m(i,o){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,o);H(i,t,o)},p(i,o){if(o&1033){r=pe(i[0].views[i[3]].story);let l;for(l=0;l<r.length;l+=1){const s=Dn(i,r,l);n[l]?n[l].p(s,o):(n[l]=Tn(s),n[l].c(),n[l].m(t.parentNode,t))}for(;l<n.length;l+=1)n[l].d(1);n.length=r.length}},d(i){i&&P(t),Ge(n,i)}}}function Cr(e){let t,r,n=e[23].text+"";return{c(){t=ye("p"),r=new Ut(!1),this.h()},l(i){t=we(i,"P",{});var o=U(t);r=jt(o,!1),o.forEach(P),this.h()},h(){r.a=null},m(i,o){H(i,t,o),r.m(n,t)},p(i,o){o&9&&n!==(n=i[23].text+"")&&r.p(n)},d(i){i&&P(t)}}}function Pr(e){let t;function r(o,l){return o[23].stop?Lr:Rr}let n=r(e),i=n(e);return{c(){i.c(),t=ie()},l(o){i.l(o),t=ie()},m(o,l){i.m(o,l),H(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i.d(1),i=n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&P(t),i.d(o)}}}function Rr(e){let t,r,n=e[23].text+"";return{c(){t=ye("h2"),r=new Ut(!1),this.h()},l(i){t=we(i,"H2",{class:!0});var o=U(t);r=jt(o,!1),o.forEach(P),this.h()},h(){r.a=null,z(t,"class","svelte-292f83")},m(i,o){H(i,t,o),r.m(n,t)},p(i,o){o&9&&n!==(n=i[23].text+"")&&r.p(n)},d(i){i&&P(t)}}}function Lr(e){let t,r,n=e[23].text+"",i,o,l;return{c(){t=ye("h2"),r=new Ut(!1),this.h()},l(s){t=we(s,"H2",{"data-id":!0,class:!0});var h=U(t);r=jt(h,!1),h.forEach(P),this.h()},h(){r.a=null,z(t,"data-id",i=e[23].stop),z(t,"class","svelte-292f83")},m(s,h){H(s,t,h),r.m(n,t),o||(l=Fn(ii.call(null,t,e[10])),o=!0)},p(s,h){h&9&&n!==(n=s[23].text+"")&&r.p(n),h&9&&i!==(i=s[23].stop)&&z(t,"data-id",i)},d(s){s&&P(t),o=!1,l()}}}function Tn(e){let t;function r(o,l){if(o[23].type=="h")return Pr;if(o[23].type=="p")return Cr}let n=r(e),i=n&&n(e);return{c(){i&&i.c(),t=ie()},l(o){i&&i.l(o),t=ie()},m(o,l){i&&i.m(o,l),H(o,t,l)},p(o,l){n===(n=r(o))&&i?i.p(o,l):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(t.parentNode,t)))},d(o){o&&P(t),i&&i.d(o)}}}function Fr(e){let t,r;return t=new br({props:{path:e[20].path,id:e[20].id,projection:e[6],visible:e[5]==null&&e[0].views[e[3]].maps&&e[0].views[e[3]].maps.includes(e[20].id)||e[5]&&e[0].views[e[3]].stops[e[5]].maps&&e[0].views[e[3]].stops[e[5]].maps.includes(e[20].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&1&&(o.path=n[20].path),i&1&&(o.id=n[20].id),i&41&&(o.visible=n[5]==null&&n[0].views[n[3]].maps&&n[0].views[n[3]].maps.includes(n[20].id)||n[5]&&n[0].views[n[3]].stops[n[5]].maps&&n[0].views[n[3]].stops[n[5]].maps.includes(n[20].id)),t.$set(o)},i(n){r||(ne(t.$$.fragment,n),r=!0)},o(n){oe(t.$$.fragment,n),r=!1},d(n){ke(t,n)}}}function Jr(e){let t,r;return t=new Dr({props:{urlPath:e[20].urlPath,urlExtension:e[20].urlExtension,projection:e[6],visible:e[5]==null&&e[0].views[e[3]].maps&&e[0].views[e[3]].maps.includes(e[20].id)||e[5]&&e[0].views[e[3]].stops[e[5]].maps&&e[0].views[e[3]].stops[e[5]].maps.includes(e[20].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&1&&(o.urlPath=n[20].urlPath),i&1&&(o.urlExtension=n[20].urlExtension),i&41&&(o.visible=n[5]==null&&n[0].views[n[3]].maps&&n[0].views[n[3]].maps.includes(n[20].id)||n[5]&&n[0].views[n[3]].stops[n[5]].maps&&n[0].views[n[3]].stops[n[5]].maps.includes(n[20].id)),t.$set(o)},i(n){r||(ne(t.$$.fragment,n),r=!0)},o(n){oe(t.$$.fragment,n),r=!1},d(n){ke(t,n)}}}function Vr(e){let t,r,n,i;const o=[Ar,Yr],l=[];function s(h,v){return h[20].interactive?0:1}return t=s(e),r=l[t]=o[t](e),{c(){r.c(),n=ie()},l(h){r.l(h),n=ie()},m(h,v){l[t].m(h,v),H(h,n,v),i=!0},p(h,v){let a=t;t=s(h),t===a?l[t].p(h,v):(Bt(),oe(l[a],1,1,()=>{l[a]=null}),Gt(),r=l[t],r?r.p(h,v):(r=l[t]=o[t](h),r.c()),ne(r,1),r.m(n.parentNode,n))},i(h){i||(ne(r),i=!0)},o(h){oe(r),i=!1},d(h){h&&P(n),l[t].d(h)}}}function Yr(e){let t,r;return t=new ni({props:{activeViewID:e[3],activeEraID:e[4],activeStopID:e[5],url:e[20].url,geometryType:e[20].geometryType?e[20].geometryType:"polygons",id:e[20].id,projection:e[6],visible:e[5]==null&&e[0].views[e[3]].maps&&e[0].views[e[3]].maps.includes(e[20].id)||e[5]&&e[0].views[e[3]].stops[e[5]].maps&&e[0].views[e[3]].stops[e[5]].maps.includes(e[20].id)}}),{c(){Me(t.$$.fragment)},l(n){Se(t.$$.fragment,n)},m(n,i){Ee(t,n,i),r=!0},p(n,i){const o={};i&8&&(o.activeViewID=n[3]),i&16&&(o.activeEraID=n[4]),i&32&&(o.activeStopID=n[5]),i&1&&(o.url=n[20].url),i&1&&(o.geometryType=n[20].geometryType?n[20].geometryType:"polygons"),i&1&&(o.id=n[20].id),i&41&&(o.visible=n[5]==null&&n[0].views[n[3]].maps&&n[0].views[n[3]].maps.includes(n[20].id)||n[5]&&n[0].views[n[3]].stops[n[5]].maps&&n[0].views[n[3]].stops[n[5]].maps.includes(n[20].id)),t.$set(o)},i(n){r||(ne(t.$$.fragment,n),r=!0)},o(n){oe(t.$$.fragment,n),r=!1},d(n){ke(t,n)}}}function Ar(e){let t,r,n={activeViewID:e[3],activeEraID:e[4],activeStopID:e[5],url:e[20].url,geometryType:e[20].geometryType?e[20].geometryType:"polygons",id:e[20].id,projection:e[6],visible:e[5]==null&&e[0].views[e[3]].maps&&e[0].views[e[3]].maps.includes(e[20].id)||e[5]&&e[0].views[e[3]].stops[e[5]].maps&&e[0].views[e[3]].stops[e[5]].maps.includes(e[20].id),interactive:!0};return t=new ni({props:n}),e[14](t),t.$on("featureMouseOver",e[7]),t.$on("featureMouseOut",e[8]),t.$on("featureClick",e[9]),{c(){Me(t.$$.fragment)},l(i){Se(t.$$.fragment,i)},m(i,o){Ee(t,i,o),r=!0},p(i,o){const l={};o&8&&(l.activeViewID=i[3]),o&16&&(l.activeEraID=i[4]),o&32&&(l.activeStopID=i[5]),o&1&&(l.url=i[20].url),o&1&&(l.geometryType=i[20].geometryType?i[20].geometryType:"polygons"),o&1&&(l.id=i[20].id),o&41&&(l.visible=i[5]==null&&i[0].views[i[3]].maps&&i[0].views[i[3]].maps.includes(i[20].id)||i[5]&&i[0].views[i[3]].stops[i[5]].maps&&i[0].views[i[3]].stops[i[5]].maps.includes(i[20].id)),t.$set(l)},i(i){r||(ne(t.$$.fragment,i),r=!0)},o(i){oe(t.$$.fragment,i),r=!1},d(i){e[14](null),ke(t,i)}}}function bn(e){let t,r,n,i;const o=[Vr,Jr,Fr],l=[];function s(h,v){return h[20].type=="shapefile"?0:h[20].type=="tile"?1:h[20].type=="label"?2:-1}return~(t=s(e))&&(r=l[t]=o[t](e)),{c(){r&&r.c(),n=ie()},l(h){r&&r.l(h),n=ie()},m(h,v){~t&&l[t].m(h,v),H(h,n,v),i=!0},p(h,v){let a=t;t=s(h),t===a?~t&&l[t].p(h,v):(r&&(Bt(),oe(l[a],1,1,()=>{l[a]=null}),Gt()),~t?(r=l[t],r?r.p(h,v):(r=l[t]=o[t](h),r.c()),ne(r,1),r.m(n.parentNode,n)):r=null)},i(h){i||(ne(r),i=!0)},o(h){oe(r),i=!1},d(h){h&&P(n),~t&&l[t].d(h)}}}function Xr(e){let t,r,n,i,o=e[0].views[e[3]].name+"",l,s,h,v,a,u,f,m,y,S=e[0].views[e[3]].story&&Nn(e),M=pe(Object.values(e[0].maps)),p=[];for(let w=0;w<M.length;w+=1)p[w]=bn(On(e,M,w));const O=w=>oe(p[w],1,1,()=>{p[w]=null});return{c(){t=ye("div"),r=ye("div"),n=ye("div"),i=ye("h1"),l=Pn(o),s=tt(),S&&S.c(),h=tt(),v=Q("svg"),a=Q("g");for(let w=0;w<p.length;w+=1)p[w].c();this.h()},l(w){t=we(w,"DIV",{id:!0,class:!0});var E=U(t);r=we(E,"DIV",{id:!0,class:!0});var _=U(r);n=we(_,"DIV",{id:!0,class:!0});var D=U(n);i=we(D,"H1",{class:!0});var k=U(i);l=Rn(k,o),k.forEach(P),s=nt(D),S&&S.l(D),D.forEach(P),_.forEach(P),h=nt(E),v=x(E,"svg",{id:!0,class:!0});var b=U(v);a=x(b,"g",{});var R=U(a);for(let J=0;J<p.length;J+=1)p[J].l(R);R.forEach(P),b.forEach(P),E.forEach(P),this.h()},h(){z(i,"class","svelte-292f83"),z(n,"id","story-narrative"),z(n,"class","svelte-292f83"),z(r,"id","story-narrative-container"),z(r,"class","svelte-292f83"),z(v,"id","map-svg"),z(v,"class","svelte-292f83"),z(t,"id","map"),z(t,"class",u=`view-${e[3]} era-${e[4]} stop-${e[5]} svelte-292f83`)},m(w,E){H(w,t,E),ee(t,r),ee(r,n),ee(n,i),ee(i,l),ee(n,s),S&&S.m(n,null),ee(t,h),ee(t,v),ee(v,a);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(a,null);e[15](a),f=!0,m||(y=Fn(ii.call(null,i,e[10])),m=!0)},p(w,[E]){if((!f||E&9)&&o!==(o=w[0].views[w[3]].name+"")&&Ln(l,o),w[0].views[w[3]].story?S?S.p(w,E):(S=Nn(w),S.c(),S.m(n,null)):S&&(S.d(1),S=null),E&1019){M=pe(Object.values(w[0].maps));let _;for(_=0;_<M.length;_+=1){const D=On(w,M,_);p[_]?(p[_].p(D,E),ne(p[_],1)):(p[_]=bn(D),p[_].c(),ne(p[_],1),p[_].m(a,null))}for(Bt(),_=M.length;_<p.length;_+=1)O(_);Gt()}(!f||E&56&&u!==(u=`view-${w[3]} era-${w[4]} stop-${w[5]} svelte-292f83`))&&z(t,"class",u)},i(w){if(!f){for(let E=0;E<M.length;E+=1)ne(p[E]);f=!0}},o(w){p=p.filter(Boolean);for(let E=0;E<p.length;E+=1)oe(p[E]);f=!1},d(w){w&&P(t),S&&S.d(),Ge(p,w),e[15](null),m=!1,y()}}}let Mt=800,St=600;function Cn(e){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[e.nwLng,e.nwLat],[e.seLng,e.nwLat],[e.seLng,e.seLat],[e.nwLng,e.seLat],[e.nwLng,e.nwLat]]],type:"Polygon"}}]}}function Ur(e,t,r){let{story:n={}}=t;function i(k){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(k.detail)+")"),s&&s.onChapterMouseOver(k)}function o(k){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(k.detail)+")"),s&&s.onChapterMouseLeave(k)}function l(k){console.log(`Maps:onNavigate(event:${JSON.stringify(k.detail)})`),r(3,a=k.detail.viewID),r(4,u=k.detail.eraID),r(5,f=null),n.views[a].extent&&y(n.views[a].extent)}let s,h,v,a=n.intialView,u=null,f=null;v=vr().on("zoom",S);const m=At();function y(k){console.log(`Maps:moveMap(extent:${JSON.stringify(k)}`);const b=Cn(k);var R=Zt().projection(M);const J=R.bounds(b),[[C,$],[A,c]]=J;me(h).transition().duration(3e3).ease(fi).call(v.transform,qt.translate(Mt/2,St/2).scale(.9/Math.max((A-C)/Mt,(c-$)/St)).translate(-(C+A)/2,-($+c)/2))}function S(k){const{transform:b}=k;me(h).attr("transform",b)}const M=ur().rotate([74,0]).fitSize([Mt,St],Cn(n.views[n.intialView].extent));function p(k){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(k.detail)+")"),m("featureMouseOver",k.detail)}function O(k){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(k.detail)+")"),m("featureMouseOut",k.detail)}function w(k){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(k.detail)+")"),m("featureClick",k.detail)}function E(k){console.log(`Maps:onStop(stopID:${k}`),r(5,f=k),n.views[a].stops&&n.views[a].stops[f]&&y(n.views[a].stops[f].extent)}function _(k){it[k?"unshift":"push"](()=>{s=k,r(1,s)})}function D(k){it[k?"unshift":"push"](()=>{h=k,r(2,h)})}return e.$$set=k=>{"story"in k&&r(0,n=k.story)},[n,s,h,a,u,f,M,p,O,w,E,i,o,l,_,D]}class jr extends qe{constructor(t){super(),He(this,t,Ur,Xr,Be,{story:0,onChapterMouseOver:11,onChapterMouseLeave:12,onNavigate:13})}get onChapterMouseOver(){return this.$$.ctx[11]}get onChapterMouseLeave(){return this.$$.ctx[12]}get onNavigate(){return this.$$.ctx[13]}}function Br(e){let t,r,n,i,o,l,s,h;t=new ci({}),t.$on("navigate",e[7]);let v={story:Ye};n=new jr({props:v}),e[9](n),n.$on("featureMouseOver",e[2]),n.$on("featureMouseOut",e[3]),n.$on("featureClick",e[6]);let a={eras:Ye.eras};return o=new hi({props:a}),e[10](o),o.$on("chapterMouseOver",e[4]),o.$on("chapterMouseLeave",e[5]),o.$on("navigate",e[7]),{c(){Me(t.$$.fragment),r=tt(),Me(n.$$.fragment),i=tt(),Me(o.$$.fragment)},l(u){Se(t.$$.fragment,u),r=nt(u),Se(n.$$.fragment,u),i=nt(u),Se(o.$$.fragment,u)},m(u,f){Ee(t,u,f),H(u,r,f),Ee(n,u,f),H(u,i,f),Ee(o,u,f),l=!0,s||(h=xe(window,"popstate",e[8]),s=!0)},p(u,[f]){const m={};n.$set(m);const y={};o.$set(y)},i(u){l||(ne(t.$$.fragment,u),ne(n.$$.fragment,u),ne(o.$$.fragment,u),l=!0)},o(u){oe(t.$$.fragment,u),oe(n.$$.fragment,u),oe(o.$$.fragment,u),l=!1},d(u){u&&(P(r),P(i)),ke(t,u),e[9](null),ke(n,u),e[10](null),ke(o,u),s=!1,h()}}}function Gr(e,t,r){let n;li(e,ai,p=>r(15,n=p));let i,o,l="intro";Ye.views[l];let s=null;function h(p){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(p.detail)+")"),i.onMapFeatureMouseOver(p)}function v(p){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(p.detail)+")"),i.onMapFeatureMouseOut(p)}function a(p){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(p.detail)+")"),o.onChapterMouseOver(p)}function u(p){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(p.detail)+")"),o.onChapterMouseLeave(p)}function f(p){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(p.detail)+")"),i.onMapFeatureClick(p)}function m(p,O=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(p.detail)})`),l=p.detail.viewID,Ye.views[l],s=p.detail.eraID,s&&Ye.eras[s],o.onNavigate(p),i.onNavigate(p),O&&ui(`#/view/${p.detail.viewID}`,{state:p.detail})}function y(p){p.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(p.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(n.state)}`),p.state["sveltekit:states"].viewID&&m({detail:{...p.state["sveltekit:states"]}},!1))}function S(p){it[p?"unshift":"push"](()=>{o=p,r(1,o)})}function M(p){it[p?"unshift":"push"](()=>{i=p,r(0,i)})}return[i,o,h,v,a,u,f,m,y,S,M]}class Qr extends qe{constructor(t){super(),He(this,t,Gr,Br,Be,{})}}export{Qr as component};
